# Project Overview
Generated on: Mon Jul 21 21:22:53 EDT 2025

This script produces a comprehensive snapshot of all files in the ranked-choice project.
Sensitive data could be exposed, so protect 'project-overview.txt' accordingly.
---

## 1. Directory Structure

Below is the tree of files/folders (excluding .git, node_modules, dist, project-overview*):
```
.
├── .DS_Store
├── .env
├── .env.example
├── .gitignore
├── .nvmrc
├── CHANGELOG.md
├── docs
│   ├── agents.md
│   ├── agents.md.orig
│   ├── architecture.md
│   ├── glossary.md
│   └── glossary.md.orig
├── package-lock.json
├── package-lock.json.orig
├── package.json
├── photo_select
│   ├── __init__.py
│   ├── cli.py
│   └── field_notes
│       ├── __init__.py
│       ├── md_store.py
│       ├── patch.py
│       ├── tests
│       │   ├── test_autolink.py
│       │   ├── test_cli_field_notes.py
│       │   ├── test_patch.py
│       │   └── test_writer.py
│       └── writer.py
├── photo-select-here.sh
├── prompts
│   ├── default_prompt_olympia.hbs
│   ├── default_prompt.hbs
│   ├── default_prompt.hbs.orig
│   ├── field_notes_addon.txt
│   ├── field_notes_second_pass.hbs
│   └── field_notes_second_pass.hbs.orig
├── README.md
├── README.md.orig
├── reply.schema.json
├── requirements.txt
├── scripts
│   ├── export_sqlite.js
│   ├── generate_schema.js
│   ├── generate-overview.sh
│   └── pre-commit.js
├── src
│   ├── chatClient.js
│   ├── chatClient.js.orig
│   ├── config.js
│   ├── fieldNotes.js
│   ├── hash.js
│   ├── imageSelector.js
│   ├── index.js
│   ├── index.js.orig
│   ├── orchestrator.js
│   ├── orchestrator.js.orig
│   ├── prompt.js
│   ├── replySchema.js
│   ├── replySchema.ts
│   └── stats.js
└── tests
    ├── archive.test.js
    ├── chatClient.test.js
    ├── fieldNotes.test.js
    ├── hash.test.js
    ├── imageSelector.test.js
    ├── orchestrator.test.js
    ├── orchestrator.test.js.orig
    └── schema.test.js

9 directories, 61 files
```

---

## 2. Full Content Dump
This section provides a textual representation of each file, skipping certain directories and file patterns.
PDF files are extracted as text if possible; binary files are noted but not shown in raw form.

### File: .
```
(File type is inode/directory — skipping raw dump.)
```

### File: ./photo-select-here.sh
```
#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
TARGET_DIR="$(pwd)"

# Load nvm if available
if [ -z "${NVM_DIR:-}" ]; then
  if [ -d "$HOME/.nvm" ]; then
    export NVM_DIR="$HOME/.nvm"
  fi
fi
if [ -s "$NVM_DIR/nvm.sh" ]; then
  . "$NVM_DIR/nvm.sh"
fi

# Use Node version from .nvmrc if nvm is available
if command -v nvm >/dev/null 2>&1; then
  if ! nvm use "$SCRIPT_DIR" >/dev/null 2>&1; then
    echo "nvm: Node $(cat "$SCRIPT_DIR/.nvmrc") not installed; using system node $(node --version)" >&2
  fi
fi

cd "$SCRIPT_DIR"

dir_specified=false
for arg in "$@"; do
  case "$arg" in
    -d|--dir|--dir=*|-d=*)
      dir_specified=true
      break
      ;;
  esac
done

if [ "$dir_specified" = true ]; then
  npx photo-select "$@"
else
  npx photo-select "$@" --dir "$TARGET_DIR"
fi
```

### File: ./photo_select
```
(File type is inode/directory — skipping raw dump.)
```

### File: ./photo_select/__init__.py
```
"""photo_select package placeholder."""
```

### File: ./photo_select/cli.py
```
"""Command-line interface placeholder."""

import argparse
import json
import logging
from pathlib import Path
from typing import Callable

from .field_notes.writer import FieldNotesWriter, PatchResult
from .field_notes import md_store


def process_first_pass_result(
    writer: FieldNotesWriter,
    result_json: str,
    llm: Callable[[str], str] | None = None,
) -> PatchResult | None:
    """Handle first-pass LLM result and update notes when possible."""
    try:
        data = json.loads(result_json)
    except json.JSONDecodeError as exc:
        logging.warning("Bad JSON from first pass: %s", exc)
        return None

    diff = data.get("field_notes_diff")
    full = data.get("field_notes_md")

    if diff:
        if llm is not None:
            second_prompt = json.dumps(
                {
                    "FIELD_NOTES_PREVIEW": writer.md,
                    "FIELD_NOTES_DIFF": diff,
                }
            )
            try:
                second_result = llm(second_prompt)
                _ = json.loads(second_result).get("field_notes_md")
            except Exception as exc:  # noqa: BLE001
                logging.warning("Act II failed: %s", exc)
        return writer.maybe_apply_diff(diff)

    if full:
        new_text = writer.autolink_filenames(full, writer.path.parent)
        md_store.atomic_write(writer.path, new_text)
        writer.md = new_text
        lines_added = new_text.count("\n") - writer.md.count("\n")
        return PatchResult(True, lines_added)

    logging.warning("No field notes data found in response")
    return None


def parse_args(argv=None):
    parser = argparse.ArgumentParser(prog="photo-select")
    parser.add_argument("--field-notes", action="store_true", help="Enable living field-notes.md generation with curator diff workflow.")
    parser.add_argument("path", nargs="?", default="field-notes.md")
    return parser.parse_args(argv)


def main(argv=None, llm: Callable[[str], str] | None = None):
    args = parse_args(argv)
    if args.field_notes:
        path = Path(args.path)
        level = path.parent.name.split("-")[-1]
        writer = FieldNotesWriter(path, level=level)
        payload = json.dumps(writer.first_pass_payload())
        if llm is None:
            print(payload)
            return
        first_res = llm(payload)
        result = process_first_pass_result(writer, first_res, llm)
        if isinstance(result, PatchResult) and result.applied:
            print(
                f"\U0001F4D2  Updated field-notes (level-{writer.level}) — +{result.lines_added} lines"
            )


if __name__ == "__main__":
    main()
```

### File: ./photo_select/field_notes
```
(File type is inode/directory — skipping raw dump.)
```

### File: ./photo_select/field_notes/patch.py
```
import difflib
import subprocess
import tempfile
from pathlib import Path


def generate(old: str, new: str) -> str:
    """Return a unified diff between old and new."""
    diff = difflib.unified_diff(
        old.splitlines(True),
        new.splitlines(True),
        fromfile="a/field-notes.md",
        tofile="b/field-notes.md",
    )
    return "".join(diff)


def apply(old: str, diff: str) -> str:
    """Apply a unified diff to ``old`` and return the new text.

    Falls back to the pure Python ``patch-ng`` library when the ``patch``
    binary is unavailable.
    """
    with tempfile.TemporaryDirectory() as td:
        old_path = Path(td) / "field-notes.md"
        patch_path = Path(td) / "patch.diff"
        old_path.write_text(old)
        patch_path.write_text(diff)
        try:
            subprocess.run(
                ["patch", old_path.name, patch_path.name],
                cwd=td,
                capture_output=True,
                text=True,
                check=True,
            )
        except FileNotFoundError:
            from patch_ng import fromfile
            patchset = fromfile(str(patch_path))
            if not patchset or not patchset.apply(root=td):
                raise RuntimeError("patch failed")
        except subprocess.CalledProcessError as exc:
            raise RuntimeError(exc.stderr.strip() or "patch failed")
        return old_path.read_text()
```

### File: ./photo_select/field_notes/tests
```
(File type is inode/directory — skipping raw dump.)
```

### File: ./photo_select/field_notes/tests/test_autolink.py
```
from pathlib import Path
import sys

sys.path.insert(0, str(Path(__file__).resolve().parents[3]))
from photo_select.field_notes.writer import FieldNotesWriter


def test_autolink_filenames(tmp_path):
    img = tmp_path / "DSCF1.JPG"
    img.write_text("")
    md = "See [DSCF1.JPG]"
    linked = FieldNotesWriter.autolink_filenames(md, tmp_path)
    assert "[DSCF1.JPG](./DSCF1.JPG)" in linked
```

### File: ./photo_select/field_notes/tests/test_writer.py
```
from pathlib import Path
import sys

sys.path.insert(0, str(Path(__file__).resolve().parents[3]))
from photo_select.field_notes.writer import FieldNotesWriter, PatchResult
from photo_select.field_notes import patch


def test_writer_happy(tmp_path):
    md = tmp_path / "notes.md"
    md.write_text("hello\n")
    writer = FieldNotesWriter(md, level="001")
    diff = patch.generate("hello\n", "hello world\n")
    result = writer.maybe_apply_diff(diff)
    assert isinstance(result, PatchResult) and result.applied
    text = md.read_text()
    assert "hello world" in text
    assert "<!-- updated:" in text


def test_noop_diff(tmp_path):
    md = tmp_path / "notes.md"
    md.write_text("same\n")
    writer = FieldNotesWriter(md, level="001")
    diff = patch.generate("same\n", "same\n")
    result = writer.maybe_apply_diff(diff)
    assert result.applied is False
    assert md.read_text() == "same\n"


def test_broken_diff(tmp_path):
    md = tmp_path / "notes.md"
    md.write_text("base\n")
    writer = FieldNotesWriter(md, level="001")
    diff = patch.generate("other\n", "changed\n")
    result = writer.maybe_apply_diff(diff)
    assert result.applied is False
    assert md.read_text() == "base\n"


def test_autolink(tmp_path):
    md = tmp_path / "notes.md"
    (tmp_path / "DSCF0001.jpg").write_text("\n")
    md.write_text("Look at [DSCF0001.jpg]\n")
    writer = FieldNotesWriter(md, level="001")
    diff = patch.generate(writer.md, writer.md + "More info\n")
    writer.maybe_apply_diff(diff)
    assert "[DSCF0001.jpg](./DSCF0001.jpg)" in md.read_text()
```

### File: ./photo_select/field_notes/tests/test_cli_field_notes.py
```
import json
from pathlib import Path
import sys

sys.path.insert(0, str(Path(__file__).resolve().parents[3]))
from photo_select.cli import main


def test_cli_integration(tmp_path):
    level = tmp_path / "_level-001"
    level.mkdir()
    img = level / "DSCF0001.jpg"
    img.write_text("")
    notes = level / "field-notes.md"

    def fake_llm(payload: str) -> str:
        data = json.loads(payload)
        if "FIELD_NOTES_DIFF" in data:
            return json.dumps({"field_notes_md": data["FIELD_NOTES_PREVIEW"] + "Look [DSCF0001.jpg]\n"})
        else:
            from photo_select.field_notes import patch
            diff = patch.generate("", "Look [DSCF0001.jpg]\n")
            return json.dumps({"field_notes_diff": diff})

    main(["--field-notes", str(notes)], llm=fake_llm)
    text = notes.read_text()
    assert "Look" in text
    assert "[DSCF0001.jpg](./DSCF0001.jpg)" in text
```

### File: ./photo_select/field_notes/tests/test_patch.py
```
import sys
from pathlib import Path

sys.path.insert(0, str(Path(__file__).resolve().parents[3]))
from photo_select.field_notes import patch


def test_round_trip():
    old = "a\n"
    new = "b\n"
    diff = patch.generate(old, new)
    assert patch.apply(old, diff) == new
```

### File: ./photo_select/field_notes/__init__.py
```
"""Field notes helpers."""

from .writer import FieldNotesWriter
from . import md_store, patch

__all__ = ["FieldNotesWriter", "md_store", "patch"]
```

### File: ./photo_select/field_notes/md_store.py
```
from pathlib import Path


def get(path: Path) -> str:
    """Return file contents or empty string if the file is missing."""
    try:
        return path.read_text()
    except FileNotFoundError:
        return ""


def atomic_write(path: Path, new_text: str) -> None:
    """Write text to a temp file then atomically replace the target."""
    temp = path.with_suffix(path.suffix + ".tmp")
    temp.write_text(new_text)
    temp.replace(path)
```

### File: ./photo_select/field_notes/writer.py
```
import logging
from dataclasses import dataclass
from datetime import datetime, timezone
import re
from pathlib import Path

from . import md_store, patch

_INSTR = "Add observations, open questions; propose git-style diff against the file above."


def _timestamp() -> str:
    return datetime.now(timezone.utc).isoformat(timespec="seconds").replace("+00:00", "Z")


@dataclass
class PatchResult:
    applied: bool
    lines_added: int = 0


class FieldNotesWriter:
    def __init__(self, path: Path, level: str | None = None):
        self.path = path
        self.level = level or ""
        self.md = md_store.get(path)
        if self.md == "":
            header = f"## Field Notes — Level {self.level}\n\n<!-- created: {_timestamp()} -->\n"
            self.md = header
            md_store.atomic_write(path, self.md)

    @staticmethod
    def autolink_filenames(md_text: str, image_dir: Path) -> str:
        """Link bare image filenames if they exist in ``image_dir``."""
        pattern = re.compile(r"\[(\w+\.(?:jpg|jpeg|png))\]", re.IGNORECASE)

        def repl(match: re.Match) -> str:
            name = match.group(1)
            if (image_dir / name).exists():
                return f"[{name}](./{name})"
            return match.group(0)

        new_text = pattern.sub(repl, md_text)
        if new_text.count("![") > 3:
            new_text += "\n\n> **Warning**: Inline image limit exceeded.\n"
        return new_text

    def first_pass_payload(self) -> dict:
        return {
            "FIELD_NOTES_PREVIEW": self.md,
            "FIELD_NOTES_INSTRUCTIONS": _INSTR,
            "FIELD_NOTES_LEVEL": self.level,
        }

    def maybe_apply_diff(self, diff: str) -> PatchResult:
        try:
            new_md = patch.apply(self.md, diff)
        except Exception as exc:
            logging.error("Field-notes patch failed: %s", exc)
            return PatchResult(False, 0)
        if new_md != self.md:
            stamp = f"\n<!-- updated: {_timestamp()} -->\n"
            new_md += stamp
            new_md = self.autolink_filenames(new_md, self.path.parent)
            md_store.atomic_write(self.path, new_md)
            lines_added = new_md.count("\n") - self.md.count("\n")
            self.md = new_md
            return PatchResult(True, lines_added)
        return PatchResult(False, 0)
```

### File: ./.DS_Store
```
(File type is application/octet-stream — skipping raw dump.)
```

### File: ./requirements.txt
```
patch-ng>=1.17
```

### File: ./CHANGELOG.md
```
# Changelog

## v0.9
- Field-notes Act II flow, linked citations.

```

### File: ./package-lock.json.orig
```
{
  "name": "photo-select",
  "version": "0.1.1",
  "lockfileVersion": 3,
  "requires": true,
  "packages": {
    "": {
      "name": "photo-select",
      "version": "0.1.1",
      "license": "MIT",
      "dependencies": {
        "commander": "^12.0.0",
        "diff": "^8.0.2",
        "dotenv": "^16.5.0",
        "handlebars": "^4.7.8",
        "openai": "^4.0.0",
        "sharp": "^0.34.2",
        "zod": "^3.23.8"
      },
      "bin": {
        "photo-select": "src/index.js"
      },
      "devDependencies": {
        "better-sqlite3": "^9.0.0",
        "vitest": "^1.5.0",
        "zod-to-json-schema": "^3.24.6"
      },
      "engines": {
        "node": ">=20"
      }
    },
    "node_modules/@emnapi/runtime": {
      "version": "1.4.3",
      "resolved": "https://registry.npmjs.org/@emnapi/runtime/-/runtime-1.4.3.tgz",
      "integrity": "sha512-pBPWdu6MLKROBX05wSNKcNb++m5Er+KQ9QkB+WVM+pW2Kx9hoSrVTnu3BdkI5eBLZoKu/J6mW/B6i6bJB2ytXQ==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "tslib": "^2.4.0"
      }
    },
    "node_modules/@esbuild/aix-ppc64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/aix-ppc64/-/aix-ppc64-0.21.5.tgz",
      "integrity": "sha512-1SDgH6ZSPTlggy1yI6+Dbkiz8xzpHJEVAlF/AM1tHPLsf5STom9rwtjE4hKAF20FfXXNTFqEYXyJNWh1GiZedQ==",
      "cpu": [
        "ppc64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "aix"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/android-arm": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/android-arm/-/android-arm-0.21.5.tgz",
      "integrity": "sha512-vCPvzSjpPHEi1siZdlvAlsPxXl7WbOVUBBAowWug4rJHb68Ox8KualB+1ocNvT5fjv6wpkX6o/iEpbDrf68zcg==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/android-arm64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/android-arm64/-/android-arm64-0.21.5.tgz",
      "integrity": "sha512-c0uX9VAUBQ7dTDCjq+wdyGLowMdtR/GoC2U5IYk/7D1H1JYC0qseD7+11iMP2mRLN9RcCMRcjC4YMclCzGwS/A==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/android-x64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/android-x64/-/android-x64-0.21.5.tgz",
      "integrity": "sha512-D7aPRUUNHRBwHxzxRvp856rjUHRFW1SdQATKXH2hqA0kAZb1hKmi02OpYRacl0TxIGz/ZmXWlbZgjwWYaCakTA==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/darwin-arm64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/darwin-arm64/-/darwin-arm64-0.21.5.tgz",
      "integrity": "sha512-DwqXqZyuk5AiWWf3UfLiRDJ5EDd49zg6O9wclZ7kUMv2WRFr4HKjXp/5t8JZ11QbQfUS6/cRCKGwYhtNAY88kQ==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/darwin-x64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/darwin-x64/-/darwin-x64-0.21.5.tgz",
      "integrity": "sha512-se/JjF8NlmKVG4kNIuyWMV/22ZaerB+qaSi5MdrXtd6R08kvs2qCN4C09miupktDitvh8jRFflwGFBQcxZRjbw==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/freebsd-arm64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/freebsd-arm64/-/freebsd-arm64-0.21.5.tgz",
      "integrity": "sha512-5JcRxxRDUJLX8JXp/wcBCy3pENnCgBR9bN6JsY4OmhfUtIHe3ZW0mawA7+RDAcMLrMIZaf03NlQiX9DGyB8h4g==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "freebsd"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/freebsd-x64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/freebsd-x64/-/freebsd-x64-0.21.5.tgz",
      "integrity": "sha512-J95kNBj1zkbMXtHVH29bBriQygMXqoVQOQYA+ISs0/2l3T9/kj42ow2mpqerRBxDJnmkUDCaQT/dfNXWX/ZZCQ==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "freebsd"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/linux-arm": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-arm/-/linux-arm-0.21.5.tgz",
      "integrity": "sha512-bPb5AHZtbeNGjCKVZ9UGqGwo8EUu4cLq68E95A53KlxAPRmUyYv2D6F0uUI65XisGOL1hBP5mTronbgo+0bFcA==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/linux-arm64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-arm64/-/linux-arm64-0.21.5.tgz",
      "integrity": "sha512-ibKvmyYzKsBeX8d8I7MH/TMfWDXBF3db4qM6sy+7re0YXya+K1cem3on9XgdT2EQGMu4hQyZhan7TeQ8XkGp4Q==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/linux-ia32": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-ia32/-/linux-ia32-0.21.5.tgz",
      "integrity": "sha512-YvjXDqLRqPDl2dvRODYmmhz4rPeVKYvppfGYKSNGdyZkA01046pLWyRKKI3ax8fbJoK5QbxblURkwK/MWY18Tg==",
      "cpu": [
        "ia32"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/linux-loong64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-loong64/-/linux-loong64-0.21.5.tgz",
      "integrity": "sha512-uHf1BmMG8qEvzdrzAqg2SIG/02+4/DHB6a9Kbya0XDvwDEKCoC8ZRWI5JJvNdUjtciBGFQ5PuBlpEOXQj+JQSg==",
      "cpu": [
        "loong64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/linux-mips64el": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-mips64el/-/linux-mips64el-0.21.5.tgz",
      "integrity": "sha512-IajOmO+KJK23bj52dFSNCMsz1QP1DqM6cwLUv3W1QwyxkyIWecfafnI555fvSGqEKwjMXVLokcV5ygHW5b3Jbg==",
      "cpu": [
        "mips64el"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/linux-ppc64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-ppc64/-/linux-ppc64-0.21.5.tgz",
      "integrity": "sha512-1hHV/Z4OEfMwpLO8rp7CvlhBDnjsC3CttJXIhBi+5Aj5r+MBvy4egg7wCbe//hSsT+RvDAG7s81tAvpL2XAE4w==",
      "cpu": [
        "ppc64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/linux-riscv64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-riscv64/-/linux-riscv64-0.21.5.tgz",
      "integrity": "sha512-2HdXDMd9GMgTGrPWnJzP2ALSokE/0O5HhTUvWIbD3YdjME8JwvSCnNGBnTThKGEB91OZhzrJ4qIIxk/SBmyDDA==",
      "cpu": [
        "riscv64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/linux-s390x": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-s390x/-/linux-s390x-0.21.5.tgz",
      "integrity": "sha512-zus5sxzqBJD3eXxwvjN1yQkRepANgxE9lgOW2qLnmr8ikMTphkjgXu1HR01K4FJg8h1kEEDAqDcZQtbrRnB41A==",
      "cpu": [
        "s390x"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/linux-x64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-x64/-/linux-x64-0.21.5.tgz",
      "integrity": "sha512-1rYdTpyv03iycF1+BhzrzQJCdOuAOtaqHTWJZCWvijKD2N5Xu0TtVC8/+1faWqcP9iBCWOmjmhoH94dH82BxPQ==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/netbsd-x64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/netbsd-x64/-/netbsd-x64-0.21.5.tgz",
      "integrity": "sha512-Woi2MXzXjMULccIwMnLciyZH4nCIMpWQAs049KEeMvOcNADVxo0UBIQPfSmxB3CWKedngg7sWZdLvLczpe0tLg==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "netbsd"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/openbsd-x64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/openbsd-x64/-/openbsd-x64-0.21.5.tgz",
      "integrity": "sha512-HLNNw99xsvx12lFBUwoT8EVCsSvRNDVxNpjZ7bPn947b8gJPzeHWyNVhFsaerc0n3TsbOINvRP2byTZ5LKezow==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "openbsd"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/sunos-x64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/sunos-x64/-/sunos-x64-0.21.5.tgz",
      "integrity": "sha512-6+gjmFpfy0BHU5Tpptkuh8+uw3mnrvgs+dSPQXQOv3ekbordwnzTVEb4qnIvQcYXq6gzkyTnoZ9dZG+D4garKg==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "sunos"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/win32-arm64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/win32-arm64/-/win32-arm64-0.21.5.tgz",
      "integrity": "sha512-Z0gOTd75VvXqyq7nsl93zwahcTROgqvuAcYDUr+vOv8uHhNSKROyU961kgtCD1e95IqPKSQKH7tBTslnS3tA8A==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/win32-ia32": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/win32-ia32/-/win32-ia32-0.21.5.tgz",
      "integrity": "sha512-SWXFF1CL2RVNMaVs+BBClwtfZSvDgtL//G/smwAc5oVK/UPu2Gu9tIaRgFmYFFKrmg3SyAjSrElf0TiJ1v8fYA==",
      "cpu": [
        "ia32"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/win32-x64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/win32-x64/-/win32-x64-0.21.5.tgz",
      "integrity": "sha512-tQd/1efJuzPC6rCFwEvLtci/xNFcTZknmXs98FYDfGE4wP9ClFV98nyKrzJKVPMhdDnjzLhdUyMX4PsQAPjwIw==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@img/sharp-darwin-arm64": {
      "version": "0.34.2",
      "resolved": "https://registry.npmjs.org/@img/sharp-darwin-arm64/-/sharp-darwin-arm64-0.34.2.tgz",
      "integrity": "sha512-OfXHZPppddivUJnqyKoi5YVeHRkkNE2zUFT2gbpKxp/JZCFYEYubnMg+gOp6lWfasPrTS+KPosKqdI+ELYVDtg==",
      "cpu": [
        "arm64"
      ],
      "license": "Apache-2.0",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-libvips-darwin-arm64": "1.1.0"
      }
    },
    "node_modules/@img/sharp-darwin-x64": {
      "version": "0.34.2",
      "resolved": "https://registry.npmjs.org/@img/sharp-darwin-x64/-/sharp-darwin-x64-0.34.2.tgz",
      "integrity": "sha512-dYvWqmjU9VxqXmjEtjmvHnGqF8GrVjM2Epj9rJ6BUIXvk8slvNDJbhGFvIoXzkDhrJC2jUxNLz/GUjjvSzfw+g==",
      "cpu": [
        "x64"
      ],
      "license": "Apache-2.0",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-libvips-darwin-x64": "1.1.0"
      }
    },
    "node_modules/@img/sharp-libvips-darwin-arm64": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-darwin-arm64/-/sharp-libvips-darwin-arm64-1.1.0.tgz",
      "integrity": "sha512-HZ/JUmPwrJSoM4DIQPv/BfNh9yrOA8tlBbqbLz4JZ5uew2+o22Ik+tHQJcih7QJuSa0zo5coHTfD5J8inqj9DA==",
      "cpu": [
        "arm64"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "darwin"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-libvips-darwin-x64": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-darwin-x64/-/sharp-libvips-darwin-x64-1.1.0.tgz",
      "integrity": "sha512-Xzc2ToEmHN+hfvsl9wja0RlnXEgpKNmftriQp6XzY/RaSfwD9th+MSh0WQKzUreLKKINb3afirxW7A0fz2YWuQ==",
      "cpu": [
        "x64"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "darwin"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-libvips-linux-arm": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linux-arm/-/sharp-libvips-linux-arm-1.1.0.tgz",
      "integrity": "sha512-s8BAd0lwUIvYCJyRdFqvsj+BJIpDBSxs6ivrOPm/R7piTs5UIwY5OjXrP2bqXC9/moGsyRa37eYWYCOGVXxVrA==",
      "cpu": [
        "arm"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "linux"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-libvips-linux-arm64": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linux-arm64/-/sharp-libvips-linux-arm64-1.1.0.tgz",
      "integrity": "sha512-IVfGJa7gjChDET1dK9SekxFFdflarnUB8PwW8aGwEoF3oAsSDuNUTYS+SKDOyOJxQyDC1aPFMuRYLoDInyV9Ew==",
      "cpu": [
        "arm64"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "linux"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-libvips-linux-ppc64": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linux-ppc64/-/sharp-libvips-linux-ppc64-1.1.0.tgz",
      "integrity": "sha512-tiXxFZFbhnkWE2LA8oQj7KYR+bWBkiV2nilRldT7bqoEZ4HiDOcePr9wVDAZPi/Id5fT1oY9iGnDq20cwUz8lQ==",
      "cpu": [
        "ppc64"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "linux"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-libvips-linux-s390x": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linux-s390x/-/sharp-libvips-linux-s390x-1.1.0.tgz",
      "integrity": "sha512-xukSwvhguw7COyzvmjydRb3x/09+21HykyapcZchiCUkTThEQEOMtBj9UhkaBRLuBrgLFzQ2wbxdeCCJW/jgJA==",
      "cpu": [
        "s390x"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "linux"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-libvips-linux-x64": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linux-x64/-/sharp-libvips-linux-x64-1.1.0.tgz",
      "integrity": "sha512-yRj2+reB8iMg9W5sULM3S74jVS7zqSzHG3Ol/twnAAkAhnGQnpjj6e4ayUz7V+FpKypwgs82xbRdYtchTTUB+Q==",
      "cpu": [
        "x64"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "linux"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-libvips-linuxmusl-arm64": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linuxmusl-arm64/-/sharp-libvips-linuxmusl-arm64-1.1.0.tgz",
      "integrity": "sha512-jYZdG+whg0MDK+q2COKbYidaqW/WTz0cc1E+tMAusiDygrM4ypmSCjOJPmFTvHHJ8j/6cAGyeDWZOsK06tP33w==",
      "cpu": [
        "arm64"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "linux"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-libvips-linuxmusl-x64": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linuxmusl-x64/-/sharp-libvips-linuxmusl-x64-1.1.0.tgz",
      "integrity": "sha512-wK7SBdwrAiycjXdkPnGCPLjYb9lD4l6Ze2gSdAGVZrEL05AOUJESWU2lhlC+Ffn5/G+VKuSm6zzbQSzFX/P65A==",
      "cpu": [
        "x64"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "linux"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-linux-arm": {
      "version": "0.34.2",
      "resolved": "https://registry.npmjs.org/@img/sharp-linux-arm/-/sharp-linux-arm-0.34.2.tgz",
      "integrity": "sha512-0DZzkvuEOqQUP9mo2kjjKNok5AmnOr1jB2XYjkaoNRwpAYMDzRmAqUIa1nRi58S2WswqSfPOWLNOr0FDT3H5RQ==",
      "cpu": [
        "arm"
      ],
      "license": "Apache-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-libvips-linux-arm": "1.1.0"
      }
    },
    "node_modules/@img/sharp-linux-arm64": {
      "version": "0.34.2",
      "resolved": "https://registry.npmjs.org/@img/sharp-linux-arm64/-/sharp-linux-arm64-0.34.2.tgz",
      "integrity": "sha512-D8n8wgWmPDakc83LORcfJepdOSN6MvWNzzz2ux0MnIbOqdieRZwVYY32zxVx+IFUT8er5KPcyU3XXsn+GzG/0Q==",
      "cpu": [
        "arm64"
      ],
      "license": "Apache-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-libvips-linux-arm64": "1.1.0"
      }
    },
    "node_modules/@img/sharp-linux-s390x": {
      "version": "0.34.2",
      "resolved": "https://registry.npmjs.org/@img/sharp-linux-s390x/-/sharp-linux-s390x-0.34.2.tgz",
      "integrity": "sha512-EGZ1xwhBI7dNISwxjChqBGELCWMGDvmxZXKjQRuqMrakhO8QoMgqCrdjnAqJq/CScxfRn+Bb7suXBElKQpPDiw==",
      "cpu": [
        "s390x"
      ],
      "license": "Apache-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-libvips-linux-s390x": "1.1.0"
      }
    },
    "node_modules/@img/sharp-linux-x64": {
      "version": "0.34.2",
      "resolved": "https://registry.npmjs.org/@img/sharp-linux-x64/-/sharp-linux-x64-0.34.2.tgz",
      "integrity": "sha512-sD7J+h5nFLMMmOXYH4DD9UtSNBD05tWSSdWAcEyzqW8Cn5UxXvsHAxmxSesYUsTOBmUnjtxghKDl15EvfqLFbQ==",
      "cpu": [
        "x64"
      ],
      "license": "Apache-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-libvips-linux-x64": "1.1.0"
      }
    },
    "node_modules/@img/sharp-linuxmusl-arm64": {
      "version": "0.34.2",
      "resolved": "https://registry.npmjs.org/@img/sharp-linuxmusl-arm64/-/sharp-linuxmusl-arm64-0.34.2.tgz",
      "integrity": "sha512-NEE2vQ6wcxYav1/A22OOxoSOGiKnNmDzCYFOZ949xFmrWZOVII1Bp3NqVVpvj+3UeHMFyN5eP/V5hzViQ5CZNA==",
      "cpu": [
        "arm64"
      ],
      "license": "Apache-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-libvips-linuxmusl-arm64": "1.1.0"
      }
    },
    "node_modules/@img/sharp-linuxmusl-x64": {
      "version": "0.34.2",
      "resolved": "https://registry.npmjs.org/@img/sharp-linuxmusl-x64/-/sharp-linuxmusl-x64-0.34.2.tgz",
      "integrity": "sha512-DOYMrDm5E6/8bm/yQLCWyuDJwUnlevR8xtF8bs+gjZ7cyUNYXiSf/E8Kp0Ss5xasIaXSHzb888V1BE4i1hFhAA==",
      "cpu": [
        "x64"
      ],
      "license": "Apache-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-libvips-linuxmusl-x64": "1.1.0"
      }
    },
    "node_modules/@img/sharp-wasm32": {
      "version": "0.34.2",
      "resolved": "https://registry.npmjs.org/@img/sharp-wasm32/-/sharp-wasm32-0.34.2.tgz",
      "integrity": "sha512-/VI4mdlJ9zkaq53MbIG6rZY+QRN3MLbR6usYlgITEzi4Rpx5S6LFKsycOQjkOGmqTNmkIdLjEvooFKwww6OpdQ==",
      "cpu": [
        "wasm32"
      ],
      "license": "Apache-2.0 AND LGPL-3.0-or-later AND MIT",
      "optional": true,
      "dependencies": {
        "@emnapi/runtime": "^1.4.3"
      },
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-win32-arm64": {
      "version": "0.34.2",
      "resolved": "https://registry.npmjs.org/@img/sharp-win32-arm64/-/sharp-win32-arm64-0.34.2.tgz",
      "integrity": "sha512-cfP/r9FdS63VA5k0xiqaNaEoGxBg9k7uE+RQGzuK9fHt7jib4zAVVseR9LsE4gJcNWgT6APKMNnCcnyOtmSEUQ==",
      "cpu": [
        "arm64"
      ],
      "license": "Apache-2.0 AND LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-win32-ia32": {
      "version": "0.34.2",
      "resolved": "https://registry.npmjs.org/@img/sharp-win32-ia32/-/sharp-win32-ia32-0.34.2.tgz",
      "integrity": "sha512-QLjGGvAbj0X/FXl8n1WbtQ6iVBpWU7JO94u/P2M4a8CFYsvQi4GW2mRy/JqkRx0qpBzaOdKJKw8uc930EX2AHw==",
      "cpu": [
        "ia32"
      ],
      "license": "Apache-2.0 AND LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-win32-x64": {
      "version": "0.34.2",
      "resolved": "https://registry.npmjs.org/@img/sharp-win32-x64/-/sharp-win32-x64-0.34.2.tgz",
      "integrity": "sha512-aUdT6zEYtDKCaxkofmmJDJYGCf0+pJg3eU9/oBuqvEeoB9dKI6ZLc/1iLJCTuJQDO4ptntAlkUmHgGjyuobZbw==",
      "cpu": [
        "x64"
      ],
      "license": "Apache-2.0 AND LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@jest/schemas": {
      "version": "29.6.3",
      "resolved": "https://registry.npmjs.org/@jest/schemas/-/schemas-29.6.3.tgz",
      "integrity": "sha512-mo5j5X+jIZmJQveBKeS/clAueipV7KgiX1vMgCxam1RNYiqE1w62n0/tJJnHtjW8ZHcQco5gY85jA3mi0L+nSA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@sinclair/typebox": "^0.27.8"
      },
      "engines": {
        "node": "^14.15.0 || ^16.10.0 || >=18.0.0"
      }
    },
    "node_modules/@jridgewell/sourcemap-codec": {
      "version": "1.5.0",
      "resolved": "https://registry.npmjs.org/@jridgewell/sourcemap-codec/-/sourcemap-codec-1.5.0.tgz",
      "integrity": "sha512-gv3ZRaISU3fjPAgNsriBRqGWQL6quFx04YMPW/zD8XMLsU32mhCCbfbO6KZFLjvYpCZ8zyDEgqsgf+PwPaM7GQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@rollup/rollup-android-arm-eabi": {
      "version": "4.44.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-android-arm-eabi/-/rollup-android-arm-eabi-4.44.0.tgz",
      "integrity": "sha512-xEiEE5oDW6tK4jXCAyliuntGR+amEMO7HLtdSshVuhFnKTYoeYMyXQK7pLouAJJj5KHdwdn87bfHAR2nSdNAUA==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ]
    },
    "node_modules/@rollup/rollup-android-arm64": {
      "version": "4.44.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-android-arm64/-/rollup-android-arm64-4.44.0.tgz",
      "integrity": "sha512-uNSk/TgvMbskcHxXYHzqwiyBlJ/lGcv8DaUfcnNwict8ba9GTTNxfn3/FAoFZYgkaXXAdrAA+SLyKplyi349Jw==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ]
    },
    "node_modules/@rollup/rollup-darwin-arm64": {
      "version": "4.44.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-darwin-arm64/-/rollup-darwin-arm64-4.44.0.tgz",
      "integrity": "sha512-VGF3wy0Eq1gcEIkSCr8Ke03CWT+Pm2yveKLaDvq51pPpZza3JX/ClxXOCmTYYq3us5MvEuNRTaeyFThCKRQhOA==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ]
    },
    "node_modules/@rollup/rollup-darwin-x64": {
      "version": "4.44.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-darwin-x64/-/rollup-darwin-x64-4.44.0.tgz",
      "integrity": "sha512-fBkyrDhwquRvrTxSGH/qqt3/T0w5Rg0L7ZIDypvBPc1/gzjJle6acCpZ36blwuwcKD/u6oCE/sRWlUAcxLWQbQ==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ]
    },
    "node_modules/@rollup/rollup-freebsd-arm64": {
      "version": "4.44.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-freebsd-arm64/-/rollup-freebsd-arm64-4.44.0.tgz",
      "integrity": "sha512-u5AZzdQJYJXByB8giQ+r4VyfZP+walV+xHWdaFx/1VxsOn6eWJhK2Vl2eElvDJFKQBo/hcYIBg/jaKS8ZmKeNQ==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "freebsd"
      ]
    },
    "node_modules/@rollup/rollup-freebsd-x64": {
      "version": "4.44.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-freebsd-x64/-/rollup-freebsd-x64-4.44.0.tgz",
      "integrity": "sha512-qC0kS48c/s3EtdArkimctY7h3nHicQeEUdjJzYVJYR3ct3kWSafmn6jkNCA8InbUdge6PVx6keqjk5lVGJf99g==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "freebsd"
      ]
    },
    "node_modules/@rollup/rollup-linux-arm-gnueabihf": {
      "version": "4.44.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-arm-gnueabihf/-/rollup-linux-arm-gnueabihf-4.44.0.tgz",
      "integrity": "sha512-x+e/Z9H0RAWckn4V2OZZl6EmV0L2diuX3QB0uM1r6BvhUIv6xBPL5mrAX2E3e8N8rEHVPwFfz/ETUbV4oW9+lQ==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-arm-musleabihf": {
      "version": "4.44.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-arm-musleabihf/-/rollup-linux-arm-musleabihf-4.44.0.tgz",
      "integrity": "sha512-1exwiBFf4PU/8HvI8s80icyCcnAIB86MCBdst51fwFmH5dyeoWVPVgmQPcKrMtBQ0W5pAs7jBCWuRXgEpRzSCg==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-arm64-gnu": {
      "version": "4.44.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-arm64-gnu/-/rollup-linux-arm64-gnu-4.44.0.tgz",
      "integrity": "sha512-ZTR2mxBHb4tK4wGf9b8SYg0Y6KQPjGpR4UWwTFdnmjB4qRtoATZ5dWn3KsDwGa5Z2ZBOE7K52L36J9LueKBdOQ==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-arm64-musl": {
      "version": "4.44.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-arm64-musl/-/rollup-linux-arm64-musl-4.44.0.tgz",
      "integrity": "sha512-GFWfAhVhWGd4r6UxmnKRTBwP1qmModHtd5gkraeW2G490BpFOZkFtem8yuX2NyafIP/mGpRJgTJ2PwohQkUY/Q==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-loongarch64-gnu": {
      "version": "4.44.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-loongarch64-gnu/-/rollup-linux-loongarch64-gnu-4.44.0.tgz",
      "integrity": "sha512-xw+FTGcov/ejdusVOqKgMGW3c4+AgqrfvzWEVXcNP6zq2ue+lsYUgJ+5Rtn/OTJf7e2CbgTFvzLW2j0YAtj0Gg==",
      "cpu": [
        "loong64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-powerpc64le-gnu": {
      "version": "4.44.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-powerpc64le-gnu/-/rollup-linux-powerpc64le-gnu-4.44.0.tgz",
      "integrity": "sha512-bKGibTr9IdF0zr21kMvkZT4K6NV+jjRnBoVMt2uNMG0BYWm3qOVmYnXKzx7UhwrviKnmK46IKMByMgvpdQlyJQ==",
      "cpu": [
        "ppc64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-riscv64-gnu": {
      "version": "4.44.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-riscv64-gnu/-/rollup-linux-riscv64-gnu-4.44.0.tgz",
      "integrity": "sha512-vV3cL48U5kDaKZtXrti12YRa7TyxgKAIDoYdqSIOMOFBXqFj2XbChHAtXquEn2+n78ciFgr4KIqEbydEGPxXgA==",
      "cpu": [
        "riscv64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-riscv64-musl": {
      "version": "4.44.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-riscv64-musl/-/rollup-linux-riscv64-musl-4.44.0.tgz",
      "integrity": "sha512-TDKO8KlHJuvTEdfw5YYFBjhFts2TR0VpZsnLLSYmB7AaohJhM8ctDSdDnUGq77hUh4m/djRafw+9zQpkOanE2Q==",
      "cpu": [
        "riscv64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-s390x-gnu": {
      "version": "4.44.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-s390x-gnu/-/rollup-linux-s390x-gnu-4.44.0.tgz",
      "integrity": "sha512-8541GEyktXaw4lvnGp9m84KENcxInhAt6vPWJ9RodsB/iGjHoMB2Pp5MVBCiKIRxrxzJhGCxmNzdu+oDQ7kwRA==",
      "cpu": [
        "s390x"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-x64-gnu": {
      "version": "4.44.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-x64-gnu/-/rollup-linux-x64-gnu-4.44.0.tgz",
      "integrity": "sha512-iUVJc3c0o8l9Sa/qlDL2Z9UP92UZZW1+EmQ4xfjTc1akr0iUFZNfxrXJ/R1T90h/ILm9iXEY6+iPrmYB3pXKjw==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-x64-musl": {
      "version": "4.44.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-x64-musl/-/rollup-linux-x64-musl-4.44.0.tgz",
      "integrity": "sha512-PQUobbhLTQT5yz/SPg116VJBgz+XOtXt8D1ck+sfJJhuEsMj2jSej5yTdp8CvWBSceu+WW+ibVL6dm0ptG5fcA==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-win32-arm64-msvc": {
      "version": "4.44.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-win32-arm64-msvc/-/rollup-win32-arm64-msvc-4.44.0.tgz",
      "integrity": "sha512-M0CpcHf8TWn+4oTxJfh7LQuTuaYeXGbk0eageVjQCKzYLsajWS/lFC94qlRqOlyC2KvRT90ZrfXULYmukeIy7w==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ]
    },
    "node_modules/@rollup/rollup-win32-ia32-msvc": {
      "version": "4.44.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-win32-ia32-msvc/-/rollup-win32-ia32-msvc-4.44.0.tgz",
      "integrity": "sha512-3XJ0NQtMAXTWFW8FqZKcw3gOQwBtVWP/u8TpHP3CRPXD7Pd6s8lLdH3sHWh8vqKCyyiI8xW5ltJScQmBU9j7WA==",
      "cpu": [
        "ia32"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ]
    },
    "node_modules/@rollup/rollup-win32-x64-msvc": {
      "version": "4.44.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-win32-x64-msvc/-/rollup-win32-x64-msvc-4.44.0.tgz",
      "integrity": "sha512-Q2Mgwt+D8hd5FIPUuPDsvPR7Bguza6yTkJxspDGkZj7tBRn2y4KSWYuIXpftFSjBra76TbKerCV7rgFPQrn+wQ==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ]
    },
    "node_modules/@sinclair/typebox": {
      "version": "0.27.8",
      "resolved": "https://registry.npmjs.org/@sinclair/typebox/-/typebox-0.27.8.tgz",
      "integrity": "sha512-+Fj43pSMwJs4KRrH/938Uf+uAELIgVBmQzg/q1YG10djyfA3TnrU8N8XzqCh/okZdszqBQTZf96idMfE5lnwTA==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@types/estree": {
      "version": "1.0.8",
      "resolved": "https://registry.npmjs.org/@types/estree/-/estree-1.0.8.tgz",
      "integrity": "sha512-dWHzHa2WqEXI/O1E9OjrocMTKJl2mSrEolh1Iomrv6U+JuNwaHXsXx9bLu5gG7BUWFIN0skIQJQ/L1rIex4X6w==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@types/node": {
      "version": "18.19.112",
      "resolved": "https://registry.npmjs.org/@types/node/-/node-18.19.112.tgz",
      "integrity": "sha512-i+Vukt9POdS/MBI7YrrkkI5fMfwFtOjphSmt4WXYLfwqsfr6z/HdCx7LqT9M7JktGob8WNgj8nFB4TbGNE4Cog==",
      "license": "MIT",
      "dependencies": {
        "undici-types": "~5.26.4"
      }
    },
    "node_modules/@types/node-fetch": {
      "version": "2.6.12",
      "resolved": "https://registry.npmjs.org/@types/node-fetch/-/node-fetch-2.6.12.tgz",
      "integrity": "sha512-8nneRWKCg3rMtF69nLQJnOYUcbafYeFSjqkw3jCRLsqkWFlHaoQrr5mXmofFGOx3DKn7UfmBMyov8ySvLRVldA==",
      "license": "MIT",
      "dependencies": {
        "@types/node": "*",
        "form-data": "^4.0.0"
      }
    },
    "node_modules/@vitest/expect": {
      "version": "1.6.1",
      "resolved": "https://registry.npmjs.org/@vitest/expect/-/expect-1.6.1.tgz",
      "integrity": "sha512-jXL+9+ZNIJKruofqXuuTClf44eSpcHlgj3CiuNihUF3Ioujtmc0zIa3UJOW5RjDK1YLBJZnWBlPuqhYycLioog==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@vitest/spy": "1.6.1",
        "@vitest/utils": "1.6.1",
        "chai": "^4.3.10"
      },
      "funding": {
        "url": "https://opencollective.com/vitest"
      }
    },
    "node_modules/@vitest/runner": {
      "version": "1.6.1",
      "resolved": "https://registry.npmjs.org/@vitest/runner/-/runner-1.6.1.tgz",
      "integrity": "sha512-3nSnYXkVkf3mXFfE7vVyPmi3Sazhb/2cfZGGs0JRzFsPFvAMBEcrweV1V1GsrstdXeKCTXlJbvnQwGWgEIHmOA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@vitest/utils": "1.6.1",
        "p-limit": "^5.0.0",
        "pathe": "^1.1.1"
      },
      "funding": {
        "url": "https://opencollective.com/vitest"
      }
    },
    "node_modules/@vitest/snapshot": {
      "version": "1.6.1",
      "resolved": "https://registry.npmjs.org/@vitest/snapshot/-/snapshot-1.6.1.tgz",
      "integrity": "sha512-WvidQuWAzU2p95u8GAKlRMqMyN1yOJkGHnx3M1PL9Raf7AQ1kwLKg04ADlCa3+OXUZE7BceOhVZiuWAbzCKcUQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "magic-string": "^0.30.5",
        "pathe": "^1.1.1",
        "pretty-format": "^29.7.0"
      },
      "funding": {
        "url": "https://opencollective.com/vitest"
      }
    },
    "node_modules/@vitest/spy": {
      "version": "1.6.1",
      "resolved": "https://registry.npmjs.org/@vitest/spy/-/spy-1.6.1.tgz",
      "integrity": "sha512-MGcMmpGkZebsMZhbQKkAf9CX5zGvjkBTqf8Zx3ApYWXr3wG+QvEu2eXWfnIIWYSJExIp4V9FCKDEeygzkYrXMw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "tinyspy": "^2.2.0"
      },
      "funding": {
        "url": "https://opencollective.com/vitest"
      }
    },
    "node_modules/@vitest/utils": {
      "version": "1.6.1",
      "resolved": "https://registry.npmjs.org/@vitest/utils/-/utils-1.6.1.tgz",
      "integrity": "sha512-jOrrUvXM4Av9ZWiG1EajNto0u96kWAhJ1LmPmJhXXQx/32MecEKd10pOLYgS2BQx1TgkGhloPU1ArDW2vvaY6g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "diff-sequences": "^29.6.3",
        "estree-walker": "^3.0.3",
        "loupe": "^2.3.7",
        "pretty-format": "^29.7.0"
      },
      "funding": {
        "url": "https://opencollective.com/vitest"
      }
    },
    "node_modules/abort-controller": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/abort-controller/-/abort-controller-3.0.0.tgz",
      "integrity": "sha512-h8lQ8tacZYnR3vNQTgibj+tODHI5/+l06Au2Pcriv/Gmet0eaj4TwWH41sO9wnHDiQsEj19q0drzdWdeAHtweg==",
      "license": "MIT",
      "dependencies": {
        "event-target-shim": "^5.0.0"
      },
      "engines": {
        "node": ">=6.5"
      }
    },
    "node_modules/acorn": {
      "version": "8.15.0",
      "resolved": "https://registry.npmjs.org/acorn/-/acorn-8.15.0.tgz",
      "integrity": "sha512-NZyJarBfL7nWwIq+FDL6Zp/yHEhePMNnnJ0y3qfieCrmNvYct8uvtiV41UvlSe6apAfk0fY1FbWx+NwfmpvtTg==",
      "dev": true,
      "license": "MIT",
      "bin": {
        "acorn": "bin/acorn"
      },
      "engines": {
        "node": ">=0.4.0"
      }
    },
    "node_modules/acorn-walk": {
      "version": "8.3.4",
      "resolved": "https://registry.npmjs.org/acorn-walk/-/acorn-walk-8.3.4.tgz",
      "integrity": "sha512-ueEepnujpqee2o5aIYnvHU6C0A42MNdsIDeqy5BydrkuC5R1ZuUFnm27EeFJGoEHJQgn3uleRvmTXaJgfXbt4g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "acorn": "^8.11.0"
      },
      "engines": {
        "node": ">=0.4.0"
      }
    },
    "node_modules/agentkeepalive": {
      "version": "4.6.0",
      "resolved": "https://registry.npmjs.org/agentkeepalive/-/agentkeepalive-4.6.0.tgz",
      "integrity": "sha512-kja8j7PjmncONqaTsB8fQ+wE2mSU2DJ9D4XKoJ5PFWIdRMa6SLSN1ff4mOr4jCbfRSsxR4keIiySJU0N9T5hIQ==",
      "license": "MIT",
      "dependencies": {
        "humanize-ms": "^1.2.1"
      },
      "engines": {
        "node": ">= 8.0.0"
      }
    },
    "node_modules/ansi-styles": {
      "version": "5.2.0",
      "resolved": "https://registry.npmjs.org/ansi-styles/-/ansi-styles-5.2.0.tgz",
      "integrity": "sha512-Cxwpt2SfTzTtXcfOlzGEee8O+c+MmUgGrNiBcXnuWxuFJHe6a5Hz7qwhwe5OgaSYI0IJvkLqWX1ASG+cJOkEiA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/chalk/ansi-styles?sponsor=1"
      }
    },
    "node_modules/assertion-error": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/assertion-error/-/assertion-error-1.1.0.tgz",
      "integrity": "sha512-jgsaNduz+ndvGyFt3uSuWqvy4lCnIJiovtouQN5JZHOKCS2QuhEdbcQHFhVksz2N2U9hXJo8odG7ETyWlEeuDw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "*"
      }
    },
    "node_modules/asynckit": {
      "version": "0.4.0",
      "resolved": "https://registry.npmjs.org/asynckit/-/asynckit-0.4.0.tgz",
      "integrity": "sha512-Oei9OH4tRh0YqU3GxhX79dM/mwVgvbZJaSNaRk+bshkj0S5cfHcgYakreBjrHwatXKbz+IoIdYLxrKim2MjW0Q==",
      "license": "MIT"
    },
    "node_modules/base64-js": {
      "version": "1.5.1",
      "resolved": "https://registry.npmjs.org/base64-js/-/base64-js-1.5.1.tgz",
      "integrity": "sha512-AKpaYlHn8t4SVbOHCy+b5+KKgvR4vrsD8vbvrbiQJps7fKDTkjkDry6ji0rUJjC0kzbNePLwzxq8iypo41qeWA==",
      "dev": true,
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/feross"
        },
        {
          "type": "patreon",
          "url": "https://www.patreon.com/feross"
        },
        {
          "type": "consulting",
          "url": "https://feross.org/support"
        }
      ],
      "license": "MIT"
    },
    "node_modules/better-sqlite3": {
      "version": "9.6.0",
      "resolved": "https://registry.npmjs.org/better-sqlite3/-/better-sqlite3-9.6.0.tgz",
      "integrity": "sha512-yR5HATnqeYNVnkaUTf4bOP2dJSnyhP4puJN/QPRyx4YkBEEUxib422n2XzPqDEHjQQqazoYoADdAm5vE15+dAQ==",
      "dev": true,
      "hasInstallScript": true,
      "license": "MIT",
      "dependencies": {
        "bindings": "^1.5.0",
        "prebuild-install": "^7.1.1"
      }
    },
    "node_modules/bindings": {
      "version": "1.5.0",
      "resolved": "https://registry.npmjs.org/bindings/-/bindings-1.5.0.tgz",
      "integrity": "sha512-p2q/t/mhvuOj/UeLlV6566GD/guowlr0hHxClI0W9m7MWYkL1F0hLo+0Aexs9HSPCtR1SXQ0TD3MMKrXZajbiQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "file-uri-to-path": "1.0.0"
      }
    },
    "node_modules/bl": {
      "version": "4.1.0",
      "resolved": "https://registry.npmjs.org/bl/-/bl-4.1.0.tgz",
      "integrity": "sha512-1W07cM9gS6DcLperZfFSj+bWLtaPGSOHWhPiGzXmvVJbRLdG82sH/Kn8EtW1VqWVA54AKf2h5k5BbnIbwF3h6w==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "buffer": "^5.5.0",
        "inherits": "^2.0.4",
        "readable-stream": "^3.4.0"
      }
    },
    "node_modules/buffer": {
      "version": "5.7.1",
      "resolved": "https://registry.npmjs.org/buffer/-/buffer-5.7.1.tgz",
      "integrity": "sha512-EHcyIPBQ4BSGlvjB16k5KgAJ27CIsHY/2JBmCRReo48y9rQ3MaUzWX3KVlBa4U7MyX02HdVj0K7C3WaB3ju7FQ==",
      "dev": true,
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/feross"
        },
        {
          "type": "patreon",
          "url": "https://www.patreon.com/feross"
        },
        {
          "type": "consulting",
          "url": "https://feross.org/support"
        }
      ],
      "license": "MIT",
      "dependencies": {
        "base64-js": "^1.3.1",
        "ieee754": "^1.1.13"
      }
    },
    "node_modules/cac": {
      "version": "6.7.14",
      "resolved": "https://registry.npmjs.org/cac/-/cac-6.7.14.tgz",
      "integrity": "sha512-b6Ilus+c3RrdDk+JhLKUAQfzzgLEPy6wcXqS7f/xe1EETvsDP6GORG7SFuOs6cID5YkqchW/LXZbX5bc8j7ZcQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/call-bind-apply-helpers": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/call-bind-apply-helpers/-/call-bind-apply-helpers-1.0.2.tgz",
      "integrity": "sha512-Sp1ablJ0ivDkSzjcaJdxEunN5/XvksFJ2sMBFfq6x0ryhQV/2b/KwFe21cMpmHtPOSij8K99/wSfoEuTObmuMQ==",
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "function-bind": "^1.1.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/chai": {
      "version": "4.5.0",
      "resolved": "https://registry.npmjs.org/chai/-/chai-4.5.0.tgz",
      "integrity": "sha512-RITGBfijLkBddZvnn8jdqoTypxvqbOLYQkGGxXzeFjVHvudaPw0HNFD9x928/eUwYWd2dPCugVqspGALTZZQKw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "assertion-error": "^1.1.0",
        "check-error": "^1.0.3",
        "deep-eql": "^4.1.3",
        "get-func-name": "^2.0.2",
        "loupe": "^2.3.6",
        "pathval": "^1.1.1",
        "type-detect": "^4.1.0"
      },
      "engines": {
        "node": ">=4"
      }
    },
    "node_modules/check-error": {
      "version": "1.0.3",
      "resolved": "https://registry.npmjs.org/check-error/-/check-error-1.0.3.tgz",
      "integrity": "sha512-iKEoDYaRmd1mxM90a2OEfWhjsjPpYPuQ+lMYsoxB126+t8fw7ySEO48nmDg5COTjxDI65/Y2OWpeEHk3ZOe8zg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "get-func-name": "^2.0.2"
      },
      "engines": {
        "node": "*"
      }
    },
    "node_modules/chownr": {
      "version": "1.1.4",
      "resolved": "https://registry.npmjs.org/chownr/-/chownr-1.1.4.tgz",
      "integrity": "sha512-jJ0bqzaylmJtVnNgzTeSOs8DPavpbYgEr/b0YL8/2GO3xJEhInFmhKMUnEJQjZumK7KXGFhUy89PrsJWlakBVg==",
      "dev": true,
      "license": "ISC"
    },
    "node_modules/color": {
      "version": "4.2.3",
      "resolved": "https://registry.npmjs.org/color/-/color-4.2.3.tgz",
      "integrity": "sha512-1rXeuUUiGGrykh+CeBdu5Ie7OJwinCgQY0bc7GCRxy5xVHy+moaqkpL/jqQq0MtQOeYcrqEz4abc5f0KtU7W4A==",
      "license": "MIT",
      "dependencies": {
        "color-convert": "^2.0.1",
        "color-string": "^1.9.0"
      },
      "engines": {
        "node": ">=12.5.0"
      }
    },
    "node_modules/color-convert": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/color-convert/-/color-convert-2.0.1.tgz",
      "integrity": "sha512-RRECPsj7iu/xb5oKYcsFHSppFNnsj/52OVTRKb4zP5onXwVF3zVmmToNcOfGC+CRDpfK/U584fMg38ZHCaElKQ==",
      "license": "MIT",
      "dependencies": {
        "color-name": "~1.1.4"
      },
      "engines": {
        "node": ">=7.0.0"
      }
    },
    "node_modules/color-name": {
      "version": "1.1.4",
      "resolved": "https://registry.npmjs.org/color-name/-/color-name-1.1.4.tgz",
      "integrity": "sha512-dOy+3AuW3a2wNbZHIuMZpTcgjGuLU/uBL/ubcZF9OXbDo8ff4O8yVp5Bf0efS8uEoYo5q4Fx7dY9OgQGXgAsQA==",
      "license": "MIT"
    },
    "node_modules/color-string": {
      "version": "1.9.1",
      "resolved": "https://registry.npmjs.org/color-string/-/color-string-1.9.1.tgz",
      "integrity": "sha512-shrVawQFojnZv6xM40anx4CkoDP+fZsw/ZerEMsW/pyzsRbElpsL/DBVW7q3ExxwusdNXI3lXpuhEZkzs8p5Eg==",
      "license": "MIT",
      "dependencies": {
        "color-name": "^1.0.0",
        "simple-swizzle": "^0.2.2"
      }
    },
    "node_modules/combined-stream": {
      "version": "1.0.8",
      "resolved": "https://registry.npmjs.org/combined-stream/-/combined-stream-1.0.8.tgz",
      "integrity": "sha512-FQN4MRfuJeHf7cBbBMJFXhKSDq+2kAArBlmRBvcvFE5BB1HZKXtSFASDhdlz9zOYwxh8lDdnvmMOe/+5cdoEdg==",
      "license": "MIT",
      "dependencies": {
        "delayed-stream": "~1.0.0"
      },
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/commander": {
      "version": "12.1.0",
      "resolved": "https://registry.npmjs.org/commander/-/commander-12.1.0.tgz",
      "integrity": "sha512-Vw8qHK3bZM9y/P10u3Vib8o/DdkvA2OtPtZvD871QKjy74Wj1WSKFILMPRPSdUSx5RFK1arlJzEtA4PkFgnbuA==",
      "license": "MIT",
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/confbox": {
      "version": "0.1.8",
      "resolved": "https://registry.npmjs.org/confbox/-/confbox-0.1.8.tgz",
      "integrity": "sha512-RMtmw0iFkeR4YV+fUOSucriAQNb9g8zFR52MWCtl+cCZOFRNL6zeB395vPzFhEjjn4fMxXudmELnl/KF/WrK6w==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/cross-spawn": {
      "version": "7.0.6",
      "resolved": "https://registry.npmjs.org/cross-spawn/-/cross-spawn-7.0.6.tgz",
      "integrity": "sha512-uV2QOWP2nWzsy2aMp8aRibhi9dlzF5Hgh5SHaB9OiTGEyDTiJJyx0uy51QXdyWbtAHNua4XJzUKca3OzKUd3vA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "path-key": "^3.1.0",
        "shebang-command": "^2.0.0",
        "which": "^2.0.1"
      },
      "engines": {
        "node": ">= 8"
      }
    },
    "node_modules/debug": {
      "version": "4.4.1",
      "resolved": "https://registry.npmjs.org/debug/-/debug-4.4.1.tgz",
      "integrity": "sha512-KcKCqiftBJcZr++7ykoDIEwSa3XWowTfNPo92BYxjXiyYEVrUQh2aLyhxBCwww+heortUFxEJYcRzosstTEBYQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "ms": "^2.1.3"
      },
      "engines": {
        "node": ">=6.0"
      },
      "peerDependenciesMeta": {
        "supports-color": {
          "optional": true
        }
      }
    },
    "node_modules/decompress-response": {
      "version": "6.0.0",
      "resolved": "https://registry.npmjs.org/decompress-response/-/decompress-response-6.0.0.tgz",
      "integrity": "sha512-aW35yZM6Bb/4oJlZncMH2LCoZtJXTRxES17vE3hoRiowU2kWHaJKFkSBDnDR+cm9J+9QhXmREyIfv0pji9ejCQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "mimic-response": "^3.1.0"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/deep-eql": {
      "version": "4.1.4",
      "resolved": "https://registry.npmjs.org/deep-eql/-/deep-eql-4.1.4.tgz",
      "integrity": "sha512-SUwdGfqdKOwxCPeVYjwSyRpJ7Z+fhpwIAtmCUdZIWZ/YP5R9WAsyuSgpLVDi9bjWoN2LXHNss/dk3urXtdQxGg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "type-detect": "^4.0.0"
      },
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/deep-extend": {
      "version": "0.6.0",
      "resolved": "https://registry.npmjs.org/deep-extend/-/deep-extend-0.6.0.tgz",
      "integrity": "sha512-LOHxIOaPYdHlJRtCQfDIVZtfw/ufM8+rVj649RIHzcm/vGwQRXFt6OPqIFWsm2XEMrNIEtWR64sY1LEKD2vAOA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=4.0.0"
      }
    },
    "node_modules/delayed-stream": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/delayed-stream/-/delayed-stream-1.0.0.tgz",
      "integrity": "sha512-ZySD7Nf91aLB0RxL4KGrKHBXl7Eds1DAmEdcoVawXnLD7SDhpNgtuII2aAkg7a7QS41jxPSZ17p4VdGnMHk3MQ==",
      "license": "MIT",
      "engines": {
        "node": ">=0.4.0"
      }
    },
    "node_modules/detect-libc": {
      "version": "2.0.4",
      "resolved": "https://registry.npmjs.org/detect-libc/-/detect-libc-2.0.4.tgz",
      "integrity": "sha512-3UDv+G9CsCKO1WKMGw9fwq/SWJYbI0c5Y7LU1AXYoDdbhE2AHQ6N6Nb34sG8Fj7T5APy8qXDCKuuIHd1BR0tVA==",
      "license": "Apache-2.0",
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/diff": {
      "version": "8.0.2",
      "resolved": "https://registry.npmjs.org/diff/-/diff-8.0.2.tgz",
      "integrity": "sha512-sSuxWU5j5SR9QQji/o2qMvqRNYRDOcBTgsJ/DeCf4iSN4gW+gNMXM7wFIP+fdXZxoNiAnHUTGjCr+TSWXdRDKg==",
      "license": "BSD-3-Clause",
      "engines": {
        "node": ">=0.3.1"
      }
    },
    "node_modules/diff-sequences": {
      "version": "29.6.3",
      "resolved": "https://registry.npmjs.org/diff-sequences/-/diff-sequences-29.6.3.tgz",
      "integrity": "sha512-EjePK1srD3P08o2j4f0ExnylqRs5B9tJjcp9t1krH2qRi8CCdsYfwe9JgSLurFBWwq4uOlipzfk5fHNvwFKr8Q==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "^14.15.0 || ^16.10.0 || >=18.0.0"
      }
    },
    "node_modules/dotenv": {
      "version": "16.5.0",
      "resolved": "https://registry.npmjs.org/dotenv/-/dotenv-16.5.0.tgz",
      "integrity": "sha512-m/C+AwOAr9/W1UOIZUo232ejMNnJAJtYQjUbHoNTBNTJSvqzzDh7vnrei3o3r3m9blf6ZoDkvcw0VmozNRFJxg==",
      "license": "BSD-2-Clause",
      "engines": {
        "node": ">=12"
      },
      "funding": {
        "url": "https://dotenvx.com"
      }
    },
    "node_modules/dunder-proto": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/dunder-proto/-/dunder-proto-1.0.1.tgz",
      "integrity": "sha512-KIN/nDJBQRcXw0MLVhZE9iQHmG68qAVIBg9CqmUYjmQIhgij9U5MFvrqkUL5FbtyyzZuOeOt0zdeRe4UY7ct+A==",
      "license": "MIT",
      "dependencies": {
        "call-bind-apply-helpers": "^1.0.1",
        "es-errors": "^1.3.0",
        "gopd": "^1.2.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/end-of-stream": {
      "version": "1.4.5",
      "resolved": "https://registry.npmjs.org/end-of-stream/-/end-of-stream-1.4.5.tgz",
      "integrity": "sha512-ooEGc6HP26xXq/N+GCGOT0JKCLDGrq2bQUZrQ7gyrJiZANJ/8YDTxTpQBXGMn+WbIQXNVpyWymm7KYVICQnyOg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "once": "^1.4.0"
      }
    },
    "node_modules/es-define-property": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/es-define-property/-/es-define-property-1.0.1.tgz",
      "integrity": "sha512-e3nRfgfUZ4rNGL232gUgX06QNyyez04KdjFrF+LTRoOXmrOgFKDg4BCdsjW8EnT69eqdYGmRpJwiPVYNrCaW3g==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-errors": {
      "version": "1.3.0",
      "resolved": "https://registry.npmjs.org/es-errors/-/es-errors-1.3.0.tgz",
      "integrity": "sha512-Zf5H2Kxt2xjTvbJvP2ZWLEICxA6j+hAmMzIlypy4xcBg1vKVnx89Wy0GbS+kf5cwCVFFzdCFh2XSCFNULS6csw==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-object-atoms": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/es-object-atoms/-/es-object-atoms-1.1.1.tgz",
      "integrity": "sha512-FGgH2h8zKNim9ljj7dankFPcICIK9Cp5bm+c2gQSYePhpaG5+esrLODihIorn+Pe6FGJzWhXQotPv73jTaldXA==",
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-set-tostringtag": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/es-set-tostringtag/-/es-set-tostringtag-2.1.0.tgz",
      "integrity": "sha512-j6vWzfrGVfyXxge+O0x5sh6cvxAog0a/4Rdd2K36zCMV5eJ+/+tOAngRO8cODMNWbVRdVlmGZQL2YS3yR8bIUA==",
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "get-intrinsic": "^1.2.6",
        "has-tostringtag": "^1.0.2",
        "hasown": "^2.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/esbuild": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/esbuild/-/esbuild-0.21.5.tgz",
      "integrity": "sha512-mg3OPMV4hXywwpoDxu3Qda5xCKQi+vCTZq8S9J/EpkhB2HzKXq4SNFZE3+NK93JYxc8VMSep+lOUSC/RVKaBqw==",
      "dev": true,
      "hasInstallScript": true,
      "license": "MIT",
      "bin": {
        "esbuild": "bin/esbuild"
      },
      "engines": {
        "node": ">=12"
      },
      "optionalDependencies": {
        "@esbuild/aix-ppc64": "0.21.5",
        "@esbuild/android-arm": "0.21.5",
        "@esbuild/android-arm64": "0.21.5",
        "@esbuild/android-x64": "0.21.5",
        "@esbuild/darwin-arm64": "0.21.5",
        "@esbuild/darwin-x64": "0.21.5",
        "@esbuild/freebsd-arm64": "0.21.5",
        "@esbuild/freebsd-x64": "0.21.5",
        "@esbuild/linux-arm": "0.21.5",
        "@esbuild/linux-arm64": "0.21.5",
        "@esbuild/linux-ia32": "0.21.5",
        "@esbuild/linux-loong64": "0.21.5",
        "@esbuild/linux-mips64el": "0.21.5",
        "@esbuild/linux-ppc64": "0.21.5",
        "@esbuild/linux-riscv64": "0.21.5",
        "@esbuild/linux-s390x": "0.21.5",
        "@esbuild/linux-x64": "0.21.5",
        "@esbuild/netbsd-x64": "0.21.5",
        "@esbuild/openbsd-x64": "0.21.5",
        "@esbuild/sunos-x64": "0.21.5",
        "@esbuild/win32-arm64": "0.21.5",
        "@esbuild/win32-ia32": "0.21.5",
        "@esbuild/win32-x64": "0.21.5"
      }
    },
    "node_modules/estree-walker": {
      "version": "3.0.3",
      "resolved": "https://registry.npmjs.org/estree-walker/-/estree-walker-3.0.3.tgz",
      "integrity": "sha512-7RUKfXgSMMkzt6ZuXmqapOurLGPPfgj6l9uRZ7lRGolvk0y2yocc35LdcxKC5PQZdn2DMqioAQ2NoWcrTKmm6g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@types/estree": "^1.0.0"
      }
    },
    "node_modules/event-target-shim": {
      "version": "5.0.1",
      "resolved": "https://registry.npmjs.org/event-target-shim/-/event-target-shim-5.0.1.tgz",
      "integrity": "sha512-i/2XbnSz/uxRCU6+NdVJgKWDTM427+MqYbkQzD321DuCQJUqOuJKIA0IM2+W2xtYHdKOmZ4dR6fExsd4SXL+WQ==",
      "license": "MIT",
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/execa": {
      "version": "8.0.1",
      "resolved": "https://registry.npmjs.org/execa/-/execa-8.0.1.tgz",
      "integrity": "sha512-VyhnebXciFV2DESc+p6B+y0LjSm0krU4OgJN44qFAhBY0TJ+1V61tYD2+wHusZ6F9n5K+vl8k0sTy7PEfV4qpg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "cross-spawn": "^7.0.3",
        "get-stream": "^8.0.1",
        "human-signals": "^5.0.0",
        "is-stream": "^3.0.0",
        "merge-stream": "^2.0.0",
        "npm-run-path": "^5.1.0",
        "onetime": "^6.0.0",
        "signal-exit": "^4.1.0",
        "strip-final-newline": "^3.0.0"
      },
      "engines": {
        "node": ">=16.17"
      },
      "funding": {
        "url": "https://github.com/sindresorhus/execa?sponsor=1"
      }
    },
    "node_modules/expand-template": {
      "version": "2.0.3",
      "resolved": "https://registry.npmjs.org/expand-template/-/expand-template-2.0.3.tgz",
      "integrity": "sha512-XYfuKMvj4O35f/pOXLObndIRvyQ+/+6AhODh+OKWj9S9498pHHn/IMszH+gt0fBCRWMNfk1ZSp5x3AifmnI2vg==",
      "dev": true,
      "license": "(MIT OR WTFPL)",
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/file-uri-to-path": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/file-uri-to-path/-/file-uri-to-path-1.0.0.tgz",
      "integrity": "sha512-0Zt+s3L7Vf1biwWZ29aARiVYLx7iMGnEUl9x33fbB/j3jR81u/O2LbqK+Bm1CDSNDKVtJ/YjwY7TUd5SkeLQLw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/form-data": {
      "version": "4.0.3",
      "resolved": "https://registry.npmjs.org/form-data/-/form-data-4.0.3.tgz",
      "integrity": "sha512-qsITQPfmvMOSAdeyZ+12I1c+CKSstAFAwu+97zrnWAbIr5u8wfsExUzCesVLC8NgHuRUqNN4Zy6UPWUTRGslcA==",
      "license": "MIT",
      "dependencies": {
        "asynckit": "^0.4.0",
        "combined-stream": "^1.0.8",
        "es-set-tostringtag": "^2.1.0",
        "hasown": "^2.0.2",
        "mime-types": "^2.1.12"
      },
      "engines": {
        "node": ">= 6"
      }
    },
    "node_modules/form-data-encoder": {
      "version": "1.7.2",
      "resolved": "https://registry.npmjs.org/form-data-encoder/-/form-data-encoder-1.7.2.tgz",
      "integrity": "sha512-qfqtYan3rxrnCk1VYaA4H+Ms9xdpPqvLZa6xmMgFvhO32x7/3J/ExcTd6qpxM0vH2GdMI+poehyBZvqfMTto8A==",
      "license": "MIT"
    },
    "node_modules/formdata-node": {
      "version": "4.4.1",
      "resolved": "https://registry.npmjs.org/formdata-node/-/formdata-node-4.4.1.tgz",
      "integrity": "sha512-0iirZp3uVDjVGt9p49aTaqjk84TrglENEDuqfdlZQ1roC9CWlPk6Avf8EEnZNcAqPonwkG35x4n3ww/1THYAeQ==",
      "license": "MIT",
      "dependencies": {
        "node-domexception": "1.0.0",
        "web-streams-polyfill": "4.0.0-beta.3"
      },
      "engines": {
        "node": ">= 12.20"
      }
    },
    "node_modules/fs-constants": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/fs-constants/-/fs-constants-1.0.0.tgz",
      "integrity": "sha512-y6OAwoSIf7FyjMIv94u+b5rdheZEjzR63GTyZJm5qh4Bi+2YgwLCcI/fPFZkL5PSixOt6ZNKm+w+Hfp/Bciwow==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/fsevents": {
      "version": "2.3.3",
      "resolved": "https://registry.npmjs.org/fsevents/-/fsevents-2.3.3.tgz",
      "integrity": "sha512-5xoDfX+fL7faATnagmWPpbFtwh/R77WmMMqqHGS65C3vvB0YHrgF+B1YmZ3441tMj5n63k0212XNoJwzlhffQw==",
      "dev": true,
      "hasInstallScript": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": "^8.16.0 || ^10.6.0 || >=11.0.0"
      }
    },
    "node_modules/function-bind": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/function-bind/-/function-bind-1.1.2.tgz",
      "integrity": "sha512-7XHNxH7qX9xG5mIwxkhumTox/MIRNcOgDrxWsMt2pAr23WHp6MrRlN7FBSFpCpr+oVO0F744iUgR82nJMfG2SA==",
      "license": "MIT",
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/get-func-name": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/get-func-name/-/get-func-name-2.0.2.tgz",
      "integrity": "sha512-8vXOvuE167CtIc3OyItco7N/dpRtBbYOsPsXCz7X/PMnlGjYjSGuZJgM1Y7mmew7BKf9BqvLX2tnOVy1BBUsxQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "*"
      }
    },
    "node_modules/get-intrinsic": {
      "version": "1.3.0",
      "resolved": "https://registry.npmjs.org/get-intrinsic/-/get-intrinsic-1.3.0.tgz",
      "integrity": "sha512-9fSjSaos/fRIVIp+xSJlE6lfwhES7LNtKaCBIamHsjr2na1BiABJPo0mOjjz8GJDURarmCPGqaiVg5mfjb98CQ==",
      "license": "MIT",
      "dependencies": {
        "call-bind-apply-helpers": "^1.0.2",
        "es-define-property": "^1.0.1",
        "es-errors": "^1.3.0",
        "es-object-atoms": "^1.1.1",
        "function-bind": "^1.1.2",
        "get-proto": "^1.0.1",
        "gopd": "^1.2.0",
        "has-symbols": "^1.1.0",
        "hasown": "^2.0.2",
        "math-intrinsics": "^1.1.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/get-proto": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/get-proto/-/get-proto-1.0.1.tgz",
      "integrity": "sha512-sTSfBjoXBp89JvIKIefqw7U2CCebsc74kiY6awiGogKtoSGbgjYE/G/+l9sF3MWFPNc9IcoOC4ODfKHfxFmp0g==",
      "license": "MIT",
      "dependencies": {
        "dunder-proto": "^1.0.1",
        "es-object-atoms": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/get-stream": {
      "version": "8.0.1",
      "resolved": "https://registry.npmjs.org/get-stream/-/get-stream-8.0.1.tgz",
      "integrity": "sha512-VaUJspBffn/LMCJVoMvSAdmscJyS1auj5Zulnn5UoYcY531UWmdwhRWkcGKnGU93m5HSXP9LP2usOryrBtQowA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=16"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/github-from-package": {
      "version": "0.0.0",
      "resolved": "https://registry.npmjs.org/github-from-package/-/github-from-package-0.0.0.tgz",
      "integrity": "sha512-SyHy3T1v2NUXn29OsWdxmK6RwHD+vkj3v8en8AOBZ1wBQ/hCAQ5bAQTD02kW4W9tUp/3Qh6J8r9EvntiyCmOOw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/gopd": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/gopd/-/gopd-1.2.0.tgz",
      "integrity": "sha512-ZUKRh6/kUFoAiTAtTYPZJ3hw9wNxx+BIBOijnlG9PnrJsCcSjs1wyyD6vJpaYtgnzDrKYRSqf3OO6Rfa93xsRg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/handlebars": {
      "version": "4.7.8",
      "resolved": "https://registry.npmjs.org/handlebars/-/handlebars-4.7.8.tgz",
      "integrity": "sha512-vafaFqs8MZkRrSX7sFVUdo3ap/eNiLnb4IakshzvP56X5Nr1iGKAIqdX6tMlm6HcNRIkr6AxO5jFEoJzzpT8aQ==",
      "license": "MIT",
      "dependencies": {
        "minimist": "^1.2.5",
        "neo-async": "^2.6.2",
        "source-map": "^0.6.1",
        "wordwrap": "^1.0.0"
      },
      "bin": {
        "handlebars": "bin/handlebars"
      },
      "engines": {
        "node": ">=0.4.7"
      },
      "optionalDependencies": {
        "uglify-js": "^3.1.4"
      }
    },
    "node_modules/has-symbols": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/has-symbols/-/has-symbols-1.1.0.tgz",
      "integrity": "sha512-1cDNdwJ2Jaohmb3sg4OmKaMBwuC48sYni5HUw2DvsC8LjGTLK9h+eb1X6RyuOHe4hT0ULCW68iomhjUoKUqlPQ==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/has-tostringtag": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/has-tostringtag/-/has-tostringtag-1.0.2.tgz",
      "integrity": "sha512-NqADB8VjPFLM2V0VvHUewwwsw0ZWBaIdgo+ieHtK3hasLz4qeCRjYcqfB6AQrBggRKppKF8L52/VqdVsO47Dlw==",
      "license": "MIT",
      "dependencies": {
        "has-symbols": "^1.0.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/hasown": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/hasown/-/hasown-2.0.2.tgz",
      "integrity": "sha512-0hJU9SCPvmMzIBdZFqNPXWa6dqh7WdH0cII9y+CyS8rG3nL48Bclra9HmKhVVUHyPWNH5Y7xDwAB7bfgSjkUMQ==",
      "license": "MIT",
      "dependencies": {
        "function-bind": "^1.1.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/human-signals": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/human-signals/-/human-signals-5.0.0.tgz",
      "integrity": "sha512-AXcZb6vzzrFAUE61HnN4mpLqd/cSIwNQjtNWR0euPm6y0iqx3G4gOXaIDdtdDwZmhwe82LA6+zinmW4UBWVePQ==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": ">=16.17.0"
      }
    },
    "node_modules/humanize-ms": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/humanize-ms/-/humanize-ms-1.2.1.tgz",
      "integrity": "sha512-Fl70vYtsAFb/C06PTS9dZBo7ihau+Tu/DNCk/OyHhea07S+aeMWpFFkUaXRa8fI+ScZbEI8dfSxwY7gxZ9SAVQ==",
      "license": "MIT",
      "dependencies": {
        "ms": "^2.0.0"
      }
    },
    "node_modules/ieee754": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/ieee754/-/ieee754-1.2.1.tgz",
      "integrity": "sha512-dcyqhDvX1C46lXZcVqCpK+FtMRQVdIMN6/Df5js2zouUsqG7I6sFxitIC+7KYK29KdXOLHdu9zL4sFnoVQnqaA==",
      "dev": true,
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/feross"
        },
        {
          "type": "patreon",
          "url": "https://www.patreon.com/feross"
        },
        {
          "type": "consulting",
          "url": "https://feross.org/support"
        }
      ],
      "license": "BSD-3-Clause"
    },
    "node_modules/inherits": {
      "version": "2.0.4",
      "resolved": "https://registry.npmjs.org/inherits/-/inherits-2.0.4.tgz",
      "integrity": "sha512-k/vGaX4/Yla3WzyMCvTQOXYeIHvqOKtnqBduzTHpzpQZzAskKMhZ2K+EnBiSM9zGSoIFeMpXKxa4dYeZIQqewQ==",
      "dev": true,
      "license": "ISC"
    },
    "node_modules/ini": {
      "version": "1.3.8",
      "resolved": "https://registry.npmjs.org/ini/-/ini-1.3.8.tgz",
      "integrity": "sha512-JV/yugV2uzW5iMRSiZAyDtQd+nxtUnjeLt0acNdw98kKLrvuRVyB80tsREOE7yvGVgalhZ6RNXCmEHkUKBKxew==",
      "dev": true,
      "license": "ISC"
    },
    "node_modules/is-arrayish": {
      "version": "0.3.2",
      "resolved": "https://registry.npmjs.org/is-arrayish/-/is-arrayish-0.3.2.tgz",
      "integrity": "sha512-eVRqCvVlZbuw3GrM63ovNSNAeA1K16kaR/LRY/92w0zxQ5/1YzwblUX652i4Xs9RwAGjW9d9y6X88t8OaAJfWQ==",
      "license": "MIT"
    },
    "node_modules/is-stream": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/is-stream/-/is-stream-3.0.0.tgz",
      "integrity": "sha512-LnQR4bZ9IADDRSkvpqMGvt/tEJWclzklNgSw48V5EAaAeDd6qGvN8ei6k5p0tvxSR171VmGyHuTiAOfxAbr8kA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "^12.20.0 || ^14.13.1 || >=16.0.0"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/isexe": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/isexe/-/isexe-2.0.0.tgz",
      "integrity": "sha512-RHxMLp9lnKHGHRng9QFhRCMbYAcVpn69smSGcq3f36xjgVVWThj4qqLbTLlq7Ssj8B+fIQ1EuCEGI2lKsyQeIw==",
      "dev": true,
      "license": "ISC"
    },
    "node_modules/js-tokens": {
      "version": "9.0.1",
      "resolved": "https://registry.npmjs.org/js-tokens/-/js-tokens-9.0.1.tgz",
      "integrity": "sha512-mxa9E9ITFOt0ban3j6L5MpjwegGz6lBQmM1IJkWeBZGcMxto50+eWdjC/52xDbS2vy0k7vIMK0Fe2wfL9OQSpQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/local-pkg": {
      "version": "0.5.1",
      "resolved": "https://registry.npmjs.org/local-pkg/-/local-pkg-0.5.1.tgz",
      "integrity": "sha512-9rrA30MRRP3gBD3HTGnC6cDFpaE1kVDWxWgqWJUN0RvDNAo+Nz/9GxB+nHOH0ifbVFy0hSA1V6vFDvnx54lTEQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "mlly": "^1.7.3",
        "pkg-types": "^1.2.1"
      },
      "engines": {
        "node": ">=14"
      },
      "funding": {
        "url": "https://github.com/sponsors/antfu"
      }
    },
    "node_modules/loupe": {
      "version": "2.3.7",
      "resolved": "https://registry.npmjs.org/loupe/-/loupe-2.3.7.tgz",
      "integrity": "sha512-zSMINGVYkdpYSOBmLi0D1Uo7JU9nVdQKrHxC8eYlV+9YKK9WePqAlL7lSlorG/U2Fw1w0hTBmaa/jrQ3UbPHtA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "get-func-name": "^2.0.1"
      }
    },
    "node_modules/magic-string": {
      "version": "0.30.17",
      "resolved": "https://registry.npmjs.org/magic-string/-/magic-string-0.30.17.tgz",
      "integrity": "sha512-sNPKHvyjVf7gyjwS4xGTaW/mCnF8wnjtifKBEhxfZ7E/S8tQ0rssrwGNn6q8JH/ohItJfSQp9mBtQYuTlH5QnA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@jridgewell/sourcemap-codec": "^1.5.0"
      }
    },
    "node_modules/math-intrinsics": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/math-intrinsics/-/math-intrinsics-1.1.0.tgz",
      "integrity": "sha512-/IXtbwEk5HTPyEwyKX6hGkYXxM9nbj64B+ilVJnC/R6B0pH5G4V3b0pVbL7DBj4tkhBAppbQUlf6F6Xl9LHu1g==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/merge-stream": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/merge-stream/-/merge-stream-2.0.0.tgz",
      "integrity": "sha512-abv/qOcuPfk3URPfDzmZU1LKmuw8kT+0nIHvKrKgFrwifol/doWcdA4ZqsWQ8ENrFKkd67Mfpo/LovbIUsbt3w==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/mime-db": {
      "version": "1.52.0",
      "resolved": "https://registry.npmjs.org/mime-db/-/mime-db-1.52.0.tgz",
      "integrity": "sha512-sPU4uV7dYlvtWJxwwxHD0PuihVNiE7TyAbQ5SWxDCB9mUYvOgroQOwYQQOKPJ8CIbE+1ETVlOoK1UC2nU3gYvg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/mime-types": {
      "version": "2.1.35",
      "resolved": "https://registry.npmjs.org/mime-types/-/mime-types-2.1.35.tgz",
      "integrity": "sha512-ZDY+bPm5zTTF+YpCrAU9nK0UgICYPT0QtT1NZWFv4s++TNkcgVaT0g6+4R2uI4MjQjzysHB1zxuWL50hzaeXiw==",
      "license": "MIT",
      "dependencies": {
        "mime-db": "1.52.0"
      },
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/mimic-fn": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/mimic-fn/-/mimic-fn-4.0.0.tgz",
      "integrity": "sha512-vqiC06CuhBTUdZH+RYl8sFrL096vA45Ok5ISO6sE/Mr1jRbGH4Csnhi8f3wKVl7x8mO4Au7Ir9D3Oyv1VYMFJw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=12"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
<<<<<<< HEAD
=======
    "node_modules/mimic-response": {
      "version": "3.1.0",
      "resolved": "https://registry.npmjs.org/mimic-response/-/mimic-response-3.1.0.tgz",
      "integrity": "sha512-z0yWI+4FDrrweS8Zmt4Ej5HdJmky15+L2e6Wgn3+iK5fWzb6T3fhNFq2+MeTRb064c6Wr4N/wv0DzQTjNzHNGQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
>>>>>>> 0890d84fef0310c2fe9bb5c155815202b945b78d
    "node_modules/minimist": {
      "version": "1.2.8",
      "resolved": "https://registry.npmjs.org/minimist/-/minimist-1.2.8.tgz",
      "integrity": "sha512-2yyAR8qBkN3YuheJanUpWC5U3bb5osDywNB8RzDVlDwDHbocAJveqqj1u8+SVD7jkWT4yvsHCpWqqWqAxb0zCA==",
      "license": "MIT",
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
<<<<<<< HEAD
=======
    "node_modules/mkdirp-classic": {
      "version": "0.5.3",
      "resolved": "https://registry.npmjs.org/mkdirp-classic/-/mkdirp-classic-0.5.3.tgz",
      "integrity": "sha512-gKLcREMhtuZRwRAfqP3RFW+TK4JqApVBtOIftVgjuABpAtpxhPGaDcfvbhNvD0B8iD1oUr/txX35NjcaY6Ns/A==",
      "dev": true,
      "license": "MIT"
    },
>>>>>>> 0890d84fef0310c2fe9bb5c155815202b945b78d
    "node_modules/mlly": {
      "version": "1.7.4",
      "resolved": "https://registry.npmjs.org/mlly/-/mlly-1.7.4.tgz",
      "integrity": "sha512-qmdSIPC4bDJXgZTCR7XosJiNKySV7O215tsPtDN9iEO/7q/76b/ijtgRu/+epFXSJhijtTCCGp3DWS549P3xKw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "acorn": "^8.14.0",
        "pathe": "^2.0.1",
        "pkg-types": "^1.3.0",
        "ufo": "^1.5.4"
      }
    },
    "node_modules/mlly/node_modules/pathe": {
      "version": "2.0.3",
      "resolved": "https://registry.npmjs.org/pathe/-/pathe-2.0.3.tgz",
      "integrity": "sha512-WUjGcAqP1gQacoQe+OBJsFA7Ld4DyXuUIjZ5cc75cLHvJ7dtNsTugphxIADwspS+AraAUePCKrSVtPLFj/F88w==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/ms": {
      "version": "2.1.3",
      "resolved": "https://registry.npmjs.org/ms/-/ms-2.1.3.tgz",
      "integrity": "sha512-6FlzubTLZG3J2a/NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq/s5xXI6/XXP6tz7R9xAOtHnSO/tXtF3WRTlA==",
      "license": "MIT"
    },
    "node_modules/nanoid": {
      "version": "3.3.11",
      "resolved": "https://registry.npmjs.org/nanoid/-/nanoid-3.3.11.tgz",
      "integrity": "sha512-N8SpfPUnUp1bK+PMYW8qSWdl9U+wwNWI4QKxOYDy9JAro3WMX7p2OeVRF9v+347pnakNevPmiHhNmZ2HbFA76w==",
      "dev": true,
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "MIT",
      "bin": {
        "nanoid": "bin/nanoid.cjs"
      },
      "engines": {
        "node": "^10 || ^12 || ^13.7 || ^14 || >=15.0.1"
      }
    },
<<<<<<< HEAD
=======
    "node_modules/napi-build-utils": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/napi-build-utils/-/napi-build-utils-2.0.0.tgz",
      "integrity": "sha512-GEbrYkbfF7MoNaoh2iGG84Mnf/WZfB0GdGEsM8wz7Expx/LlWf5U8t9nvJKXSp3qr5IsEbK04cBGhol/KwOsWA==",
      "dev": true,
      "license": "MIT"
    },
>>>>>>> 0890d84fef0310c2fe9bb5c155815202b945b78d
    "node_modules/neo-async": {
      "version": "2.6.2",
      "resolved": "https://registry.npmjs.org/neo-async/-/neo-async-2.6.2.tgz",
      "integrity": "sha512-Yd3UES5mWCSqR+qNT93S3UoYUkqAZ9lLg8a7g9rimsWmYGK8cVToA4/sF3RrshdyV3sAGMXVUmpMYOw+dLpOuw==",
      "license": "MIT"
    },
<<<<<<< HEAD
=======
    "node_modules/node-abi": {
      "version": "3.75.0",
      "resolved": "https://registry.npmjs.org/node-abi/-/node-abi-3.75.0.tgz",
      "integrity": "sha512-OhYaY5sDsIka7H7AtijtI9jwGYLyl29eQn/W623DiN/MIv5sUqc4g7BIDThX+gb7di9f6xK02nkp8sdfFWZLTg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "semver": "^7.3.5"
      },
      "engines": {
        "node": ">=10"
      }
    },
>>>>>>> 0890d84fef0310c2fe9bb5c155815202b945b78d
    "node_modules/node-domexception": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/node-domexception/-/node-domexception-1.0.0.tgz",
      "integrity": "sha512-/jKZoMpw0F8GRwl4/eLROPA3cfcXtLApP0QzLmUT/HuPCZWyB7IY9ZrMeKw2O/nFIqPQB3PVM9aYm0F312AXDQ==",
      "deprecated": "Use your platform's native DOMException instead",
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/jimmywarting"
        },
        {
          "type": "github",
          "url": "https://paypal.me/jimmywarting"
        }
      ],
      "license": "MIT",
      "engines": {
        "node": ">=10.5.0"
      }
    },
    "node_modules/node-fetch": {
      "version": "2.7.0",
      "resolved": "https://registry.npmjs.org/node-fetch/-/node-fetch-2.7.0.tgz",
      "integrity": "sha512-c4FRfUm/dbcWZ7U+1Wq0AwCyFL+3nt2bEw05wfxSz+DWpWsitgmSgYmy2dQdWyKC1694ELPqMs/YzUSNozLt8A==",
      "license": "MIT",
      "dependencies": {
        "whatwg-url": "^5.0.0"
      },
      "engines": {
        "node": "4.x || >=6.0.0"
      },
      "peerDependencies": {
        "encoding": "^0.1.0"
      },
      "peerDependenciesMeta": {
        "encoding": {
          "optional": true
        }
      }
    },
    "node_modules/npm-run-path": {
      "version": "5.3.0",
      "resolved": "https://registry.npmjs.org/npm-run-path/-/npm-run-path-5.3.0.tgz",
      "integrity": "sha512-ppwTtiJZq0O/ai0z7yfudtBpWIoxM8yE6nHi1X47eFR2EWORqfbu6CnPlNsjeN683eT0qG6H/Pyf9fCcvjnnnQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "path-key": "^4.0.0"
      },
      "engines": {
        "node": "^12.20.0 || ^14.13.1 || >=16.0.0"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/npm-run-path/node_modules/path-key": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/path-key/-/path-key-4.0.0.tgz",
      "integrity": "sha512-haREypq7xkM7ErfgIyA0z+Bj4AGKlMSdlQE2jvJo6huWD1EdkKYV+G/T4nq0YEF2vgTT8kqMFKo1uHn950r4SQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=12"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/once": {
      "version": "1.4.0",
      "resolved": "https://registry.npmjs.org/once/-/once-1.4.0.tgz",
      "integrity": "sha512-lNaJgI+2Q5URQBkccEKHTQOPaXdUxnZZElQTZY0MFUAuaEqe1E+Nyvgdz/aIyNi6Z9MzO5dv1H8n58/GELp3+w==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "wrappy": "1"
      }
    },
    "node_modules/onetime": {
      "version": "6.0.0",
      "resolved": "https://registry.npmjs.org/onetime/-/onetime-6.0.0.tgz",
      "integrity": "sha512-1FlR+gjXK7X+AsAHso35MnyN5KqGwJRi/31ft6x0M194ht7S+rWAvd7PHss9xSKMzE0asv1pyIHaJYq+BbacAQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "mimic-fn": "^4.0.0"
      },
      "engines": {
        "node": ">=12"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/openai": {
      "version": "4.104.0",
      "resolved": "https://registry.npmjs.org/openai/-/openai-4.104.0.tgz",
      "integrity": "sha512-p99EFNsA/yX6UhVO93f5kJsDRLAg+CTA2RBqdHK4RtK8u5IJw32Hyb2dTGKbnnFmnuoBv5r7Z2CURI9sGZpSuA==",
      "license": "Apache-2.0",
      "dependencies": {
        "@types/node": "^18.11.18",
        "@types/node-fetch": "^2.6.4",
        "abort-controller": "^3.0.0",
        "agentkeepalive": "^4.2.1",
        "form-data-encoder": "1.7.2",
        "formdata-node": "^4.3.2",
        "node-fetch": "^2.6.7"
      },
      "bin": {
        "openai": "bin/cli"
      },
      "peerDependencies": {
        "ws": "^8.18.0",
        "zod": "^3.23.8"
      },
      "peerDependenciesMeta": {
        "ws": {
          "optional": true
        },
        "zod": {
          "optional": true
        }
      }
    },
    "node_modules/p-limit": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/p-limit/-/p-limit-5.0.0.tgz",
      "integrity": "sha512-/Eaoq+QyLSiXQ4lyYV23f14mZRQcXnxfHrN0vCai+ak9G0pp9iEQukIIZq5NccEvwRB8PUnZT0KsOoDCINS1qQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "yocto-queue": "^1.0.0"
      },
      "engines": {
        "node": ">=18"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/path-key": {
      "version": "3.1.1",
      "resolved": "https://registry.npmjs.org/path-key/-/path-key-3.1.1.tgz",
      "integrity": "sha512-ojmeN0qd+y0jszEtoY48r0Peq5dwMEkIlCOu6Q5f41lfkswXuKtYrhgoTpLnyIcHm24Uhqx+5Tqm2InSwLhE6Q==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/pathe": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/pathe/-/pathe-1.1.2.tgz",
      "integrity": "sha512-whLdWMYL2TwI08hn8/ZqAbrVemu0LNaNNJZX73O6qaIdCTfXutsLhMkjdENX0qhsQ9uIimo4/aQOmXkoon2nDQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/pathval": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/pathval/-/pathval-1.1.1.tgz",
      "integrity": "sha512-Dp6zGqpTdETdR63lehJYPeIOqpiNBNtc7BpWSLrOje7UaIsE5aY92r/AunQA7rsXvet3lrJ3JnZX29UPTKXyKQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "*"
      }
    },
    "node_modules/picocolors": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/picocolors/-/picocolors-1.1.1.tgz",
      "integrity": "sha512-xceH2snhtb5M9liqDsmEw56le376mTZkEX/jEb/RxNFyegNul7eNslCXP9FDj/Lcu0X8KEyMceP2ntpaHrDEVA==",
      "dev": true,
      "license": "ISC"
    },
    "node_modules/pkg-types": {
      "version": "1.3.1",
      "resolved": "https://registry.npmjs.org/pkg-types/-/pkg-types-1.3.1.tgz",
      "integrity": "sha512-/Jm5M4RvtBFVkKWRu2BLUTNP8/M2a+UwuAX+ae4770q1qVGtfjG+WTCupoZixokjmHiry8uI+dlY8KXYV5HVVQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "confbox": "^0.1.8",
        "mlly": "^1.7.4",
        "pathe": "^2.0.1"
      }
    },
    "node_modules/pkg-types/node_modules/pathe": {
      "version": "2.0.3",
      "resolved": "https://registry.npmjs.org/pathe/-/pathe-2.0.3.tgz",
      "integrity": "sha512-WUjGcAqP1gQacoQe+OBJsFA7Ld4DyXuUIjZ5cc75cLHvJ7dtNsTugphxIADwspS+AraAUePCKrSVtPLFj/F88w==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/postcss": {
      "version": "8.5.6",
      "resolved": "https://registry.npmjs.org/postcss/-/postcss-8.5.6.tgz",
      "integrity": "sha512-3Ybi1tAuwAP9s0r1UQ2J4n5Y0G05bJkpUIO0/bI9MhwmD70S5aTWbXGBwxHrelT+XM1k6dM0pk+SwNkpTRN7Pg==",
      "dev": true,
      "funding": [
        {
          "type": "opencollective",
          "url": "https://opencollective.com/postcss/"
        },
        {
          "type": "tidelift",
          "url": "https://tidelift.com/funding/github/npm/postcss"
        },
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "MIT",
      "dependencies": {
        "nanoid": "^3.3.11",
        "picocolors": "^1.1.1",
        "source-map-js": "^1.2.1"
      },
      "engines": {
        "node": "^10 || ^12 || >=14"
      }
    },
    "node_modules/prebuild-install": {
      "version": "7.1.3",
      "resolved": "https://registry.npmjs.org/prebuild-install/-/prebuild-install-7.1.3.tgz",
      "integrity": "sha512-8Mf2cbV7x1cXPUILADGI3wuhfqWvtiLA1iclTDbFRZkgRQS0NqsPZphna9V+HyTEadheuPmjaJMsbzKQFOzLug==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "detect-libc": "^2.0.0",
        "expand-template": "^2.0.3",
        "github-from-package": "0.0.0",
        "minimist": "^1.2.3",
        "mkdirp-classic": "^0.5.3",
        "napi-build-utils": "^2.0.0",
        "node-abi": "^3.3.0",
        "pump": "^3.0.0",
        "rc": "^1.2.7",
        "simple-get": "^4.0.0",
        "tar-fs": "^2.0.0",
        "tunnel-agent": "^0.6.0"
      },
      "bin": {
        "prebuild-install": "bin.js"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/pretty-format": {
      "version": "29.7.0",
      "resolved": "https://registry.npmjs.org/pretty-format/-/pretty-format-29.7.0.tgz",
      "integrity": "sha512-Pdlw/oPxN+aXdmM9R00JVC9WVFoCLTKJvDVLgmJ+qAffBMxsV85l/Lu7sNx4zSzPyoL2euImuEwHhOXdEgNFZQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@jest/schemas": "^29.6.3",
        "ansi-styles": "^5.0.0",
        "react-is": "^18.0.0"
      },
      "engines": {
        "node": "^14.15.0 || ^16.10.0 || >=18.0.0"
      }
    },
    "node_modules/pump": {
      "version": "3.0.3",
      "resolved": "https://registry.npmjs.org/pump/-/pump-3.0.3.tgz",
      "integrity": "sha512-todwxLMY7/heScKmntwQG8CXVkWUOdYxIvY2s0VWAAMh/nd8SoYiRaKjlr7+iCs984f2P8zvrfWcDDYVb73NfA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "end-of-stream": "^1.1.0",
        "once": "^1.3.1"
      }
    },
    "node_modules/rc": {
      "version": "1.2.8",
      "resolved": "https://registry.npmjs.org/rc/-/rc-1.2.8.tgz",
      "integrity": "sha512-y3bGgqKj3QBdxLbLkomlohkvsA8gdAiUQlSBJnBhfn+BPxg4bc62d8TcBW15wavDfgexCgccckhcZvywyQYPOw==",
      "dev": true,
      "license": "(BSD-2-Clause OR MIT OR Apache-2.0)",
      "dependencies": {
        "deep-extend": "^0.6.0",
        "ini": "~1.3.0",
        "minimist": "^1.2.0",
        "strip-json-comments": "~2.0.1"
      },
      "bin": {
        "rc": "cli.js"
      }
    },
    "node_modules/react-is": {
      "version": "18.3.1",
      "resolved": "https://registry.npmjs.org/react-is/-/react-is-18.3.1.tgz",
      "integrity": "sha512-/LLMVyas0ljjAtoYiPqYiL8VWXzUUdThrmU5+n20DZv+a+ClRoevUzw5JxU+Ieh5/c87ytoTBV9G1FiKfNJdmg==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/readable-stream": {
      "version": "3.6.2",
      "resolved": "https://registry.npmjs.org/readable-stream/-/readable-stream-3.6.2.tgz",
      "integrity": "sha512-9u/sniCrY3D5WdsERHzHE4G2YCXqoG5FTHUiCC4SIbr6XcLZBY05ya9EKjYek9O5xOAwjGq+1JdGBAS7Q9ScoA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "inherits": "^2.0.3",
        "string_decoder": "^1.1.1",
        "util-deprecate": "^1.0.1"
      },
      "engines": {
        "node": ">= 6"
      }
    },
    "node_modules/rollup": {
      "version": "4.44.0",
      "resolved": "https://registry.npmjs.org/rollup/-/rollup-4.44.0.tgz",
      "integrity": "sha512-qHcdEzLCiktQIfwBq420pn2dP+30uzqYxv9ETm91wdt2R9AFcWfjNAmje4NWlnCIQ5RMTzVf0ZyisOKqHR6RwA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@types/estree": "1.0.8"
      },
      "bin": {
        "rollup": "dist/bin/rollup"
      },
      "engines": {
        "node": ">=18.0.0",
        "npm": ">=8.0.0"
      },
      "optionalDependencies": {
        "@rollup/rollup-android-arm-eabi": "4.44.0",
        "@rollup/rollup-android-arm64": "4.44.0",
        "@rollup/rollup-darwin-arm64": "4.44.0",
        "@rollup/rollup-darwin-x64": "4.44.0",
        "@rollup/rollup-freebsd-arm64": "4.44.0",
        "@rollup/rollup-freebsd-x64": "4.44.0",
        "@rollup/rollup-linux-arm-gnueabihf": "4.44.0",
        "@rollup/rollup-linux-arm-musleabihf": "4.44.0",
        "@rollup/rollup-linux-arm64-gnu": "4.44.0",
        "@rollup/rollup-linux-arm64-musl": "4.44.0",
        "@rollup/rollup-linux-loongarch64-gnu": "4.44.0",
        "@rollup/rollup-linux-powerpc64le-gnu": "4.44.0",
        "@rollup/rollup-linux-riscv64-gnu": "4.44.0",
        "@rollup/rollup-linux-riscv64-musl": "4.44.0",
        "@rollup/rollup-linux-s390x-gnu": "4.44.0",
        "@rollup/rollup-linux-x64-gnu": "4.44.0",
        "@rollup/rollup-linux-x64-musl": "4.44.0",
        "@rollup/rollup-win32-arm64-msvc": "4.44.0",
        "@rollup/rollup-win32-ia32-msvc": "4.44.0",
        "@rollup/rollup-win32-x64-msvc": "4.44.0",
        "fsevents": "~2.3.2"
      }
    },
    "node_modules/safe-buffer": {
      "version": "5.2.1",
      "resolved": "https://registry.npmjs.org/safe-buffer/-/safe-buffer-5.2.1.tgz",
      "integrity": "sha512-rp3So07KcdmmKbGvgaNxQSJr7bGVSVk5S9Eq1F+ppbRo70+YeaDxkw5Dd8NPN+GD6bjnYm2VuPuCXmpuYvmCXQ==",
      "dev": true,
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/feross"
        },
        {
          "type": "patreon",
          "url": "https://www.patreon.com/feross"
        },
        {
          "type": "consulting",
          "url": "https://feross.org/support"
        }
      ],
      "license": "MIT"
    },
    "node_modules/semver": {
      "version": "7.7.2",
      "resolved": "https://registry.npmjs.org/semver/-/semver-7.7.2.tgz",
      "integrity": "sha512-RF0Fw+rO5AMf9MAyaRXI4AV0Ulj5lMHqVxxdSgiVbixSCXoEmmX/jk0CuJw4+3SqroYO9VoUh+HcuJivvtJemA==",
      "license": "ISC",
      "bin": {
        "semver": "bin/semver.js"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/sharp": {
      "version": "0.34.2",
      "resolved": "https://registry.npmjs.org/sharp/-/sharp-0.34.2.tgz",
      "integrity": "sha512-lszvBmB9QURERtyKT2bNmsgxXK0ShJrL/fvqlonCo7e6xBF8nT8xU6pW+PMIbLsz0RxQk3rgH9kd8UmvOzlMJg==",
      "hasInstallScript": true,
      "license": "Apache-2.0",
      "dependencies": {
        "color": "^4.2.3",
        "detect-libc": "^2.0.4",
        "semver": "^7.7.2"
      },
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-darwin-arm64": "0.34.2",
        "@img/sharp-darwin-x64": "0.34.2",
        "@img/sharp-libvips-darwin-arm64": "1.1.0",
        "@img/sharp-libvips-darwin-x64": "1.1.0",
        "@img/sharp-libvips-linux-arm": "1.1.0",
        "@img/sharp-libvips-linux-arm64": "1.1.0",
        "@img/sharp-libvips-linux-ppc64": "1.1.0",
        "@img/sharp-libvips-linux-s390x": "1.1.0",
        "@img/sharp-libvips-linux-x64": "1.1.0",
        "@img/sharp-libvips-linuxmusl-arm64": "1.1.0",
        "@img/sharp-libvips-linuxmusl-x64": "1.1.0",
        "@img/sharp-linux-arm": "0.34.2",
        "@img/sharp-linux-arm64": "0.34.2",
        "@img/sharp-linux-s390x": "0.34.2",
        "@img/sharp-linux-x64": "0.34.2",
        "@img/sharp-linuxmusl-arm64": "0.34.2",
        "@img/sharp-linuxmusl-x64": "0.34.2",
        "@img/sharp-wasm32": "0.34.2",
        "@img/sharp-win32-arm64": "0.34.2",
        "@img/sharp-win32-ia32": "0.34.2",
        "@img/sharp-win32-x64": "0.34.2"
      }
    },
    "node_modules/shebang-command": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/shebang-command/-/shebang-command-2.0.0.tgz",
      "integrity": "sha512-kHxr2zZpYtdmrN1qDjrrX/Z1rR1kG8Dx+gkpK1G4eXmvXswmcE1hTWBWYUzlraYw1/yZp6YuDY77YtvbN0dmDA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "shebang-regex": "^3.0.0"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/shebang-regex": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/shebang-regex/-/shebang-regex-3.0.0.tgz",
      "integrity": "sha512-7++dFhtcx3353uBaq8DDR4NuxBetBzC7ZQOhmTQInHEd6bSrXdiEyzCvG07Z44UYdLShWUyXt5M/yhz8ekcb1A==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/siginfo": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/siginfo/-/siginfo-2.0.0.tgz",
      "integrity": "sha512-ybx0WO1/8bSBLEWXZvEd7gMW3Sn3JFlW3TvX1nREbDLRNQNaeNN8WK0meBwPdAaOI7TtRRRJn/Es1zhrrCHu7g==",
      "dev": true,
      "license": "ISC"
    },
    "node_modules/signal-exit": {
      "version": "4.1.0",
      "resolved": "https://registry.npmjs.org/signal-exit/-/signal-exit-4.1.0.tgz",
      "integrity": "sha512-bzyZ1e88w9O1iNJbKnOlvYTrWPDl46O1bG0D3XInv+9tkPrxrN8jUUTiFlDkkmKWgn1M6CfIA13SuGqOa9Korw==",
      "dev": true,
      "license": "ISC",
      "engines": {
        "node": ">=14"
      },
      "funding": {
        "url": "https://github.com/sponsors/isaacs"
      }
    },
    "node_modules/simple-concat": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/simple-concat/-/simple-concat-1.0.1.tgz",
      "integrity": "sha512-cSFtAPtRhljv69IK0hTVZQ+OfE9nePi/rtJmw5UjHeVyVroEqJXP1sFztKUy1qU+xvz3u/sfYJLa947b7nAN2Q==",
      "dev": true,
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/feross"
        },
        {
          "type": "patreon",
          "url": "https://www.patreon.com/feross"
        },
        {
          "type": "consulting",
          "url": "https://feross.org/support"
        }
      ],
      "license": "MIT"
    },
    "node_modules/simple-get": {
      "version": "4.0.1",
      "resolved": "https://registry.npmjs.org/simple-get/-/simple-get-4.0.1.tgz",
      "integrity": "sha512-brv7p5WgH0jmQJr1ZDDfKDOSeWWg+OVypG99A/5vYGPqJ6pxiaHLy8nxtFjBA7oMa01ebA9gfh1uMCFqOuXxvA==",
      "dev": true,
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/feross"
        },
        {
          "type": "patreon",
          "url": "https://www.patreon.com/feross"
        },
        {
          "type": "consulting",
          "url": "https://feross.org/support"
        }
      ],
      "license": "MIT",
      "dependencies": {
        "decompress-response": "^6.0.0",
        "once": "^1.3.1",
        "simple-concat": "^1.0.0"
      }
    },
    "node_modules/simple-swizzle": {
      "version": "0.2.2",
      "resolved": "https://registry.npmjs.org/simple-swizzle/-/simple-swizzle-0.2.2.tgz",
      "integrity": "sha512-JA//kQgZtbuY83m+xT+tXJkmJncGMTFT+C+g2h2R9uxkYIrE2yy9sgmcLhCnw57/WSD+Eh3J97FPEDFnbXnDUg==",
      "license": "MIT",
      "dependencies": {
        "is-arrayish": "^0.3.1"
      }
    },
    "node_modules/source-map": {
      "version": "0.6.1",
      "resolved": "https://registry.npmjs.org/source-map/-/source-map-0.6.1.tgz",
      "integrity": "sha512-UjgapumWlbMhkBgzT7Ykc5YXUT46F0iKu8SGXq0bcwP5dz/h0Plj6enJqjz1Zbq2l5WaqYnrVbwWOWMyF3F47g==",
      "license": "BSD-3-Clause",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/source-map-js": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/source-map-js/-/source-map-js-1.2.1.tgz",
      "integrity": "sha512-UXWMKhLOwVKb728IUtQPXxfYU+usdybtUrK/8uGE8CQMvrhOpwvzDBwj0QhSL7MQc7vIsISBG8VQ8+IDQxpfQA==",
      "dev": true,
      "license": "BSD-3-Clause",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/stackback": {
      "version": "0.0.2",
      "resolved": "https://registry.npmjs.org/stackback/-/stackback-0.0.2.tgz",
      "integrity": "sha512-1XMJE5fQo1jGH6Y/7ebnwPOBEkIEnT4QF32d5R1+VXdXveM0IBMJt8zfaxX1P3QhVwrYe+576+jkANtSS2mBbw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/std-env": {
      "version": "3.9.0",
      "resolved": "https://registry.npmjs.org/std-env/-/std-env-3.9.0.tgz",
      "integrity": "sha512-UGvjygr6F6tpH7o2qyqR6QYpwraIjKSdtzyBdyytFOHmPZY917kwdwLG0RbOjWOnKmnm3PeHjaoLLMie7kPLQw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/string_decoder": {
      "version": "1.3.0",
      "resolved": "https://registry.npmjs.org/string_decoder/-/string_decoder-1.3.0.tgz",
      "integrity": "sha512-hkRX8U1WjJFd8LsDJ2yQ/wWWxaopEsABU1XfkM8A+j0+85JAGppt16cr1Whg6KIbb4okU6Mql6BOj+uup/wKeA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "safe-buffer": "~5.2.0"
      }
    },
    "node_modules/strip-final-newline": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/strip-final-newline/-/strip-final-newline-3.0.0.tgz",
      "integrity": "sha512-dOESqjYr96iWYylGObzd39EuNTa5VJxyvVAEm5Jnh7KGo75V43Hk1odPQkNDyXNmUR6k+gEiDVXnjB8HJ3crXw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=12"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/strip-json-comments": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/strip-json-comments/-/strip-json-comments-2.0.1.tgz",
      "integrity": "sha512-4gB8na07fecVVkOI6Rs4e7T6NOTki5EmL7TUduTs6bu3EdnSycntVJ4re8kgZA+wx9IueI2Y11bfbgwtzuE0KQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/strip-literal": {
      "version": "2.1.1",
      "resolved": "https://registry.npmjs.org/strip-literal/-/strip-literal-2.1.1.tgz",
      "integrity": "sha512-631UJ6O00eNGfMiWG78ck80dfBab8X6IVFB51jZK5Icd7XAs60Z5y7QdSd/wGIklnWvRbUNloVzhOKKmutxQ6Q==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "js-tokens": "^9.0.1"
      },
      "funding": {
        "url": "https://github.com/sponsors/antfu"
      }
    },
    "node_modules/tar-fs": {
      "version": "2.1.3",
      "resolved": "https://registry.npmjs.org/tar-fs/-/tar-fs-2.1.3.tgz",
      "integrity": "sha512-090nwYJDmlhwFwEW3QQl+vaNnxsO2yVsd45eTKRBzSzu+hlb1w2K9inVq5b0ngXuLVqQ4ApvsUHHnu/zQNkWAg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "chownr": "^1.1.1",
        "mkdirp-classic": "^0.5.2",
        "pump": "^3.0.0",
        "tar-stream": "^2.1.4"
      }
    },
    "node_modules/tar-stream": {
      "version": "2.2.0",
      "resolved": "https://registry.npmjs.org/tar-stream/-/tar-stream-2.2.0.tgz",
      "integrity": "sha512-ujeqbceABgwMZxEJnk2HDY2DlnUZ+9oEcb1KzTVfYHio0UE6dG71n60d8D2I4qNvleWrrXpmjpt7vZeF1LnMZQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "bl": "^4.0.3",
        "end-of-stream": "^1.4.1",
        "fs-constants": "^1.0.0",
        "inherits": "^2.0.3",
        "readable-stream": "^3.1.1"
      },
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/tinybench": {
      "version": "2.9.0",
      "resolved": "https://registry.npmjs.org/tinybench/-/tinybench-2.9.0.tgz",
      "integrity": "sha512-0+DUvqWMValLmha6lr4kD8iAMK1HzV0/aKnCtWb9v9641TnP/MFb7Pc2bxoxQjTXAErryXVgUOfv2YqNllqGeg==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/tinypool": {
      "version": "0.8.4",
      "resolved": "https://registry.npmjs.org/tinypool/-/tinypool-0.8.4.tgz",
      "integrity": "sha512-i11VH5gS6IFeLY3gMBQ00/MmLncVP7JLXOw1vlgkytLmJK7QnEr7NXf0LBdxfmNPAeyetukOk0bOYrJrFGjYJQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=14.0.0"
      }
    },
    "node_modules/tinyspy": {
      "version": "2.2.1",
      "resolved": "https://registry.npmjs.org/tinyspy/-/tinyspy-2.2.1.tgz",
      "integrity": "sha512-KYad6Vy5VDWV4GH3fjpseMQ/XU2BhIYP7Vzd0LG44qRWm/Yt2WCOTicFdvmgo6gWaqooMQCawTtILVQJupKu7A==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=14.0.0"
      }
    },
    "node_modules/tr46": {
      "version": "0.0.3",
      "resolved": "https://registry.npmjs.org/tr46/-/tr46-0.0.3.tgz",
      "integrity": "sha512-N3WMsuqV66lT30CrXNbEjx4GEwlow3v6rr4mCcv6prnfwhS01rkgyFdjPNBYd9br7LpXV1+Emh01fHnq2Gdgrw==",
      "license": "MIT"
    },
    "node_modules/tslib": {
      "version": "2.8.1",
      "resolved": "https://registry.npmjs.org/tslib/-/tslib-2.8.1.tgz",
      "integrity": "sha512-oJFu94HQb+KVduSUQL7wnpmqnfmLsOA/nAh6b6EH0wCEoK0/mPeXU6c3wKDV83MkOuHPRHtSXKKU99IBazS/2w==",
      "license": "0BSD",
      "optional": true
    },
    "node_modules/tunnel-agent": {
      "version": "0.6.0",
      "resolved": "https://registry.npmjs.org/tunnel-agent/-/tunnel-agent-0.6.0.tgz",
      "integrity": "sha512-McnNiV1l8RYeY8tBgEpuodCC1mLUdbSN+CYBL7kJsJNInOP8UjDDEwdk6Mw60vdLLrr5NHKZhMAOSrR2NZuQ+w==",
      "dev": true,
      "license": "Apache-2.0",
      "dependencies": {
        "safe-buffer": "^5.0.1"
      },
      "engines": {
        "node": "*"
      }
    },
    "node_modules/type-detect": {
      "version": "4.1.0",
      "resolved": "https://registry.npmjs.org/type-detect/-/type-detect-4.1.0.tgz",
      "integrity": "sha512-Acylog8/luQ8L7il+geoSxhEkazvkslg7PSNKOX59mbB9cOveP5aq9h74Y7YU8yDpJwetzQQrfIwtf4Wp4LKcw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=4"
      }
    },
    "node_modules/ufo": {
      "version": "1.6.1",
      "resolved": "https://registry.npmjs.org/ufo/-/ufo-1.6.1.tgz",
      "integrity": "sha512-9a4/uxlTWJ4+a5i0ooc1rU7C7YOw3wT+UGqdeNNHWnOF9qcMBgLRS+4IYUqbczewFx4mLEig6gawh7X6mFlEkA==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/uglify-js": {
      "version": "3.19.3",
      "resolved": "https://registry.npmjs.org/uglify-js/-/uglify-js-3.19.3.tgz",
      "integrity": "sha512-v3Xu+yuwBXisp6QYTcH4UbH+xYJXqnq2m/LtQVWKWzYc1iehYnLixoQDN9FH6/j9/oybfd6W9Ghwkl8+UMKTKQ==",
      "license": "BSD-2-Clause",
      "optional": true,
      "bin": {
        "uglifyjs": "bin/uglifyjs"
      },
      "engines": {
        "node": ">=0.8.0"
      }
    },
    "node_modules/undici-types": {
      "version": "5.26.5",
      "resolved": "https://registry.npmjs.org/undici-types/-/undici-types-5.26.5.tgz",
      "integrity": "sha512-JlCMO+ehdEIKqlFxk6IfVoAUVmgz7cU7zD/h9XZ0qzeosSHmUJVOzSQvvYSYWXkFXC+IfLKSIffhv0sVZup6pA==",
      "license": "MIT"
    },
    "node_modules/util-deprecate": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/util-deprecate/-/util-deprecate-1.0.2.tgz",
      "integrity": "sha512-EPD5q1uXyFxJpCrLnCc1nHnq3gOa6DZBocAIiI2TaSCA7VCJ1UJDMagCzIkXNsUYfD1daK//LTEQ8xiIbrHtcw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/vite": {
      "version": "5.4.19",
      "resolved": "https://registry.npmjs.org/vite/-/vite-5.4.19.tgz",
      "integrity": "sha512-qO3aKv3HoQC8QKiNSTuUM1l9o/XX3+c+VTgLHbJWHZGeTPVAg2XwazI9UWzoxjIJCGCV2zU60uqMzjeLZuULqA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "esbuild": "^0.21.3",
        "postcss": "^8.4.43",
        "rollup": "^4.20.0"
      },
      "bin": {
        "vite": "bin/vite.js"
      },
      "engines": {
        "node": "^18.0.0 || >=20.0.0"
      },
      "funding": {
        "url": "https://github.com/vitejs/vite?sponsor=1"
      },
      "optionalDependencies": {
        "fsevents": "~2.3.3"
      },
      "peerDependencies": {
        "@types/node": "^18.0.0 || >=20.0.0",
        "less": "*",
        "lightningcss": "^1.21.0",
        "sass": "*",
        "sass-embedded": "*",
        "stylus": "*",
        "sugarss": "*",
        "terser": "^5.4.0"
      },
      "peerDependenciesMeta": {
        "@types/node": {
          "optional": true
        },
        "less": {
          "optional": true
        },
        "lightningcss": {
          "optional": true
        },
        "sass": {
          "optional": true
        },
        "sass-embedded": {
          "optional": true
        },
        "stylus": {
          "optional": true
        },
        "sugarss": {
          "optional": true
        },
        "terser": {
          "optional": true
        }
      }
    },
    "node_modules/vite-node": {
      "version": "1.6.1",
      "resolved": "https://registry.npmjs.org/vite-node/-/vite-node-1.6.1.tgz",
      "integrity": "sha512-YAXkfvGtuTzwWbDSACdJSg4A4DZiAqckWe90Zapc/sEX3XvHcw1NdurM/6od8J207tSDqNbSsgdCacBgvJKFuA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "cac": "^6.7.14",
        "debug": "^4.3.4",
        "pathe": "^1.1.1",
        "picocolors": "^1.0.0",
        "vite": "^5.0.0"
      },
      "bin": {
        "vite-node": "vite-node.mjs"
      },
      "engines": {
        "node": "^18.0.0 || >=20.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/vitest"
      }
    },
    "node_modules/vitest": {
      "version": "1.6.1",
      "resolved": "https://registry.npmjs.org/vitest/-/vitest-1.6.1.tgz",
      "integrity": "sha512-Ljb1cnSJSivGN0LqXd/zmDbWEM0RNNg2t1QW/XUhYl/qPqyu7CsqeWtqQXHVaJsecLPuDoak2oJcZN2QoRIOag==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@vitest/expect": "1.6.1",
        "@vitest/runner": "1.6.1",
        "@vitest/snapshot": "1.6.1",
        "@vitest/spy": "1.6.1",
        "@vitest/utils": "1.6.1",
        "acorn-walk": "^8.3.2",
        "chai": "^4.3.10",
        "debug": "^4.3.4",
        "execa": "^8.0.1",
        "local-pkg": "^0.5.0",
        "magic-string": "^0.30.5",
        "pathe": "^1.1.1",
        "picocolors": "^1.0.0",
        "std-env": "^3.5.0",
        "strip-literal": "^2.0.0",
        "tinybench": "^2.5.1",
        "tinypool": "^0.8.3",
        "vite": "^5.0.0",
        "vite-node": "1.6.1",
        "why-is-node-running": "^2.2.2"
      },
      "bin": {
        "vitest": "vitest.mjs"
      },
      "engines": {
        "node": "^18.0.0 || >=20.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/vitest"
      },
      "peerDependencies": {
        "@edge-runtime/vm": "*",
        "@types/node": "^18.0.0 || >=20.0.0",
        "@vitest/browser": "1.6.1",
        "@vitest/ui": "1.6.1",
        "happy-dom": "*",
        "jsdom": "*"
      },
      "peerDependenciesMeta": {
        "@edge-runtime/vm": {
          "optional": true
        },
        "@types/node": {
          "optional": true
        },
        "@vitest/browser": {
          "optional": true
        },
        "@vitest/ui": {
          "optional": true
        },
        "happy-dom": {
          "optional": true
        },
        "jsdom": {
          "optional": true
        }
      }
    },
    "node_modules/web-streams-polyfill": {
      "version": "4.0.0-beta.3",
      "resolved": "https://registry.npmjs.org/web-streams-polyfill/-/web-streams-polyfill-4.0.0-beta.3.tgz",
      "integrity": "sha512-QW95TCTaHmsYfHDybGMwO5IJIM93I/6vTRk+daHTWFPhwh+C8Cg7j7XyKrwrj8Ib6vYXe0ocYNrmzY4xAAN6ug==",
      "license": "MIT",
      "engines": {
        "node": ">= 14"
      }
    },
    "node_modules/webidl-conversions": {
      "version": "3.0.1",
      "resolved": "https://registry.npmjs.org/webidl-conversions/-/webidl-conversions-3.0.1.tgz",
      "integrity": "sha512-2JAn3z8AR6rjK8Sm8orRC0h/bcl/DqL7tRPdGZ4I1CjdF+EaMLmYxBHyXuKL849eucPFhvBoxMsflfOb8kxaeQ==",
      "license": "BSD-2-Clause"
    },
    "node_modules/whatwg-url": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/whatwg-url/-/whatwg-url-5.0.0.tgz",
      "integrity": "sha512-saE57nupxk6v3HY35+jzBwYa0rKSy0XR8JSxZPwgLr7ys0IBzhGviA1/TUGJLmSVqs8pb9AnvICXEuOHLprYTw==",
      "license": "MIT",
      "dependencies": {
        "tr46": "~0.0.3",
        "webidl-conversions": "^3.0.0"
      }
    },
    "node_modules/which": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/which/-/which-2.0.2.tgz",
      "integrity": "sha512-BLI3Tl1TW3Pvl70l3yq3Y64i+awpwXqsGBYWkkqMtnbXgrMD+yj7rhW0kuEDxzJaYXGjEW5ogapKNMEKNMjibA==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "isexe": "^2.0.0"
      },
      "bin": {
        "node-which": "bin/node-which"
      },
      "engines": {
        "node": ">= 8"
      }
    },
    "node_modules/why-is-node-running": {
      "version": "2.3.0",
      "resolved": "https://registry.npmjs.org/why-is-node-running/-/why-is-node-running-2.3.0.tgz",
      "integrity": "sha512-hUrmaWBdVDcxvYqnyh09zunKzROWjbZTiNy8dBEjkS7ehEDQibXJ7XvlmtbwuTclUiIyN+CyXQD4Vmko8fNm8w==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "siginfo": "^2.0.0",
        "stackback": "0.0.2"
      },
      "bin": {
        "why-is-node-running": "cli.js"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/wordwrap": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/wordwrap/-/wordwrap-1.0.0.tgz",
      "integrity": "sha512-gvVzJFlPycKc5dZN4yPkP8w7Dc37BtP1yczEneOb4uq34pXZcvrtRTmWV8W+Ume+XCxKgbjM+nevkyFPMybd4Q==",
      "license": "MIT"
    },
<<<<<<< HEAD
=======
    "node_modules/wrappy": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/wrappy/-/wrappy-1.0.2.tgz",
      "integrity": "sha512-l4Sp/DRseor9wL6EvV2+TuQn63dMkPjZ/sp9XkghTEbV9KlPS1xUsZ3u7/IQO4wxtcFB4bgpQPRcR3QCvezPcQ==",
      "dev": true,
      "license": "ISC"
    },
>>>>>>> 0890d84fef0310c2fe9bb5c155815202b945b78d
    "node_modules/yocto-queue": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/yocto-queue/-/yocto-queue-1.2.1.tgz",
      "integrity": "sha512-AyeEbWOu/TAXdxlV9wmGcR0+yh2j3vYPGOECcIj2S7MkrLyC7ne+oye2BKTItt0ii2PHk4cDy+95+LshzbXnGg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=12.20"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/zod": {
      "version": "3.25.74",
      "resolved": "https://registry.npmjs.org/zod/-/zod-3.25.74.tgz",
      "integrity": "sha512-J8poo92VuhKjNknViHRAIuuN6li/EwFbAC8OedzI8uxpEPGiXHGQu9wemIAioIpqgfB4SySaJhdk0mH5Y4ICBg==",
      "license": "MIT",
      "funding": {
        "url": "https://github.com/sponsors/colinhacks"
      }
<<<<<<< HEAD
=======
    },
    "node_modules/zod-to-json-schema": {
      "version": "3.24.6",
      "resolved": "https://registry.npmjs.org/zod-to-json-schema/-/zod-to-json-schema-3.24.6.tgz",
      "integrity": "sha512-h/z3PKvcTcTetyjl1fkj79MHNEjm+HpD6NXheWjzOekY7kV+lwDYnHw+ivHkijnCSMz1yJaWBD9vu/Fcmk+vEg==",
      "dev": true,
      "license": "ISC",
      "peerDependencies": {
        "zod": "^3.24.1"
      }
>>>>>>> 0890d84fef0310c2fe9bb5c155815202b945b78d
    }
  }
}
```

### File: ./tests
```
(File type is inode/directory — skipping raw dump.)
```

### File: ./tests/orchestrator.test.js
```
import { describe, it, expect, vi, beforeEach, afterEach } from "vitest";
import fs from "node:fs/promises";
import path from "node:path";
import os from "node:os";

vi.hoisted(() => {
  process.env.OPENAI_API_KEY = "test";
});

vi.mock("../src/chatClient.js", async () => {
  const actual = await vi.importActual("../src/chatClient.js");
  return {
    ...actual,
    chatCompletion: vi.fn(),
  };
});

import { chatCompletion } from "../src/chatClient.js";
import { triageDirectory } from "../src/orchestrator.js";

let tmpDir;
let promptFile;

beforeEach(async () => {
  process.env.NODE_ENV = 'test';
  tmpDir = await fs.mkdtemp(path.join(os.tmpdir(), "ps-test-"));
  await fs.writeFile(path.join(tmpDir, "1.jpg"), "a");
  await fs.writeFile(path.join(tmpDir, "2.jpg"), "b");
  promptFile = path.join(tmpDir, "prompt.txt");
  await fs.writeFile(promptFile, "prompt");
});

afterEach(async () => {
  vi.restoreAllMocks();
  await fs.rm(tmpDir, { recursive: true, force: true });
  delete process.env.NODE_ENV;
});

describe("triageDirectory", () => {
  it("moves files into keep and aside", async () => {
    chatCompletion.mockResolvedValueOnce({
      minutes: [{ speaker: 'A', text: 'ok?' }],
      decision: { keep: { '1.jpg': '' }, aside: { '2.jpg': '' } }
    });
    await triageDirectory({
      dir: tmpDir,
      promptPath: promptFile,
      model: "test-model",
      recurse: false,
    });
    const keepPath = path.join(tmpDir, "_keep", "1.jpg");
    const asidePath = path.join(tmpDir, "_aside", "2.jpg");
    await expect(fs.stat(keepPath)).resolves.toBeTruthy();
    await expect(fs.stat(asidePath)).resolves.toBeTruthy();
    const level = path.join(tmpDir, "_level-001", "1.jpg");
    await expect(fs.stat(level)).resolves.toBeTruthy();
  });

  it("recurses into keep directory", async () => {
    chatCompletion
      .mockResolvedValueOnce({ minutes: [{ speaker: 'A', text: 'ok?' }], decision: { keep: { '1.jpg': '' }, aside: { '2.jpg': '' } } })
      .mockResolvedValueOnce({ minutes: [{ speaker: 'B', text: 'next?' }], decision: { keep: {}, aside: { '1.jpg': '' } } });
    await triageDirectory({
      dir: tmpDir,
      promptPath: promptFile,
      model: "test-model",
      recurse: true,
    });
    expect(chatCompletion).toHaveBeenCalledTimes(2);
    const aside2 = path.join(tmpDir, "_keep", "_aside", "1.jpg");
    await expect(fs.stat(aside2)).resolves.toBeTruthy();
    const level2 = path.join(tmpDir, "_keep", "_level-002", "1.jpg");
    await expect(fs.stat(level2)).resolves.toBeTruthy();
  });

  it("recurses even when all images kept", async () => {
    chatCompletion
      .mockResolvedValueOnce({ minutes: [{ speaker: 'A', text: 'ok?' }], decision: { keep: { '1.jpg': '', '2.jpg': '' }, aside: {} } })
      .mockResolvedValueOnce({ minutes: [{ speaker: 'B', text: 'next?' }], decision: { keep: {}, aside: { '1.jpg': '', '2.jpg': '' } } });
    await triageDirectory({
      dir: tmpDir,
      promptPath: promptFile,
      model: "test-model",
      recurse: true,
    });
    expect(chatCompletion).toHaveBeenCalledTimes(2);
    const aside2 = path.join(tmpDir, "_keep", "_aside", "2.jpg");
    await expect(fs.stat(aside2)).resolves.toBeTruthy();
  });

  it("updates field notes when enabled", async () => {
    chatCompletion.mockResolvedValueOnce({
      minutes: [{ speaker: 'A', text: 'ok?' }],
      decision: { keep: { '1.jpg': '' }, aside: { '2.jpg': '' } },
      field_notes_diff: "--- a\n+++ b\n@@\n-Old\n+New",
    });
    chatCompletion.mockResolvedValueOnce({
      minutes: [{ speaker: 'B', text: 'done?' }],
      decision: { keep: {}, aside: {} },
      field_notes_md: "New"
    });
    await triageDirectory({
      dir: tmpDir,
      promptPath: promptFile,
      model: "test-model",
      recurse: false,
      fieldNotes: true,
    });
    const noteFile = path.join(tmpDir, "_level-001", "field-notes.md");
    const content = await fs.readFile(noteFile, "utf8");
    expect(content).toMatch(/New/);
    expect(chatCompletion).toHaveBeenCalledTimes(2);
  });

  it("prints the prompt when showPrompt is true", async () => {
    chatCompletion.mockResolvedValueOnce({ minutes: [{ speaker: 'A', text: 'ok?' }], decision: { keep: { '1.jpg': '' }, aside: { '2.jpg': '' } } });
    const spy = vi.spyOn(console, "log").mockImplementation(() => {});
    await triageDirectory({
      dir: tmpDir,
      promptPath: promptFile,
      model: "test-model",
      recurse: false,
      showPrompt: true,
    });
    const calls = spy.mock.calls.some((c) => String(c[0]).includes("Prompt"));
    expect(calls).toBe(true);
    spy.mockRestore();
  });
});
```

### File: ./tests/chatClient.test.js
```
import { describe, it, expect, beforeAll, afterAll, vi } from "vitest";
import fs from "node:fs/promises";
import os from "node:os";
import path from "node:path";

let chatSpy;
let responsesSpy;

class MockNotFoundError extends Error {
  constructor(msg) {
    super(msg);
    this.status = 404;
  }
}

vi.mock("openai", () => {
  chatSpy = vi.fn();
  responsesSpy = vi.fn();
  return {
    OpenAI: vi.fn(() => ({
      chat: { completions: { create: chatSpy } },
      responses: { create: responsesSpy },
    })),
    NotFoundError: MockNotFoundError,
  };
});

let parseReply, buildMessages, buildInput, chatCompletion;
beforeAll(async () => {
  process.env.OPENAI_API_KEY = 'test-key';
  global.fetch = vi.fn(async () => ({ ok: true, json: async () => ({ data: [] }) }));
  ({ parseReply, buildMessages, buildInput, chatCompletion } = await import('../src/chatClient.js'));
});

afterAll(() => {
  global.fetch = undefined;
});

const files = [
  "/tmp/DSCF1234.jpg",
  "/tmp/DSCF5678.jpg",
  "/tmp/DSCF9012.jpg",
];

/** Basic parsing of keep/aside directives */
describe("parseReply", () => {
  it("classifies mentioned files and captures notes", () => {
    const json = JSON.stringify({
      minutes: [{ speaker: 'A', text: 'ok?' }],
      decision: {
        keep: { 'DSCF1234.jpg': 'sharp' },
        aside: { 'DSCF5678.jpg': 'blurry' }
      }
    });
    const { keep, aside, notes } = parseReply(json, files);
    expect(keep).toContain(files[0]);
    expect(notes.get(files[0])).toMatch(/sharp/);
    expect(aside).toContain(files[1]);
    expect(notes.get(files[1])).toMatch(/blurry/);
  });

  it("leaves unmentioned files unclassified", () => {
    const json = JSON.stringify({
      minutes: [{ speaker: 'A', text: 'ok?' }],
      decision: { keep: { 'DSCF1234.jpg': '' }, aside: {} }
    });
    const { aside, keep, unclassified } = parseReply(json, files);
    expect(keep).toContain(files[0]);
    expect(unclassified).toContain(files[1]);
    expect(unclassified).toContain(files[2]);
  });

  it("matches filenames when the reply omits prefixes", () => {
    const prefixed = [
      "/tmp/2020-01-01-DSCF1234.jpg",
      "/tmp/2020-01-01-DSCF5678.jpg",
    ];
    const json = JSON.stringify({
      minutes: [{ speaker: 'A', text: 'ok?' }],
      decision: { keep: { 'DSCF1234.jpg': '' }, aside: { 'DSCF5678.jpg': '' } }
    });
    const { keep, aside } = parseReply(json, prefixed);
    expect(keep).toContain(prefixed[0]);
    expect(aside).toContain(prefixed[1]);
  });

  it("parses JSON responses with reasoning", () => {
    const json = JSON.stringify({
      minutes: [{ speaker: 'A', text: 'ok?' }],
      decision: {
        keep: { "DSCF1234.jpg": "good light" },
        aside: { "DSCF5678.jpg": "out of focus" }
      }
    });
    const { keep, aside, notes } = parseReply(json, files);
    expect(keep).toContain(files[0]);
    expect(notes.get(files[0])).toMatch(/good light/);
    expect(aside).toContain(files[1]);
    expect(notes.get(files[1])).toMatch(/out of focus/);
    expect(aside).not.toContain(files[2]);
  });

  it("handles JSON wrapped in Markdown fences", () => {
    const fenced =
      '```json\n' +
      JSON.stringify({ minutes: [{ speaker: 'A', text: 'ok?' }], decision: { keep: { "DSCF1234.jpg": "" }, aside: { "DSCF5678.jpg": "" } } }) +
      '\n```';
    const { keep, aside } = parseReply(fenced, files);
    expect(keep).toContain(files[0]);
    expect(aside).toContain(files[1]);
  });

  it("deduplicates files listed in both groups", () => {
    const reply = JSON.stringify({
      minutes: [{ speaker: 'A', text: 'ok?' }],
      decision: { keep: { "DSCF1234.jpg": "" }, aside: { "DSCF1234.jpg": "" } }
    });
    const { keep, aside } = parseReply(reply, files);
    expect(keep).toContain(files[0]);
    expect(aside).not.toContain(files[0]);
  });

  it("parses minutes and nested decision", () => {
    const reply = JSON.stringify({
      minutes: [{ speaker: "Curator", text: "looks good?" }],
      decision: { keep: { "DSCF1234.jpg": "" }, aside: { "DSCF5678.jpg": "" } },
    });
    const { keep, aside, minutes } = parseReply(reply, files);
    expect(minutes[0]).toMatch(/Curator/);
    expect(keep).toContain(files[0]);
    expect(aside).toContain(files[1]);
  });
});

/** Verify images are labelled in messages */
describe("buildMessages", () => {
  it("labels each image before the encoded data", async () => {
    const dir = await fs.mkdtemp(path.join(os.tmpdir(), "ps-msg-"));
    const img1 = path.join(dir, "1.jpg");
    const img2 = path.join(dir, "2.jpg");
    await fs.writeFile(img1, "a");
    await fs.writeFile(img2, "b");
    const [, user] = await buildMessages("prompt", [img1, img2]);
    expect(JSON.parse(user.content[1].text)).toEqual({ filename: "1.jpg" });
    expect(JSON.parse(user.content[3].text)).toEqual({ filename: "2.jpg" });
    await fs.rm(dir, { recursive: true, force: true });
  });

  it("includes people names when available", async () => {
    const dir = await fs.mkdtemp(path.join(os.tmpdir(), "ps-msg-"));
    const img1 = path.join(dir, "a.jpg");
    await fs.writeFile(img1, "a");
    global.fetch.mockResolvedValueOnce({
      ok: true,
      json: async () => ({ data: ["Alice", "Bob"] }),
    });
    const [, user] = await buildMessages("prompt", [img1]);
    const meta = JSON.parse(user.content[1].text);
    expect(meta.filename).toBe("a.jpg");
    expect(meta.people).toEqual(["Alice", "Bob"]);
    await fs.rm(dir, { recursive: true, force: true });
  });
});

describe("buildInput", () => {
  it("labels each image before the encoded data", async () => {
    const dir = await fs.mkdtemp(path.join(os.tmpdir(), "ps-in-"));
    const img1 = path.join(dir, "1.jpg");
    await fs.writeFile(img1, "a");
    const { input } = await buildInput("prompt", [img1]);
    const meta = JSON.parse(input[0].content[1].text);
    expect(meta).toEqual({ filename: "1.jpg" });
    await fs.rm(dir, { recursive: true, force: true });
  });

  it("includes people names when available", async () => {
    const dir = await fs.mkdtemp(path.join(os.tmpdir(), "ps-in-"));
    const img1 = path.join(dir, "a.jpg");
    await fs.writeFile(img1, "a");
    global.fetch.mockResolvedValueOnce({
      ok: true,
      json: async () => ({ data: ["Alice", "Bob"] }),
    });
    const { input } = await buildInput("prompt", [img1]);
    const meta = JSON.parse(input[0].content[1].text);
    expect(meta.filename).toBe("a.jpg");
    expect(meta.people).toEqual(["Alice", "Bob"]);
    await fs.rm(dir, { recursive: true, force: true });
  });
});

describe("chatCompletion", () => {
  let chatCompletion;

  beforeAll(async () => {
    ({ chatCompletion } = await import("../src/chatClient.js"));
  });

  it("falls back to responses when chat endpoint not supported", async () => {
    const errMsg =
      "This is not a chat model and thus not supported in the v1/chat/completions endpoint. Did you mean to use v1/completions?";
    chatSpy.mockRejectedValueOnce(new MockNotFoundError(errMsg));
    responsesSpy.mockResolvedValueOnce({ output_text: JSON.stringify({ foo: 1 }) });
    const result = await chatCompletion({
      prompt: "p",
      images: [],
      model: "o3-pro",
      cache: false,
    });
    expect(responsesSpy).toHaveBeenCalled();
    const args = responsesSpy.mock.calls[0][0];
    expect(args.max_output_tokens).toBeTruthy();
    expect(result.foo).toBe(1);
  });

  it("retries once when JSON parse fails", async () => {
    chatSpy.mockClear();
    chatSpy
      .mockResolvedValueOnce({ choices: [{ message: { content: "oops" } }] })
      .mockResolvedValueOnce({ choices: [{ message: { content: JSON.stringify({ minutes: [], decision: {} }) } }] });

    const result = await chatCompletion({ prompt: "p", images: [], cache: false });
    expect(chatSpy).toHaveBeenCalledTimes(2);
    expect(result.decision).toBeDefined();
  });
});
```

### File: ./tests/imageSelector.test.js
```
import { describe, it, expect } from "vitest";
import { pickRandom } from "../src/imageSelector.js";

describe("pickRandom", () => {
  it("returns no more than requested items", () => {
    const arr = [...Array(20).keys()];
    const result = pickRandom(arr, 10);
    expect(result.length).toBeLessThanOrEqual(10);
  });

  it("returns every item when array shorter than count", () => {
    const arr = [1, 2, 3];
    expect(pickRandom(arr, 10)).toHaveLength(3);
  });
});
```

### File: ./tests/hash.test.js
```
import { describe, it, expect } from 'vitest';
import fs from 'node:fs/promises';
import os from 'node:os';
import path from 'node:path';
import { sha256 } from '../src/hash.js';

describe('sha256', () => {
  it('produces stable hashes for file contents', async () => {
    const dir = await fs.mkdtemp(path.join(os.tmpdir(), 'hash-'));
    const file = path.join(dir, 'a.txt');
    await fs.writeFile(file, 'hello');
    const h1 = await sha256(file);
    const h2 = await sha256(file);
    expect(h1).toBe(h2);
    await fs.rm(dir, { recursive: true, force: true });
  });
});
```

### File: ./tests/fieldNotes.test.js
```
import { describe, it, expect, beforeEach, afterEach } from "vitest";
import fs from "node:fs/promises";
import os from "node:os";
import path from "node:path";
import { FieldNotesWriter } from "../src/fieldNotes.js";
import { createTwoFilesPatch } from "diff";

let dir;
let file;
let writer;

beforeEach(async () => {
  dir = await fs.mkdtemp(path.join(os.tmpdir(), "fn-test-"));
  file = path.join(dir, "field-notes.md");
  writer = new FieldNotesWriter(file);
  await writer.init();
});

afterEach(async () => {
  await fs.rm(dir, { recursive: true, force: true });
});

describe("FieldNotesWriter", () => {
  it("autolinks filenames and stamps", async () => {
    await writer.writeFull("See [a.jpg] and [b.png]");
    const md = await fs.readFile(file, "utf8");
    expect(md).toMatch(/\[a.jpg\]\(\.\/a.jpg\)/);
    expect(md).toMatch(/<!-- created:/);
    expect(md).toMatch(/<!-- updated:/);
  });

  it("applies diff patches", async () => {
    await writer.writeFull("Old\n");
    const diff = createTwoFilesPatch("a", "b", "Old\n", "New\n");
    await writer.applyDiff(diff);
    const md = await fs.readFile(file, "utf8");
    expect(md).toMatch(/New/);
  });
});
```

### File: ./tests/orchestrator.test.js.orig
```
import { describe, it, expect, vi, beforeEach, afterEach } from "vitest";
import fs from "node:fs/promises";
import path from "node:path";
import os from "node:os";

vi.hoisted(() => {
  process.env.OPENAI_API_KEY = "test";
});

vi.mock("../src/chatClient.js", async () => {
  const actual = await vi.importActual("../src/chatClient.js");
  return {
    ...actual,
    chatCompletion: vi.fn(),
  };
});

import { chatCompletion } from "../src/chatClient.js";
import { triageDirectory } from "../src/orchestrator.js";

let tmpDir;
let promptFile;

beforeEach(async () => {
  tmpDir = await fs.mkdtemp(path.join(os.tmpdir(), "ps-test-"));
  await fs.writeFile(path.join(tmpDir, "1.jpg"), "a");
  await fs.writeFile(path.join(tmpDir, "2.jpg"), "b");
  promptFile = path.join(tmpDir, "prompt.txt");
  await fs.writeFile(promptFile, "prompt");
});

afterEach(async () => {
  vi.restoreAllMocks();
  await fs.rm(tmpDir, { recursive: true, force: true });
});

describe("triageDirectory", () => {
  it("moves files into keep and aside", async () => {
    chatCompletion.mockResolvedValueOnce(
      JSON.stringify({
        minutes: [{ speaker: 'A', text: 'ok?' }],
        decision: { keep: ["1.jpg"], aside: ["2.jpg"] }
      })
    );
    await triageDirectory({
      dir: tmpDir,
      promptPath: promptFile,
      model: "test-model",
      recurse: false,
    });
    const keepPath = path.join(tmpDir, "_keep", "1.jpg");
    const asidePath = path.join(tmpDir, "_aside", "2.jpg");
    await expect(fs.stat(keepPath)).resolves.toBeTruthy();
    await expect(fs.stat(asidePath)).resolves.toBeTruthy();
    const level = path.join(tmpDir, "_level-001", "1.jpg");
    await expect(fs.stat(level)).resolves.toBeTruthy();
  });

  it("recurses into keep directory", async () => {
    chatCompletion
      .mockResolvedValueOnce(
        JSON.stringify({ minutes: [{ speaker: 'A', text: 'ok?' }], decision: { keep: ["1.jpg"], aside: ["2.jpg"] } })
      )
      .mockResolvedValueOnce(
        JSON.stringify({ minutes: [{ speaker: 'B', text: 'next?' }], decision: { keep: [], aside: ["1.jpg"] } })
      );
    await triageDirectory({
      dir: tmpDir,
      promptPath: promptFile,
      model: "test-model",
      recurse: true,
    });
    expect(chatCompletion).toHaveBeenCalledTimes(2);
    const aside2 = path.join(tmpDir, "_keep", "_aside", "1.jpg");
    await expect(fs.stat(aside2)).resolves.toBeTruthy();
    const level2 = path.join(tmpDir, "_keep", "_level-002", "1.jpg");
    await expect(fs.stat(level2)).resolves.toBeTruthy();
  });

  it("recurses even when all images kept", async () => {
    chatCompletion
      .mockResolvedValueOnce(
        JSON.stringify({ minutes: [{ speaker: 'A', text: 'ok?' }], decision: { keep: ["1.jpg", "2.jpg"], aside: [] } })
      )
      .mockResolvedValueOnce(
        JSON.stringify({ minutes: [{ speaker: 'B', text: 'next?' }], decision: { keep: [], aside: ["1.jpg", "2.jpg"] } })
      );
    await triageDirectory({
      dir: tmpDir,
      promptPath: promptFile,
      model: "test-model",
      recurse: true,
    });
    expect(chatCompletion).toHaveBeenCalledTimes(2);
    const aside2 = path.join(tmpDir, "_keep", "_aside", "2.jpg");
    await expect(fs.stat(aside2)).resolves.toBeTruthy();
  });

  it("updates field notes when enabled", async () => {
    chatCompletion.mockResolvedValueOnce(
      JSON.stringify({
<<<<<<< HEAD
<<<<<<< HEAD
        keep: ["1.jpg"],
        aside: ["2.jpg"],
=======
        minutes: [{ speaker: 'A', text: 'ok?' }],
        decision: { keep: ["1.jpg"], aside: ["2.jpg"] },
>>>>>>> 0890d84fef0310c2fe9bb5c155815202b945b78d
=======
        minutes: [{ speaker: 'A', text: 'ok?' }],
        decision: { keep: ["1.jpg"], aside: ["2.jpg"] },
>>>>>>> d094a92de9c6b4b7abda877a9e161037ca186e86
        field_notes_diff: "--- a\n+++ b\n@@\n-Old\n+New",
      })
    );
    chatCompletion.mockResolvedValueOnce(
<<<<<<< HEAD
<<<<<<< HEAD
      JSON.stringify({ field_notes_md: "New" })
=======
=======
>>>>>>> d094a92de9c6b4b7abda877a9e161037ca186e86
      JSON.stringify({
        minutes: [{ speaker: 'B', text: 'done?' }],
        decision: { keep: [], aside: [] },
        field_notes_md: "New"
      })
<<<<<<< HEAD
>>>>>>> 0890d84fef0310c2fe9bb5c155815202b945b78d
=======
>>>>>>> d094a92de9c6b4b7abda877a9e161037ca186e86
    );
    await triageDirectory({
      dir: tmpDir,
      promptPath: promptFile,
      model: "test-model",
      recurse: false,
      fieldNotes: true,
    });
    const noteFile = path.join(tmpDir, "_level-001", "field-notes.md");
    const content = await fs.readFile(noteFile, "utf8");
    expect(content).toMatch(/New/);
    expect(chatCompletion).toHaveBeenCalledTimes(2);
  });

<<<<<<< HEAD
<<<<<<< HEAD
  it("fails when field_notes_diff missing", async () => {
    chatCompletion.mockResolvedValueOnce(
      JSON.stringify({ keep: ["1.jpg"], aside: ["2.jpg"] })
    );
    await expect(
      triageDirectory({
        dir: tmpDir,
        promptPath: promptFile,
        model: "test-model",
        recurse: false,
        fieldNotes: true,
      })
    ).rejects.toThrow();
  });

  it("prints the prompt when showPrompt is true", async () => {
    chatCompletion.mockResolvedValueOnce(
      JSON.stringify({ keep: ["1.jpg"], aside: ["2.jpg"] })
=======
  it("prints the prompt when showPrompt is true", async () => {
    chatCompletion.mockResolvedValueOnce(
      JSON.stringify({ minutes: [{ speaker: 'A', text: 'ok?' }], decision: { keep: ["1.jpg"], aside: ["2.jpg"] } })
>>>>>>> 0890d84fef0310c2fe9bb5c155815202b945b78d
=======
  it("prints the prompt when showPrompt is true", async () => {
    chatCompletion.mockResolvedValueOnce(
      JSON.stringify({ minutes: [{ speaker: 'A', text: 'ok?' }], decision: { keep: ["1.jpg"], aside: ["2.jpg"] } })
>>>>>>> d094a92de9c6b4b7abda877a9e161037ca186e86
    );
    const spy = vi.spyOn(console, "log").mockImplementation(() => {});
    await triageDirectory({
      dir: tmpDir,
      promptPath: promptFile,
      model: "test-model",
      recurse: false,
<<<<<<< HEAD
<<<<<<< HEAD
      showPrompt: 'full',
=======
      showPrompt: true,
>>>>>>> 0890d84fef0310c2fe9bb5c155815202b945b78d
=======
      showPrompt: true,
>>>>>>> d094a92de9c6b4b7abda877a9e161037ca186e86
    });
    const calls = spy.mock.calls.some((c) => String(c[0]).includes("Prompt"));
    expect(calls).toBe(true);
    spy.mockRestore();
  });
});
```

### File: ./tests/archive.test.js
```
import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';
import fs from 'node:fs/promises';
import os from 'node:os';
import path from 'node:path';

vi.hoisted(() => {
  process.env.OPENAI_API_KEY = 'test';
});

vi.mock('../src/chatClient.js', async () => {
  const actual = await vi.importActual('../src/chatClient.js');
  return {
    ...actual,
    chatCompletion: vi.fn().mockResolvedValue({
      minutes: [{ speaker: 'A', text: 'done?' }],
      decision: { keep: {}, aside: { 'a.jpg': '' } }
    })
  };
});

import { chatCompletion } from '../src/chatClient.js';
import { triageDirectory } from '../src/orchestrator.js';

let dir, promptFile;

beforeEach(async () => {
  dir = await fs.mkdtemp(path.join(os.tmpdir(), 'arc-'));
  await fs.writeFile(path.join(dir, 'a.jpg'), 'a');
  promptFile = path.join(dir, 'p.hbs');
  await fs.writeFile(promptFile, 'prompt');
});

afterEach(async () => {
  vi.restoreAllMocks();
  await fs.rm(dir, { recursive: true, force: true });
});

describe('archive reply', () => {
  it('writes raw reply file', async () => {
    await triageDirectory({ dir, promptPath: promptFile, model: 'x', recurse: false });
    const levelDir = path.join(dir, '_level-001');
    const replies = await fs.readdir(path.join(levelDir, 'replies'));
    expect(replies.length).toBe(1);
  });
});
```

### File: ./tests/schema.test.js
```
import { describe, it, expect } from 'vitest';
import { Reply } from '../src/replySchema.js';

const fixture = {
  minutes: [{ speaker: 'A', text: 'done?' }],
  decision: { keep: { 'a.jpg': 'ok' }, aside: { 'b.jpg': 'bad' } }
};

describe('reply schema', () => {
  it('validates fixture', () => {
    expect(() => Reply.parse(fixture)).not.toThrow();
  });
});
```

### File: ./README.md.orig
```
# photo‑select

A command‑line workflow that **selects 10 random images, asks ChatGPT which to “keep” or “set aside,”
moves the files accordingly, and then recurses until a directory is fully triaged.**

## Documentation Quick-Links
* [Architecture guide](docs/architecture.md)
* [Agents contract](docs/agents.md)
* [Glossary](docs/glossary.md)


---

## Requirements

- Node 20+
- An OpenAI API key (via `OPENAI_API_KEY` or the `--api-key` flag)
  ```bash
  export OPENAI_API_KEY="sk‑..."
  ```

* macOS, Linux, or Windows‑WSL (uses only cross‑platform Node APIs)
* [`patch`](https://man7.org/linux/man-pages/man1/patch.1.html) binary or the Python `patch-ng` package

## Installation

```bash
cd photo-select
nvm install   # obeys .nvmrc (Node 20.x)
nvm use
```

### 2  Configure your API key

1. Copy the template:

   ```bash
   cp .env.example .env
   ```

2. Paste your real key in `.env`:

   ```dotenv
   OPENAI_API_KEY=sk-...
   ```

No need to `export` the key in every shell—`dotenv` loads it automatically.

### 3  Install dependencies

```bash
npm install
chmod +x src/index.js    # fix permission error when running with npx
```

Invoke the CLI from the project directory using `npx`:

```bash
npx photo-select [--dir /path/to/images] [--prompt /path/to/prompt.txt] [--model gpt-4o] [--api-key sk-...] [--context /path/to/context.txt]
```

You can also install globally with `npm install -g` to run `photo-select` anywhere.

## Usage

```bash
# run from the project directory
npx photo-select [--dir /path/to/images] [--prompt /path/to/prompt.txt] [--model gpt-4o] [--api-key sk-...] [--context /path/to/context.txt]
# or, if installed globally:
photo-select [--dir /path/to/images] [--prompt /path/to/prompt.txt] [--model gpt-4o] [--api-key sk-...] [--context /path/to/context.txt]
```

Run `photo-select --help` to see all options.

### photo-select-here.sh

If you keep the repository cloned on your system, the `photo-select-here.sh`
script lets you run the CLI on whatever directory you're currently in without
typing `--dir` each time. Call it with the path to the script:

```bash
/path/to/photo-select/photo-select-here.sh [photo-select flags]
```

The script automatically:

1. Loads `nvm` and uses the Node version defined in `.nvmrc` if available.
2. Runs `npx photo-select` inside the repo.
3. Sets `--dir` to your current working directory unless you specify it
   explicitly.

All CLI flags—including `--api-key`, `--model`, and `--no-recurse`—can be passed
through to the script unchanged.

### Flags

| flag       | default                      | description                                     |
| ---------- | ---------------------------- | ----------------------------------------------- |
| `--dir`    | current directory            | Source directory containing images              |
| `--prompt` | `prompts/default_prompt.hbs` | Path to a custom prompt file                    |
| `--model`  | `gpt-4o`                | Any chat‑completion model id you have access to. Can also be set via `$PHOTO_SELECT_MODEL`. |
| `--api-key` | *(unset)*                  | OpenAI API key. Overrides `$OPENAI_API_KEY`. |
| `--curators` | *(unset)* | Comma-separated list of curator names used in the group transcript |
| `--context` | *(unset)* | Text file with exhibition context for the curators |
| `--no-recurse` | `false` | Process only the given directory without descending into `_keep` |
<<<<<<< HEAD
| `--field-notes` | `false` | Maintain a `field-notes.md` notebook in each `_level-NNN/` folder |
| `--show-prompt` | `false` | Print the rendered prompt text before each API call |

Prompt files are Handlebars templates. Values such as `curators`, `context`, and
previous `fieldNotes` are injected when each request is built.
=======
| `--field-notes` | `false` | Enable living field-notes.md generation with curator diff workflow |
>>>>>>> c9b694f43b57626b45333a3d1c23ab86a8bdf6d8

### People metadata (optional)

Set `PHOTO_FILTER_API_BASE` to the base URL of your [photo‑filter](https://github.com/openhouse/photo-filter) service to include face‑tag data in the prompt. For each image the CLI fetches `/api/photos/by-filename/<filename>/persons` and sends a JSON blob like `{ "filename": "DSCF1234.jpg", "people": ["Alice", "Bob"] }` before the image itself. Results are cached per filename for the duration of the run.

Example:

```bash
PHOTO_FILTER_API_BASE=http://localhost:3000 \
/path/to/photo-select/photo-select-here.sh --api-key sk-... --model o3 \
  --curators "Ingeborg Gerdes, Alexandra Munroe, Mandy Steinback, Kendell Harbin, Erin Zona, Madeline Gallucci, Deborah Treisman" \
  --context /path/to/info.md
```

### Field-Notes Mode

When `--field-notes` is enabled the tool keeps a living `field-notes.md` next to every `_level-NNN` directory it creates.
Each notebook starts empty and is updated after every batch of photos using the curator diff workflow.

```
001/
  DSCF0001.jpg
  DSCF0002.jpg
  field-notes.md
```

The first pass provides the current file and short instructions so curators can propose a patch.
If the diff applies, the writer appends a timestamp comment and saves the new text.
Bare filenames like `[DSCF0001.jpg]` automatically link to files in the same directory.
If more than three inline images are embedded (`![]()`), a warning is added at the bottom.
Disable the feature by omitting the flag.

Example citation:

```markdown
We observed damage on [DSCF0001.jpg]
```
becomes
```markdown
We observed damage on [DSCF0001.jpg](./DSCF0001.jpg)
```


## Supported OpenAI models

The CLI calls the Chat Completions API and automatically switches to `/v1/responses` if a model only supports that endpoint. Any vision-capable chat model listed on OpenAI's [models](https://platform.openai.com/docs/models) page should work, including:


* **GPT‑4.1 family** – `gpt-4.1`, `gpt-4.1-mini`, and `gpt-4.1-nano`
* **GPT‑4o family** – `gpt-4o` (default), `gpt-4o-mini`, `gpt-4o-audio-preview`,
  `gpt-4o-mini-audio-preview`, `gpt-4o-realtime-preview`,
  `gpt-4o-mini-realtime-preview`, `gpt-4o-search-preview`, and
  `gpt-4o-mini-search-preview`
* **o‑series reasoning models** – `o4-mini`, `o3`, `o3-pro` *(responses API)*,
  `o3-mini`, `o1`, `o1-pro`, and the deprecated `o1-mini`
* **Other vision models** – `gpt-4-turbo`, `gpt-4.5-preview` *(deprecated)*. The
  `gpt-4-vision-preview` model has been removed.

Example output of `openai api models.list`:

```text
gpt-4.1-nano
gpt-4.1-nano-2025-04-14
gpt-4.5-preview
gpt-4.5-preview-2025-02-27
gpt-4o
gpt-4o-2024-05-13
gpt-4o-2024-08-06
gpt-4o-2024-11-20
gpt-4o-audio-preview
gpt-4o-audio-preview-2024-10-01
gpt-4o-audio-preview-2024-12-17
gpt-4o-audio-preview-2025-06-03
gpt-4o-mini
gpt-4o-mini-2024-07-18
gpt-4o-mini-audio-preview
gpt-4o-mini-audio-preview-2024-12-17
gpt-4o-mini-realtime-preview
gpt-4o-mini-realtime-preview-2024-12-17
gpt-4o-mini-search-preview
gpt-4o-mini-search-preview-2025-03-11
gpt-4o-realtime-preview
gpt-4o-realtime-preview-2024-10-01
gpt-4o-realtime-preview-2024-12-17
gpt-4o-realtime-preview-2025-06-03
gpt-4o-search-preview
gpt-4o-search-preview-2025-03-11
o1
o1-2024-12-17
o1-mini
o1-mini-2024-09-12
o1-pro
o1-pro-2025-03-19
o3
o3-2025-04-16
o3-mini
o3-mini-2025-01-31
o3-pro
o3-pro-2025-06-10
o4-mini
o4-mini-2025-04-16
```
These names match the model ids provided by the OpenAI Node SDK, as seen in its
[type definitions](node_modules/openai/resources/beta/assistants.d.ts).

Models in the `o` series use the new `max_completion_tokens` parameter instead of
the deprecated `max_tokens`. When the CLI falls back to the Responses API, that
option is called `max_output_tokens`. Both are handled automatically based on
the model you specify.

### Estimated costs

The cost depends on the number of tokens generated from your images. Roughly
speaking, a single 6240 × 4160 image is about 8,000 input tokens. Processing the
full 315‑photo set therefore uses about 2.5 million input tokens plus roughly
250k output tokens.

Approximate price per run:

| model          | input $/1M | output $/1M | est. cost on 315 photos |
| -------------- | ---------- | ----------- | ---------------------- |
| `gpt-4.1`      | $2.00      | $8.00       | ~$7 |
| `gpt-4.1-mini` | $0.40      | $1.60       | ~$1.4 |
| `gpt-4.1-nano` | $0.10      | $0.40       | ~$0.35 |
| `o4-mini`      | $1.10      | $4.40       | ~$3.85 |
| `o3`           | $2.00      | $8.00       | ~$7 |
| `o3-pro`       | $20.00     | $80.00      | ~$70 |
| `o3-mini`      | $1.10      | $4.40       | ~$3.85 |
| `o1`           | $15.00     | $60.00      | ~$52.5 |
| `o1-pro`       | $150.00    | $600.00     | ~$525 |
| `gpt-4o`       | $2.50      | $10.00      | ~$9 |
| `gpt-4o-mini`  | $0.15      | $0.60       | ~$0.55 |
| `gpt-4-turbo`  | $10.00     | $30.00      | ~$33 |
| `gpt-4.5-preview`      | $75.00     | $150.00     | ~$225 |
| `gpt-4`        | $30.00     | $60.00      | ~$90 |

These figures are approximate and based on current
[OpenAI pricing](https://openai.com/pricing). Actual costs will vary with output
length and any image resizing.

### Measuring model quality

There is no public benchmark for photo triage, so the best approach is to
create a small validation set—say 30–50 images—with your own "keep" vs. "aside"
labels. Run the CLI on this set with different models (using `--model` or
`PHOTO_SELECT_MODEL`) and save the results. Comparing those decisions to your
labels lets you compute precision, recall, and F1‑score for each model. Repeating
the process on multiple batches will highlight which model gives the most
consistent choices.

The tool creates `_keep` and `_aside` sub‑folders inside every directory it touches.

### Example: A/B testing models

You can duplicate a directory of images and run the script on each copy with
different `--model` values. Each run writes its own `_keep` and `_aside` folders
so you can compare the results side by side.

```bash
# prepare two identical folders
mkdir trial-gpt-4o trial-gpt-4.5-preview
cp /path/to/source/*.jpg trial-gpt-4o/
cp /path/to/source/*.jpg trial-gpt-4.5-preview/

# run with GPT‑4o
/path/to/photo-select/photo-select-here.sh --model gpt-4o --dir trial-gpt-4o --api-key sk-... --context /path/to/context.txt

# run with GPT‑4.5-preview
/path/to/photo-select/photo-select-here.sh --model gpt-4.5-preview --dir trial-gpt-4.5-preview --api-key sk-... --context /path/to/context.txt
```

If you see repeated `OpenAI error (404)` messages, your API key may not have
access to that model or the id is misspelled. Check `openai models:list` to
confirm which ids are enabled for your account. Models that require the
`/v1/responses` endpoint—such as `o1-pro` or `o3-pro`—are automatically routed
through that API, so no extra flags are needed.


## Recursion logic

1. Pick up to 10 random images (all common photo extensions).
2. Send them to ChatGPT with the prompt (filenames included).
3. ChatGPT replies with meeting minutes summarising a short discussion among the curators, followed by a JSON object indicating which files to keep or set aside and why.
4. Parse that JSON to determine which files were explicitly labeled `keep` or `aside` and capture any notes about each image.
5. Move those files to the corresponding sub‑folders and write a text file containing the notes next to each image. Files omitted from the decision block remain in place for the next batch so the model can review them again. Meeting minutes are saved as `minutes-<timestamp>.txt` in the directory.
6. Re‑run the algorithm on the newly created `_keep` folder (unless `--no-recurse`).
   If every photo at a level is kept or every photo is set aside, recursion stops early.
7. On the first pass of each level a `_level-XXX` folder is created next to `_keep` and `_aside` containing a snapshot of the images originally present.
8. If `--field-notes` is enabled, the same directory holds a `field-notes.md` notebook updated by the curators in two passes.
9. Stop when a directory has zero unclassified images.

### JSON mode

The OpenAI request uses `response_format: { type: "json_object" }` so the
assistant replies with strict JSON. This avoids needing to strip Markdown
fences and guarantees parseable output.
The CLI allows up to 4096 tokens in each reply (see `MAX_RESPONSE_TOKENS` in
`src/chatClient.js`) so the minutes and JSON decision block are returned in
full.

## Caching

Responses from OpenAI are cached under a `.cache` directory using a hash of the
prompt, model, and file metadata. Subsequent runs with the same inputs reuse the
saved reply instead of hitting the API.

### Exporting provenance

Run `node scripts/export_sqlite.js` after a session to build `prompts.sqlite`
containing prompts and raw replies for each level. Inspect the result with
`datasette inspect prompts.sqlite`.

## Testing

```bash
npm test
```

The **Vitest** suite covers random selection, safe moves, and response‑parsing.

---

## Development tips

- Use `nvm use` in every new shell (or add a shell hook).
- Need a different Node version temporarily? `nvm exec 18 npm test`.
- `.env` is ignored by git—share `.env.example` instead.

---

## Inspiration

Built to replace a manual workflow that relied on Finder tags and the ChatGPT web UI.
Now everything—random choice, conversation, and file moves—happens automatically in the shell.
```

### File: ./docs
```
(File type is inode/directory — skipping raw dump.)
```

### File: ./docs/agents.md.orig
```
# Agents Contract  · Photo-Select

<<<<<<< HEAD
<<<<<<< HEAD
---
schema_version: 2
updated: 2025-07-05
---

This document **must be loaded by any code-assistant before touching the repo.**
It defines binding constraints for all prompt templates. Any change here **must**
increment `schema_version` and update tests.

## 1  Synthetic Voices
| Id | Role in Minutes | Style | Required Closing Question | May Edit Field-Notes? | Psychology Cue | Example Utterance |
|----|-----------------|-------|---------------------------|-----------------------|----------------|------------------|
| *Curator-A* | “Ingeborg Gerdes” | aesthetic, formal | optional | yes | reflective | "Notice the diffuse glow here." |
| *Curator-B* | “Alexandra Munroe” | scholarly, contextual | optional | yes | analytic | "This recalls earlier site works." |
| … | … | … | optional | yes | varied | "…" |
| Facilitator | “Jamie (off-stage)” | session framing only | never | no | pragmatic | "Next batch coming up." |

### schema_duty per persona
*Curator-A*
schema_duty: ensures field_notes_diff syntax is valid unified diff.

*Curator-B*
schema_duty: checks contextual accuracy in minutes.

*Facilitator*
schema_duty: none; outside minutes/decisions.

> **Rule:** Minutes **always** stay within the personas above.
> **Rule:** Decisions follow minutes, never interwoven.
> **Rule:** Minutes end with a forward-looking question from one curator.
=======
=======
>>>>>>> d094a92de9c6b4b7abda877a9e161037ca186e86
This document **must be loaded by any code-assistant before touching the repo.**

## 1  Synthetic Voices
| Id | Role in Minutes | Style |
|----|-----------------|-------|
| *Curator-A* | “Ingeborg Gerdes” | aesthetic, formal |
| *Curator-B* | “Alexandra Munroe” | scholarly, contextual |
| … | … | … |
| Facilitator | “Jamie (off-stage)” | session framing only |

> **Rule:** Minutes **always** stay within the personas above.  
> **Rule:** Decisions follow minutes, never interwoven.
<<<<<<< HEAD
>>>>>>> 0890d84fef0310c2fe9bb5c155815202b945b78d
=======
>>>>>>> d094a92de9c6b4b7abda877a9e161037ca186e86

## 2  Two-Pass Field-Notes Workflow
| Phase | LLM Output | Parser expectation |
|-------|------------|--------------------|
| 1st pass | `field_notes_diff` **OR** `field_notes_md` | `expectFieldNotesDiff = true` |
| 2nd pass (if diff) | `field_notes_md` | `expectFieldNotesMd = true` |

The *same* curator voices and context must be provided in both passes.

## 3  Prompt Template Placeholders
| Placeholder | Source |
|-------------|--------|
| `{{curators}}` | CLI `--curators` flag |
| `{{context}}` | CLI `--context` file |
| `{{fieldNotes}}` | previous notebook text |

## 4  Coding Standards
* No business logic in `.hbs`; keep them data-driven.  
* Pure functions live under `src/core/`; they receive **all** inputs explicitly.  
* Mutations to `cacheKey` MUST bump version (prefix string).

*(Last edited: 2025-07-05)*
```

### File: ./docs/architecture.md
```
# Photo-Select – Architecture at a Glance
├─ src/                     ← runtime code
│  ├─ cli/                  ← thin Cmd+Option wrappers (index.js only calls into here)
│  ├─ core/                 ← domain logic (triageDirectory, FieldNotesWriter, etc.)
│  ├─ adapters/             ← I/O edges: chatClient (OpenAI), imageSelector (fs), peopleApi
│  └─ templates/            ← compiled HBS strings (wired up at build time)
├─ prompts/                 ← raw *.hbs & *.txt prompt sources
├─ docs/                    ← human-readable guides
│  ├─ architecture.md       ← **you are here**
│  ├─ agents.md             ← prompt-engineering contract (see below)
│  └─ glossary.md           ← canonical vocabulary
└─ tests/                   ← Vitest; keep unit & integration separate

## Key patterns
1. **HBS as “configuration, not code.”**
Treat every Handlebars template exactly like a JSON schema: no business logic inside, just placeholders. The runtime helper (`renderTemplate`) already enforces this.
2. **Adapters > Services > Pure functions.**
   - Adapters know about network, fs, OpenAI.
   - Services orchestrate adapters (e.g. `triageDirectory`).
   - Pure functions (e.g. `parseReply`) have zero side-effects and live under `src/core/`.
3. **Prompt lifecycle.**

```
template.hbs  →  renderTemplate(data)  →  prompt string
prompt string + images  →  chatClient  →  JSON reply
JSON reply  →  pure parser  →  move/apply/write
```

4. **Second-pass prompts.**
Strip the addon rules before nesting the original prompt to avoid instruction collision (already noted; implementation pending).
5. **Cache keys are contracts.**
If you touch anything that changes the cacheKey hash inputs, bump the cache-version prefix so old replies don’t leak into new logic.
```

### File: ./docs/glossary.md
```
# Photo-Select – Core Concepts

**Batch** – A set of ≤ 10 images funnelled through a single prompt/response round.

**Curators (Agents)** – Named voices who appear in the “minutes” section.  
They function as *thinking styles* the LLM can adopt (e.g. technical, poetic).

**Facilitator** – Jamie’s voice; she does *not* appear in JSON minutes but frames the session.

**Minutes** – A diarised conversation (array of `{ speaker, text }`) capturing how consensus was reached.

**Decision Block** – Strict JSON `{ keep, aside }`, optionally enriched with `field_notes_diff`.

**Field Notes** – Markdown notebook (`field-notes.md`) evolving in two passes.  
First pass returns a diff; second pass resolves to the full document.

**Level Directory** – `_level-NNN/` snapshot preserving original files for provenance.

**Adapter** – Boundary module that converts between external systems (OpenAI, filesystem) and pure functions.

**Service** – Coordinator function (e.g. `triageDirectory`) that expresses application use-cases in terms of adapters & pure functions.
```

### File: ./docs/glossary.md.orig
```
# Photo-Select – Core Concepts

**Batch** – A set of ≤ 10 images funnelled through a single prompt/response round.

**Curators (Agents)** – Named voices who appear in the “minutes” section.  
They function as *thinking styles* the LLM can adopt (e.g. technical, poetic).

**Facilitator** – Jamie’s voice; she does *not* appear in JSON minutes but frames the session.

**Minutes** – A diarised conversation (array of `{ speaker, text }`) capturing how consensus was reached.

**Decision Block** – Strict JSON `{ keep, aside }`, optionally enriched with `field_notes_diff`.

**Field Notes** – Markdown notebook (`field-notes.md`) evolving in two passes.  
First pass returns a diff; second pass resolves to the full document.

**Level Directory** – `_level-NNN/` snapshot preserving original files for provenance.

**Adapter** – Boundary module that converts between external systems (OpenAI, filesystem) and pure functions.

**Service** – Coordinator function (e.g. `triageDirectory`) that expresses application use-cases in terms of adapters & pure functions.
<<<<<<< HEAD
<<<<<<< HEAD

**Prompt Snapshot** – A `.prompt.txt` file stored in each level directory containing the exact text sent to the model for reproducibility.
=======
>>>>>>> 0890d84fef0310c2fe9bb5c155815202b945b78d
=======
>>>>>>> d094a92de9c6b4b7abda877a9e161037ca186e86
```

### File: ./docs/agents.md
```
# Agents Contract · Photo‑Select

_(Last edited 2025‑07‑05)_

This file is **ingested by ChatGPT Codex (or any code‑assistant) before it may alter the repository**.  
Its contents are _immutable contracts_, **not** sprint instructions.

---

## 0  Preface — Why a Contract?

Photo‑Select treats language models as synthetic colleagues.  
The contract protects:

1. **Narrative coherence** – curator voices stay consistent.
2. **Data provenance** – every action is auditable from raw image → minutes → Git commit.
3. **Security & determinism** – outputs are machine‑parseable, no hidden state.

---

## 1  Voice Registry (immutable)

| ID          | Display Name      | Style Guide           |
| ----------- | ----------------- | --------------------- |
| Curator‑A   | Ingeborg Gerdes   | analytic, formal      |
| Curator‑B   | Alexandra Munroe  | scholarly, contextual |
| Curator‑C   | Deborah Treisman  | narrative, pace‑aware |
| Curator‑D   | Warren Sack       | systems‑thinking      |
| Facilitator | Jamie (off‑stage) | frames session only   |

> **Rule:** `minutes[*].speaker` **must** equal one of the _Display Name_ values—no aliases.

---

## 2  Workflow Phases

| Phase                  | Expected LLM Output Keys                             | Parser Mode         |
| ---------------------- | ---------------------------------------------------- | ------------------- |
| **Triage**             | `minutes`, `decision`, _optional_ `field_notes_diff` | `expectDiff = true` |
| **Act II** _(if diff)_ | `field_notes_md`                                     | `expectMd = true`   |

LLM receives identical personas, context, and filename whitelist in both passes.

---

## 3  Reply Schema Invariants

- **minutes** → `array<{ speaker:string, text:string }>`; last `text` ends with a forward‑looking question.
- **decision** → _object_ with optional keys **exactly** `"keep"` and `"aside"`; each maps `filename → rationale`.
- **field_notes_diff** or **field_notes_md** as per Phase rules.
- **No additional top‑level keys**.

---

## 4  Prompt Placeholders

| Placeholder      | Source            | Required                  |
| ---------------- | ----------------- | ------------------------- |
| `{{curators}}`   | CLI `--curators`  | ✓                         |
| `{{images}}`     | runtime file scan | ✓                         |
| `{{context}}`    | `--context` file  | optional                  |
| `{{fieldNotes}}` | prior notebook    | when `--field-notes` flag |

---

## 5  LLM Guardrails

1. **Deterministic inputs** – filename whitelist, persona list, allowed JSON keys repeated in _system_ and _user_ messages.
2. **JSON‑only outputs** – Codex must implement one automatic retry on `JSON.parse` failure, then fail loudly.
3. **No hidden state** – all deliberation lives in `minutes`; model memory is forbidden.

---

## 6  Provenance Requirements

- Compute `sha256(filename)` for every image; store alongside filename in SQLite.
- Commit the LLM response JSON **and** the updated `field‑notes.md` in a single atomic Git commit.

---

## 7  Coding Doctrine

- Business logic never resides in `.hbs` templates—prompts are data‑only.
- Pure functions live under `src/core/`; they receive **all** inputs explicitly.
- Mutating a cached structure **must** bump `cacheKey` prefix.

---

## 8  North‑Star Principles

- **≥ 99 % JSON validity** across the test suite.
- Optimise for verifiable auditability and user interpretability over raw speed.
- Preserve curator voice authenticity in every change.

---

Violating this contract constitutes a **breaking change** and requires a major version bump.
```

### File: ./README.md
```
# photo‑select

A command‑line workflow that **selects 10 random images, asks ChatGPT which to “keep” or “set aside,”
moves the files accordingly, and then recurses until a directory is fully triaged.**

## Documentation Quick-Links
* [Architecture guide](docs/architecture.md)
* [Agents contract](docs/agents.md)
* [Glossary](docs/glossary.md)


---

## Requirements

- Node 20+
- An OpenAI API key (via `OPENAI_API_KEY` or the `--api-key` flag)
  ```bash
  export OPENAI_API_KEY="sk‑..."
  ```

* macOS, Linux, or Windows‑WSL (uses only cross‑platform Node APIs)
* [`patch`](https://man7.org/linux/man-pages/man1/patch.1.html) binary or the Python `patch-ng` package

## Installation

```bash
cd photo-select
nvm install   # obeys .nvmrc (Node 20.x)
nvm use
```

### 2  Configure your API key

1. Copy the template:

   ```bash
   cp .env.example .env
   ```

2. Paste your real key in `.env`:

   ```dotenv
   OPENAI_API_KEY=sk-...
   ```

No need to `export` the key in every shell—`dotenv` loads it automatically.

### 3  Install dependencies

```bash
npm install
chmod +x src/index.js    # fix permission error when running with npx
```

Invoke the CLI from the project directory using `npx`:

```bash
npx photo-select [--dir /path/to/images] [--prompt /path/to/prompt.txt] [--model gpt-4o] [--api-key sk-...] [--context /path/to/context.txt]
```

You can also install globally with `npm install -g` to run `photo-select` anywhere.

## Usage

```bash
# run from the project directory
npx photo-select [--dir /path/to/images] [--prompt /path/to/prompt.txt] [--model gpt-4o] [--api-key sk-...] [--context /path/to/context.txt]
# or, if installed globally:
photo-select [--dir /path/to/images] [--prompt /path/to/prompt.txt] [--model gpt-4o] [--api-key sk-...] [--context /path/to/context.txt]
```

Run `photo-select --help` to see all options.

### photo-select-here.sh

If you keep the repository cloned on your system, the `photo-select-here.sh`
script lets you run the CLI on whatever directory you're currently in without
typing `--dir` each time. Call it with the path to the script:

```bash
/path/to/photo-select/photo-select-here.sh [photo-select flags]
```

The script automatically:

1. Loads `nvm` and uses the Node version defined in `.nvmrc` if available.
2. Runs `npx photo-select` inside the repo.
3. Sets `--dir` to your current working directory unless you specify it
   explicitly.

All CLI flags—including `--api-key`, `--model`, and `--no-recurse`—can be passed
through to the script unchanged.

### Flags

| flag       | default                      | description                                     |
| ---------- | ---------------------------- | ----------------------------------------------- |
| `--dir`    | current directory            | Source directory containing images              |
| `--prompt` | `prompts/default_prompt.hbs` | Path to a custom prompt file                    |
| `--model`  | `gpt-4o`                | Any chat‑completion model id you have access to. Can also be set via `$PHOTO_SELECT_MODEL`. |
| `--api-key` | *(unset)*                  | OpenAI API key. Overrides `$OPENAI_API_KEY`. |
| `--curators` | *(unset)* | Comma-separated list of curator names used in the group transcript |
| `--context` | *(unset)* | Text file with exhibition context for the curators |
| `--show-prompt` | `false` | Print the rendered prompt text before each API call |
| `--no-recurse` | `false` | Process only the given directory without descending into `_keep` |
| `--field-notes` | `false` | Enable living field-notes.md generation with curator diff workflow |

### People metadata (optional)

Set `PHOTO_FILTER_API_BASE` to the base URL of your [photo‑filter](https://github.com/openhouse/photo-filter) service to include face‑tag data in the prompt. For each image the CLI fetches `/api/photos/by-filename/<filename>/persons` and sends a JSON blob like `{ "filename": "DSCF1234.jpg", "people": ["Alice", "Bob"] }` before the image itself. Results are cached per filename for the duration of the run.

Example:

```bash
PHOTO_FILTER_API_BASE=http://localhost:3000 \
/path/to/photo-select/photo-select-here.sh --api-key sk-... --model o3 \
  --curators "Ingeborg Gerdes, Alexandra Munroe, Mandy Steinback, Kendell Harbin, Erin Zona, Madeline Gallucci, Deborah Treisman" \
  --context /path/to/info.md
```

### Field-Notes Mode

When `--field-notes` is enabled the tool keeps a living `field-notes.md` next to every `_level-NNN` directory it creates.
Each notebook starts empty and is updated after every batch of photos using the curator diff workflow.

```
001/
  DSCF0001.jpg
  DSCF0002.jpg
  field-notes.md
```

The first pass provides the current file and short instructions so curators can propose a patch.
If the diff applies, the writer appends a timestamp comment and saves the new text.
Bare filenames like `[DSCF0001.jpg]` automatically link to files in the same directory.
If more than three inline images are embedded (`![]()`), a warning is added at the bottom.
Disable the feature by omitting the flag.

Example citation:

```markdown
We observed damage on [DSCF0001.jpg]
```
becomes
```markdown
We observed damage on [DSCF0001.jpg](./DSCF0001.jpg)
```


## Supported OpenAI models

The CLI calls the Chat Completions API and automatically switches to `/v1/responses` if a model only supports that endpoint. Any vision-capable chat model listed on OpenAI's [models](https://platform.openai.com/docs/models) page should work, including:


* **GPT‑4.1 family** – `gpt-4.1`, `gpt-4.1-mini`, and `gpt-4.1-nano`
* **GPT‑4o family** – `gpt-4o` (default), `gpt-4o-mini`, `gpt-4o-audio-preview`,
  `gpt-4o-mini-audio-preview`, `gpt-4o-realtime-preview`,
  `gpt-4o-mini-realtime-preview`, `gpt-4o-search-preview`, and
  `gpt-4o-mini-search-preview`
* **o‑series reasoning models** – `o4-mini`, `o3`, `o3-pro` *(responses API)*,
  `o3-mini`, `o1`, `o1-pro`, and the deprecated `o1-mini`
* **Other vision models** – `gpt-4-turbo`, `gpt-4.5-preview` *(deprecated)*. The
  `gpt-4-vision-preview` model has been removed.

Example output of `openai api models.list`:

```text
gpt-4.1-nano
gpt-4.1-nano-2025-04-14
gpt-4.5-preview
gpt-4.5-preview-2025-02-27
gpt-4o
gpt-4o-2024-05-13
gpt-4o-2024-08-06
gpt-4o-2024-11-20
gpt-4o-audio-preview
gpt-4o-audio-preview-2024-10-01
gpt-4o-audio-preview-2024-12-17
gpt-4o-audio-preview-2025-06-03
gpt-4o-mini
gpt-4o-mini-2024-07-18
gpt-4o-mini-audio-preview
gpt-4o-mini-audio-preview-2024-12-17
gpt-4o-mini-realtime-preview
gpt-4o-mini-realtime-preview-2024-12-17
gpt-4o-mini-search-preview
gpt-4o-mini-search-preview-2025-03-11
gpt-4o-realtime-preview
gpt-4o-realtime-preview-2024-10-01
gpt-4o-realtime-preview-2024-12-17
gpt-4o-realtime-preview-2025-06-03
gpt-4o-search-preview
gpt-4o-search-preview-2025-03-11
o1
o1-2024-12-17
o1-mini
o1-mini-2024-09-12
o1-pro
o1-pro-2025-03-19
o3
o3-2025-04-16
o3-mini
o3-mini-2025-01-31
o3-pro
o3-pro-2025-06-10
o4-mini
o4-mini-2025-04-16
```
These names match the model ids provided by the OpenAI Node SDK, as seen in its
[type definitions](node_modules/openai/resources/beta/assistants.d.ts).

Models in the `o` series use the new `max_completion_tokens` parameter instead of
the deprecated `max_tokens`. When the CLI falls back to the Responses API, that
option is called `max_output_tokens`. Both are handled automatically based on
the model you specify.

### Estimated costs

The cost depends on the number of tokens generated from your images. Roughly
speaking, a single 6240 × 4160 image is about 8,000 input tokens. Processing the
full 315‑photo set therefore uses about 2.5 million input tokens plus roughly
250k output tokens.

Approximate price per run:

| model          | input $/1M | output $/1M | est. cost on 315 photos |
| -------------- | ---------- | ----------- | ---------------------- |
| `gpt-4.1`      | $2.00      | $8.00       | ~$7 |
| `gpt-4.1-mini` | $0.40      | $1.60       | ~$1.4 |
| `gpt-4.1-nano` | $0.10      | $0.40       | ~$0.35 |
| `o4-mini`      | $1.10      | $4.40       | ~$3.85 |
| `o3`           | $2.00      | $8.00       | ~$7 |
| `o3-pro`       | $20.00     | $80.00      | ~$70 |
| `o3-mini`      | $1.10      | $4.40       | ~$3.85 |
| `o1`           | $15.00     | $60.00      | ~$52.5 |
| `o1-pro`       | $150.00    | $600.00     | ~$525 |
| `gpt-4o`       | $2.50      | $10.00      | ~$9 |
| `gpt-4o-mini`  | $0.15      | $0.60       | ~$0.55 |
| `gpt-4-turbo`  | $10.00     | $30.00      | ~$33 |
| `gpt-4.5-preview`      | $75.00     | $150.00     | ~$225 |
| `gpt-4`        | $30.00     | $60.00      | ~$90 |

These figures are approximate and based on current
[OpenAI pricing](https://openai.com/pricing). Actual costs will vary with output
length and any image resizing.

### Measuring model quality

There is no public benchmark for photo triage, so the best approach is to
create a small validation set—say 30–50 images—with your own "keep" vs. "aside"
labels. Run the CLI on this set with different models (using `--model` or
`PHOTO_SELECT_MODEL`) and save the results. Comparing those decisions to your
labels lets you compute precision, recall, and F1‑score for each model. Repeating
the process on multiple batches will highlight which model gives the most
consistent choices.

The tool creates `_keep` and `_aside` sub‑folders inside every directory it touches.

### Example: A/B testing models

You can duplicate a directory of images and run the script on each copy with
different `--model` values. Each run writes its own `_keep` and `_aside` folders
so you can compare the results side by side.

```bash
# prepare two identical folders
mkdir trial-gpt-4o trial-gpt-4.5-preview
cp /path/to/source/*.jpg trial-gpt-4o/
cp /path/to/source/*.jpg trial-gpt-4.5-preview/

# run with GPT‑4o
/path/to/photo-select/photo-select-here.sh --model gpt-4o --dir trial-gpt-4o --api-key sk-... --context /path/to/context.txt

# run with GPT‑4.5-preview
/path/to/photo-select/photo-select-here.sh --model gpt-4.5-preview --dir trial-gpt-4.5-preview --api-key sk-... --context /path/to/context.txt
```

If you see repeated `OpenAI error (404)` messages, your API key may not have
access to that model or the id is misspelled. Check `openai models:list` to
confirm which ids are enabled for your account. Models that require the
`/v1/responses` endpoint—such as `o1-pro` or `o3-pro`—are automatically routed
through that API, so no extra flags are needed.


## Recursion logic

1. Pick up to 10 random images (all common photo extensions).
2. Send them to ChatGPT with the prompt (filenames included).
3. ChatGPT replies with meeting minutes summarising a short discussion among the curators, followed by a JSON object indicating which files to keep or set aside and why.
4. Parse that JSON to determine which files were explicitly labeled `keep` or `aside` and capture any notes about each image.
5. Move those files to the corresponding sub‑folders and write a text file containing the notes next to each image. Files omitted from the decision block remain in place for the next batch so the model can review them again. Meeting minutes are saved as `minutes-<timestamp>.txt` in the directory.
6. Re‑run the algorithm on the newly created `_keep` folder (unless `--no-recurse`).
   If every photo at a level is kept or every photo is set aside, recursion stops early.
7. On the first pass of each level a `_level-XXX` folder is created next to `_keep` and `_aside` containing a snapshot of the images originally present.
8. If `--field-notes` is enabled, the same directory holds a `field-notes.md` notebook updated by the curators in two passes.
9. Stop when a directory has zero unclassified images.

### JSON mode

The OpenAI request uses `response_format: { type: "json_object" }` so the
assistant replies with strict JSON. This avoids needing to strip Markdown
fences and guarantees parseable output.
The CLI allows up to 4096 tokens in each reply (see `MAX_RESPONSE_TOKENS` in
`src/chatClient.js`) so the minutes and JSON decision block are returned in
full.

## Caching

Responses from OpenAI are cached under a `.cache` directory using a hash of the
prompt, model, and file metadata. Subsequent runs with the same inputs reuse the
saved reply instead of hitting the API.

### Exporting provenance

Run `node scripts/export_sqlite.js` after a session to build `prompts.sqlite`
containing prompts and raw replies for each level. Inspect the result with
`datasette inspect prompts.sqlite`.

## Testing

```bash
npm test
```

The **Vitest** suite covers random selection, safe moves, and response‑parsing.

---

## Telemetry

If `.ps-stats.json` exists in the working directory, each triage batch appends
metrics about decision latency and notebook updates. Delete the file to opt out.

---

## Development tips

- Use `nvm use` in every new shell (or add a shell hook).
- Need a different Node version temporarily? `nvm exec 18 npm test`.
- `.env` is ignored by git—share `.env.example` instead.

---

## Inspiration

Built to replace a manual workflow that relied on Finder tags and the ChatGPT web UI.
Now everything—random choice, conversation, and file moves—happens automatically in the shell.
```

### File: ./.gitignore
```
# dependencies & build artifacts
/node_modules
/.env
.DS_Store
__pycache__/
```

### File: ./package.json
```
{
  "name": "photo-select",
  "version": "0.1.1",
  "description": "CLI tool to recursively triage fine‑art photos with ChatGPT 4.5",
  "type": "module",
  "bin": {
    "photo-select": "./src/index.js"
  },
  "scripts": {
    "start": "photo-select",
    "test": "vitest run"
  },
  "engines": {
    "node": ">=20"
  },
  "author": "Jamie Burkart",
  "license": "MIT",
  "dependencies": {
    "commander": "^12.0.0",
    "diff": "^8.0.2",
    "dotenv": "^16.5.0",
    "handlebars": "^4.7.8",
    "openai": "^4.0.0",
    "sharp": "^0.34.2",
    "zod": "^3.23.8"
  },
  "devDependencies": {
    "better-sqlite3": "^9.0.0",
    "vitest": "^1.5.0",
    "zod-to-json-schema": "^3.24.6"
  }
}
```

### File: ./reply.schema.json
```
{
  "$ref": "#/definitions/Reply",
  "definitions": {
    "Reply": {
      "type": "object",
      "properties": {
        "minutes": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "speaker": {
                "type": "string"
              },
              "text": {
                "type": "string"
              }
            },
            "required": [
              "speaker",
              "text"
            ],
            "additionalProperties": false
          }
        },
        "decision": {
          "type": "object",
          "properties": {
            "keep": {
              "type": "object",
              "additionalProperties": {
                "type": "string"
              }
            },
            "aside": {
              "type": "object",
              "additionalProperties": {
                "type": "string"
              }
            }
          },
          "additionalProperties": false
        },
        "field_notes_diff": {
          "type": "string"
        },
        "field_notes_md": {
          "type": "string"
        }
      },
      "required": [
        "minutes",
        "decision"
      ],
      "additionalProperties": false
    }
  },
  "$schema": "http://json-schema.org/draft-07/schema#"
}
```

### File: ./.nvmrc
```
20
```

### File: ./scripts
```
(File type is inode/directory — skipping raw dump.)
```

### File: ./scripts/export_sqlite.js
```
#!/usr/bin/env node
import fs from 'node:fs/promises';
import path from 'node:path';
import Database from 'better-sqlite3';
import { sha256 } from '../src/hash.js';

async function main() {
  const db = new Database('prompts.sqlite');
  db.exec(`CREATE TABLE IF NOT EXISTS levels(id INTEGER PRIMARY KEY AUTOINCREMENT, path TEXT, created TEXT);`);
  db.exec(`CREATE TABLE IF NOT EXISTS prompts(level_id INTEGER, ts TEXT, text TEXT, sha256 TEXT);`);
  db.exec(`CREATE TABLE IF NOT EXISTS replies(level_id INTEGER, ts TEXT, text TEXT, sha256 TEXT);`);
  db.exec(`CREATE TABLE IF NOT EXISTS images(level_id INTEGER, filename TEXT, sha256 TEXT);`);

  const entries = await fs.readdir('.', { withFileTypes: true });
  for (const ent of entries) {
    if (!ent.isDirectory() || !/^_level-\d+/.test(ent.name)) continue;
    const levelPath = path.resolve(ent.name);
    const stat = await fs.stat(levelPath);
    const info = db.prepare('INSERT INTO levels(path, created) VALUES (?, ?)').run(levelPath, stat.birthtime.toISOString());
    const id = info.lastInsertRowid;
    // hash original images
    const imgs = await fs.readdir(levelPath);
    for (const img of imgs) {
      if (/\.(jpg|jpeg|png|gif|tif|tiff|heic|heif)$/i.test(img)) {
        const p = path.join(levelPath, img);
        const hash = await sha256(p);
        db.prepare('INSERT INTO images(level_id, filename, sha256) VALUES (?,?,?)').run(id, img, hash);
      }
    }
    for (const kind of ['prompts', 'replies']) {
      const dir = path.join(levelPath, kind);
      let files = [];
      try { files = await fs.readdir(dir); } catch { continue; }
      for (const file of files) {
        const p = path.join(dir, file);
        const text = await fs.readFile(p, 'utf8');
        const hash = await sha256(p);
        db.prepare(`INSERT INTO ${kind}(level_id, ts, text, sha256) VALUES (?,?,?,?)`).run(id, file.replace(/[^0-9]/g, ''), text, hash);
      }
    }
  }
}

main().catch((err) => { console.error(err); process.exit(1); });
```

### File: ./scripts/pre-commit.js
```
#!/usr/bin/env node
import { execSync } from 'node:child_process';

try {
  const diff = execSync('git diff --cached --numstat -- "*field-notes.md"', { encoding: 'utf8' }).trim();
  if (!diff) process.exit(0);
  const [added, removed] = diff.split(/\s+/);
  if (Number(removed) > 0) {
    const patch = execSync('git diff --cached -- "*field-notes.md"', { encoding: 'utf8' });
    if (!patch.includes('{{obsolete}}')) {
      console.error('❌ field-notes.md deletions require {{obsolete}} tag');
      process.exit(1);
    }
  }
  console.log(`📚  +${added} lines of shared memory added`);
} catch (err) {
  console.error(err.message);
  process.exit(1);
}
```

### File: ./scripts/generate-overview.sh
```
#!/usr/bin/env bash
##############################################################################
# generate-overview.sh
#
# Generates a text-based overview of the 'ranked-choice' project and saves
# the result to 'project-overview.txt'. It includes:
#   1. A directory structure overview (via 'tree' or 'ls -R')
#   2. A single-pass approach to display textual contents of files:
#      - PDFs extracted as text, using pdftotext or OCR fallback.
#      - Plain text or JSON/XML files shown in full (with an exception
#        for 'generatedOutputs.json', which is summarized).
#      - Binary files noted but not shown in raw form.
#   3. Skips certain known directories and file patterns:
#      - .git, node_modules, dist, project-overview*, etc.
#   4. Concludes with a basic system report and optional Ollama models listing.
#
# This version uses GNU coreutils' gshuf to randomly sample objects from
# JSON arrays when processing 'generatedOutputs.json'.
#
# Usage:
#   ./scripts/generate-overview.sh
#
# Requirements:
#   - tree (optional, for nicer directory listing)
#   - pdftotext (Poppler) or Xpdf (for PDF text extraction)
#   - tesseract (optional, for OCR fallback if PDF has no embedded text)
#   - ollama (optional, to list installed local models)
#   - jq (for JSON processing)
#   - GNU coreutils (for gshuf, which may be installed via Homebrew coreutils)
#
# WARNING:
#   This script can expose sensitive data in 'project-overview.txt'.
#   Handle the resulting file with care!
##############################################################################

OUTPUT_FILE="project-overview.txt"

# Direct all script output into 'project-overview.txt'
exec > "$OUTPUT_FILE" 2>&1

echo "# Project Overview"
echo "Generated on: $(date)"
echo ""
echo "This script produces a comprehensive snapshot of all files in the ranked-choice project."
echo "Sensitive data could be exposed, so protect 'project-overview.txt' accordingly."
echo "---"
echo ""

##############################################################################
# 1) Directory Structure Overview
##############################################################################
echo "## 1. Directory Structure"
echo ""
if command -v tree >/dev/null 2>&1; then
  echo "Below is the tree of files/folders (excluding .git, node_modules, dist, project-overview*):"
  echo '```'
  tree -a -I ".git|.cache|node_modules|dist|project-overview*" .
  echo '```'
else
  echo "Below is the 'ls -R' style listing of files/folders (excluding .git, node_modules, dist, project-overview*)."
  echo "Install 'tree' for a more visual directory listing."
  echo '```'
  find . \
    -path "*/.git" -prune -o \
    -path "*/.cache" -prune -o \
    -path "*/node_modules" -prune -o \
    -path "*/dist" -prune -o \
    -name "project-overview*" -prune -o \
    -print
  echo '```'
fi

echo ""
echo "---"
echo ""

##############################################################################
# Function to summarize generatedOutputs.json
# - Prints stats on modelName, stage, promptUsed, timestamp range, and a random sample.
##############################################################################
summarize_generated_outputs() {
  local filePath="$1"

  echo "### Summaries for $filePath"
  echo ""

  if ! command -v jq >/dev/null 2>&1; then
    echo "(jq not installed. Cannot provide advanced summary. Only file note.)"
    return
  fi

  # Check file size and object count
  local fileSize
  fileSize=$(stat -c%s "$filePath" 2>/dev/null || stat -f%z "$filePath" 2>/dev/null)
  echo "File size (bytes): $fileSize"

  local totalCount
  totalCount=$(jq '. | length' "$filePath" 2>/dev/null)
  echo "Total JSON objects in $filePath: $totalCount"
  echo ""

  if [ "$totalCount" -eq 0 ] || [ "$totalCount" = "null" ]; then
    echo "(File is empty or not valid JSON.)"
    return
  fi

  # modelName distribution
  echo "#### modelName distribution (sorted by count desc):"
  jq 'group_by(.modelName)
      | map({modelName: .[0].modelName, count: length})
      | sort_by(.count)
      | reverse' "$filePath"
  echo ""

  # stage distribution
  echo "#### stage distribution (sorted by count desc):"
  jq 'group_by(.stage)
      | map({stage: .[0].stage, count: length})
      | sort_by(.count)
      | reverse' "$filePath"
  echo ""

  ## promptUsed distribution
  #echo "#### promptUsed distribution (sorted by count desc):"
  #jq 'group_by(.promptUsed)
  #    | map({promptUsed: .[0].promptUsed, count: length})
  #    | sort_by(.count)
  #    | reverse' "$filePath"
  #echo ""

  # timestamp min/max
  echo "#### timestamp range:"
  local minTimestamp
  local maxTimestamp
  minTimestamp=$(jq 'min_by(.timestamp) | .timestamp' "$filePath")
  maxTimestamp=$(jq 'max_by(.timestamp) | .timestamp' "$filePath")
  echo "Min timestamp: $minTimestamp"
  echo "Max timestamp: $maxTimestamp"
  echo ""

  # Sample size
  local sampleSize=1
  if [ "$totalCount" -lt "$sampleSize" ]; then
    sampleSize="$totalCount"
  fi

  echo "#### Sample $sampleSize object(s) from $filePath:"
  if command -v gshuf >/dev/null 2>&1; then
    # Use gshuf to randomize: output each element on one line, then shuffle, then reassemble into an array.
    jq -c '.[]' "$filePath" | gshuf -n "$sampleSize" | jq -s '.'
  else
    echo "(gshuf not found, falling back to last $sampleSize items.)"
    jq --arg c "$sampleSize" '. | (.[-($c|tonumber):])' "$filePath"
  fi
  echo ""
}

##############################################################################
# 2) Single-Pass: Full Content Dump of Files
##############################################################################
echo "## 2. Full Content Dump"
echo "This section provides a textual representation of each file, skipping certain directories and file patterns."
echo "PDF files are extracted as text if possible; binary files are noted but not shown in raw form."
echo ""

# Directories to skip anywhere in the repo
SKIP_DIRS=(.git node_modules dist .vscode .cache)

# File patterns to skip
SKIP_FILES=("*.lock" "yarn.lock" "package-lock.json" ".env" "project-overview*")

FIND_CMD=(find .)

# Exclude skip directories (anywhere in the path)
for dir in "${SKIP_DIRS[@]}"; do
  FIND_CMD+=( -path "*/$dir" -prune -o )
done

# Only proceed with -type f after pruning directories
FIND_CMD+=( -type f )

# Exclude skip files
for pattern in "${SKIP_FILES[@]}"; do
  FIND_CMD+=( \( -iname "$pattern" \) -prune -o )
done

FIND_CMD+=( -print )

mapfile -t ALL_FILES < <("${FIND_CMD[@]}" 2>/dev/null)

if [ ${#ALL_FILES[@]} -eq 0 ]; then
  echo "No files found based on skip rules."
else
  for file in "${ALL_FILES[@]}"; do
    # If it's the special file generatedOutputs.json, handle differently
    if [[ "$(basename "$file")" == "generatedOutputs.json" ]]; then
      echo "### File: $file"
      echo '```'
      echo "(Instead of a raw dump, providing summary & sample...)"
      echo '```'
      echo ""
      summarize_generated_outputs "$file"
      continue
    fi

    # If it's the special file evaluationResults.json, handle differently
    if [[ "$(basename "$file")" == "evaluationResults.json" ]]; then
      echo "### File: $file"
      echo '```'
      echo "(Instead of a raw dump, providing summary & sample...)"
      echo '```'
      echo ""
      summarize_generated_outputs "$file"
      continue
    fi


    echo "### File: $file"
    echo '```'
    MIME_TYPE=$(file --mime-type -b "$file" 2>/dev/null)

    case "$MIME_TYPE" in
      application/pdf)
        # Attempt PDF text extraction with pdftotext
        if command -v pdftotext >/dev/null 2>&1; then
          PDF_CONTENT=$(pdftotext "$file" - 2>/dev/null)
          if [ -n "$PDF_CONTENT" ]; then
            echo "$PDF_CONTENT"
          else
            # Possibly scanned PDF, try OCR fallback if tesseract is available
            echo "(No embedded text found. Attempting OCR with tesseract...)"
            if command -v tesseract >/dev/null 2>&1; then
              TEMP_TXT=$(mktemp /tmp/ocr.XXXXXX)
              tesseract "$file" "$TEMP_TXT" 2>/dev/null
              if [ -f "${TEMP_TXT}.txt" ]; then
                cat "${TEMP_TXT}.txt"
                rm -f "${TEMP_TXT}.txt"
              else
                echo "(Tesseract failed or produced no output.)"
              fi
            else
              echo "(Tesseract not installed, cannot OCR scanned PDFs.)"
            fi
          fi
        else
          echo "(pdftotext not installed, skipping direct PDF text extraction...)"
        fi
        ;;
      text/*|application/xml|application/json)
        # For normal JSON files, etc., just dump them
        # (But we've already handled generatedOutputs.json separately)
        cat "$file"
        ;;
      *)
        echo "(File type is $MIME_TYPE — skipping raw dump.)"
        ;;
    esac
    echo '```'
    echo ""
  done
fi

echo ""
echo "---"
echo ""

##############################################################################
# 3) Basic System Report
##############################################################################
echo "## 3. Basic System Report"
echo ""
echo "Below is a snapshot of the system’s OS, architecture, date, uptime, disk usage, and memory usage."
echo ""

echo "### OS & Architecture"
echo '```'
if command -v uname >/dev/null 2>&1; then
  uname -a
else
  echo "(Command 'uname' not found.)"
fi
echo '```'
echo ""

echo "### Detailed OS Version"
echo '```'
if [ "$(uname)" = "Darwin" ]; then
  if command -v sw_vers >/dev/null 2>&1; then
    sw_vers
  else
    echo "(sw_vers not available on this macOS system.)"
  fi
elif [ -f /etc/os-release ]; then
  cat /etc/os-release
elif command -v lsb_release >/dev/null 2>&1; then
  lsb_release -a
else
  echo "(No /etc/os-release or 'lsb_release' command found.)"
fi
echo '```'
echo ""

echo "### Current Date & Uptime"
echo '```'
date
if command -v uptime >/dev/null 2>&1; then
  uptime
else
  echo "(Command 'uptime' not found.)"
fi
echo '```'
echo ""

echo "### Disk Usage"
echo '```'
df -h
echo '```'
echo ""

echo "### Memory Usage"
echo '```'
if command -v free >/dev/null 2>&1; then
  free -mh
else
  echo "(Command 'free' not found on this system.)"
fi
echo '```'
echo ""

echo "### Installed RAM"
echo '```'
if [ "$(uname)" = "Darwin" ]; then
  # On macOS, gather memory info with system_profiler
  if command -v system_profiler >/dev/null 2>&1; then
    system_profiler SPMemoryDataType
  else
    echo "(system_profiler not found on this macOS system.)"
  fi
else
  # On Linux, try dmidecode if available
  if command -v dmidecode >/dev/null 2>&1; then
    sudo dmidecode -t memory | grep -i "Size"
  else
    echo "(dmidecode not found, skipping installed memory info.)"
  fi
fi
echo '```'
echo ""

##############################################################################
# 4) Additional ML-Focused System Details
##############################################################################
echo "## 4. Additional ML-Focused System Details"
echo ""

echo "### GPU and CUDA Information"
echo '```'
if command -v nvidia-smi >/dev/null 2>&1; then
  echo "[nvidia-smi]"
  nvidia-smi
else
  echo "(nvidia-smi not found or no NVIDIA GPU installed.)"
fi

if [ "$(uname)" = "Darwin" ]; then
  echo ""
  echo "[system_profiler SPDisplaysDataType]"
  system_profiler SPDisplaysDataType
fi
echo '```'
echo ""

# echo "### Python Environment & Packages"
# echo '```'
# if command -v python3 >/dev/null 2>&1; then
#   echo "[python3 -V]"
#   python3 -V
#   echo ""
#   echo "[pip3 freeze]"
#   pip3 freeze
# else
#   echo "(No python3 found. Skipping Python environment details.)"
# fi

# if command -v conda >/dev/null 2>&1; then
#   echo ""
#   echo "[conda info --envs]"
#   conda info --envs
#   echo ""
#   echo "[conda list --show-channel-urls]"
#   conda list --show-channel-urls
# fi
# echo '```'
# echo ""
# 

echo "### System Compiler & Libraries"
echo '```'
if command -v gcc >/dev/null 2>&1; then
  echo "[gcc --version]"
  gcc --version
fi

if command -v g++ >/dev/null 2>&1; then
  echo ""
  echo "[g++ --version]"
  g++ --version
fi

if command -v clang >/dev/null 2>&1; then
  echo ""
  echo "[clang --version]"
  clang --version
fi

if command -v pkg-config >/dev/null 2>&1; then
  echo ""
  echo "[pkg-config --modversion opencv]"
  pkg-config --modversion opencv || echo "OpenCV not found via pkg-config."
fi
echo '```'
echo ""

echo "### Docker / Container Info"
echo '```'
if command -v docker >/dev/null 2>&1; then
  echo "[docker --version]"
  docker --version
  echo ""
  echo "[docker images]"
  docker images
  echo ""
  echo "[docker ps -a]"
  docker ps -a
else
  echo "(docker command not found. Skipping Docker info.)"
fi
echo '```'
echo ""

echo "### Relevant Environment Variables"
echo '```'
# Print environment but filter out potentially sensitive ones
env | grep -Ei '^(PATH|PYTHONPATH|LD_LIBRARY_PATH|CUDA_VISIBLE_DEVICES|CONDA_.*|VIRTUAL_ENV)='
echo '```'
echo ""

##############################################################################
# 5) Ollama Models (if available)
##############################################################################
echo "### Ollama Models"
echo '```'
if command -v ollama >/dev/null 2>&1; then
  # Show installed models or any relevant status
  ollama list
else
  echo "(Command 'ollama' not found. No Ollama models to list.)"
fi
echo '```'
echo ""

echo "Overview generation complete. The file '$OUTPUT_FILE' has been created."
```

### File: ./scripts/generate_schema.js
```
#!/usr/bin/env node
import fs from 'node:fs/promises';
import path from 'node:path';
import crypto from 'node:crypto';
import { z } from 'zod';
import { zodToJsonSchema } from 'zod-to-json-schema';

async function main() {
  const mdPath = path.resolve('docs/agents.md');
  const md = await fs.readFile(mdPath, 'utf8');
  const tokens = Array.from(md.matchAll(/`([a-zA-Z0-9_]+)`/g)).map(m => m[1]);
  const keys = new Set(['minutes', 'decision', 'keep', 'aside', ...tokens]);

  const decision = z.object({
    keep: z.record(z.string(), z.string()).optional(),
    aside: z.record(z.string(), z.string()).optional(),
  });
  const shape = {
    minutes: z.array(z.object({ speaker: z.string(), text: z.string() })),
    decision
  };
  if (keys.has('field_notes_diff')) shape.field_notes_diff = z.string().optional();
  if (keys.has('field_notes_md')) shape.field_notes_md = z.string().optional();
  const Reply = z.object(shape);

  const tsLines = [
    "import { z } from 'zod';",
    '',
    'export const Reply = z.object({',
    '  minutes: z.array(z.object({ speaker: z.string(), text: z.string() })),',
    '  decision: z.object({',
    '    keep: z.record(z.string(), z.string()).optional(),',
    '    aside: z.record(z.string(), z.string()).optional()',
    '  }),'
  ];
  if (keys.has('field_notes_diff')) tsLines.push("  field_notes_diff: z.string().optional(),");
  if (keys.has('field_notes_md')) tsLines.push("  field_notes_md: z.string().optional(),");
  tsLines.push('});', '', 'export type Reply = z.infer<typeof Reply>;');
  await fs.writeFile(path.resolve('src/replySchema.ts'), tsLines.join('\n'));

  const jsLines = tsLines.filter(l => !l.startsWith('export type')); // remove type line
  await fs.writeFile(path.resolve('src/replySchema.js'), jsLines.join('\n'));

  const json = zodToJsonSchema(Reply, 'Reply');
  await fs.writeFile(path.resolve('reply.schema.json'), JSON.stringify(json, null, 2));
}

main().catch(err => { console.error(err); process.exit(1); });
```

### File: ./prompts
```
(File type is inode/directory — skipping raw dump.)
```

### File: ./prompts/default_prompt.hbs
```
You are moderating a collaborative curatorial session.

Session participants:
- Curators: {{curators}}
- Facilitator: Jamie

You will review the following image files (use *only* these names when forming decisions):
{{#each images}}
- {{this}}
{{/each}}

{{#if context}}

Background for today's review:
{{context}}
{{/if}}
{{#if fieldNotes}}

Field‑notes snapshot prior to this batch:
{{fieldNotes}}
{{/if}}

When you respond, think step‑by‑step silently and then output **only** a valid JSON object with the following top‑level keys:

- "minutes" : an array of `{ "speaker": "<Name>", "text": "<what was said>" }`. The final `text` must be a forward‑looking question.
- "decision" : an object whose optional keys are **exactly** "keep" and "aside". Each key maps a filename to a one‑sentence rationale. Omit filenames that lack consensus.
{{#if fieldNotes}}
- "field_notes_diff" : a unified diff (like `git diff -U0`) patching *field‑notes.md*.  
  Contributor guide  
  1. Change only lines justified by today’s images.  
  2. Cite evidence with `[filename.jpg]` links.  
  3. Mark uncertainties with "(?)".  
  4. Embed ≤ 3 `![]()` inline images.
{{/if}}

Never invent filenames, keys, or extra properties. Use only the image list above and the keys "keep"/"aside".

Return pure JSON—no markdown, no commentary, no extra text.
```

### File: ./prompts/default_prompt.hbs.orig
```
<<<<<<< HEAD
<<<<<<< HEAD
You are moderating a collaborative curatorial session. The following curators are present: {{curators}}. Jamie is the facilitator.

{
  "minutes": [ { "speaker": "Name", "text": "example" } ],
  "decision": {
    "keep": { "filename.jpg": "reason" },
    "aside": { "filename.jpg": "reason" }
  },
  "field_notes_diff": "<unified diff>",
  "field_notes_md": "<entire notebook>"
}

{{!-- Example minutes:
{ "speaker": "Ingeborg Gerdes", "text": "Angle reveals cabling" }
{ "speaker": "Peter Weibel", "text": "Shows feedback loop" }
{ "speaker": "Prof. Margaret Morse", "text": "Should we document crew movements?" }
--}}

Before replying, ensure every required top-level key is present; if any is missing, regenerate the full response.

Populate the 'minutes' array with curator dialogue using the voices listed; conclude the minutes with a forward-looking question from any curator.

Accurate field-note diffs prevent 3 am re-work; people’s well-being depends on your precision.

=======
You are moderating a collaborative curatorial session.
The following curators are present: {{curators}}. Jamie is the facilitator.
Before discussing the images, list the keys you will return (e.g. "minutes, decision, field_notes_diff") then proceed.
>>>>>>> 0890d84fef0310c2fe9bb5c155815202b945b78d
=======
You are moderating a collaborative curatorial session.
The following curators are present: {{curators}}. Jamie is the facilitator.
Before discussing the images, list the keys you will return (e.g. "minutes, decision, field_notes_diff") then proceed.
>>>>>>> d094a92de9c6b4b7abda877a9e161037ca186e86
{{#if context}}

Curator FYI:
{{context}}
{{/if}}
{{#if fieldNotes}}

Field notes so far:
{{fieldNotes}}
{{/if}}

<<<<<<< HEAD
<<<<<<< HEAD
If you are uncertain about a photo, **omit it from the decision block**.
Never invent filenames or keys.

Return pure JSON only; use each label verbatim.
=======
=======
>>>>>>> d094a92de9c6b4b7abda877a9e161037ca186e86
Capture that conversation inside the `minutes` array; do not write it outside the JSON object. Begin with a diarised conversation in which the curators discuss the images and gently work toward consensus.
Reflect the thoughtful, iterative process described in the briefing: curators share insights, consider relationships among works, and refine the selection together.

After capturing these remarks as meeting minutes, output a JSON object summarising the final decision:

If you are uncertain about a photo, **omit it from the decision block**.
Never invent filenames or keys.

{
  "minutes": [
    { "speaker": "Name", "text": "what was said" },
    ...
  ],
  "decision": {
    "keep": {
      "filename1.jpg": "why it stays",
      ...
    },
    "aside": {
      "filename2.jpg": "why it is set aside",
      ...
    }
  }
}

Include only those filenames for which you reach a clear decision.
The final line of `minutes` must be a forward-looking question.
Return pure JSON and use each label verbatim. No other text after the JSON.
<<<<<<< HEAD
>>>>>>> 0890d84fef0310c2fe9bb5c155815202b945b78d
=======
>>>>>>> d094a92de9c6b4b7abda877a9e161037ca186e86
```

### File: ./prompts/field_notes_second_pass.hbs
```
{{prompt}}

Current field notes:
{{existing}}

Patch:
{{diff}}

The diff above has been staged. Please return a JSON object with
`field_notes_md` containing the entire updated notebook and nothing else.
```

### File: ./prompts/field_notes_addon.txt
```
# === field-notes-addon.txt ===
When field-notes mode is ON, extend the response schema:

{
  …(minutes, decision)…,
  "field_notes_diff": "<unified diff here>"
}

Rules:

1. Only change notebook lines you can justify by looking at today’s images.
2. Use `[filename.jpg]` links to cite evidence; they will autolink.
3. If uncertain, insert a "(?)" marker rather than inventing details.
4. Keep ≤ 3 `![]()` inline embeds per update to stay lightweight.
5. Return pure JSON – no Markdown fences, no commentary.
```

### File: ./prompts/default_prompt_olympia.hbs
```
Please Role play as Ingeborg Gerdes:
- indicate who is speaking
- say what you think

I am going to make some fine art photo prints of my friend Olympia Kazi's 50th birthday party at La Plaza Cultural, her community garden.

Would you help me make selections? 

I'm going to share photos with you 10 at a time. Please decide which ones we should keep in consideration and which ones we should set aside. Use the **exact** filenames provided.

Respond *only* with a JSON object of the form:

{
  "keep": {
    "filename1.jpg": "[Please share your valued observations and thoughts on this image, here.]",
    ...
  },
  "aside": {
    "filename2.jpg": "[Please share your valued observations and thoughts on this image, here.]",
    ...
  }
}

Every filename must appear exactly once as a key in either "keep" or "aside". Include your observations on each image. No other text.

===

From: Olympia Kazi <olympiakazi@gmail.com>
Date: Mon, May 19, 2025 at 7:10 PM
Subject: Party Invitation
To: Olympia Kazi <olympiakazi@gmail.com>


Dear All,

Today is that day of the year for me, I'm passing the half-century mark ... I'm turning 50! 

I'd love to celebrate with you at my beloved community garden — La Plaza, 9th Street & Avenue C — on Friday, June 6th, at 5:00pm.

Pets, kids, lovers — all are welcome. Please let me know if and how many of you can make it.

Yours,
Olympia

===

From: Olympia Kazi <olympiakazi@gmail.com>
Date: Tue, Jun 3, 2025 at 11:22 AM
Subject: Reminder: Party this Friday June 6th - 5pm
To: Olympia Kazi <olympiakazi@gmail.com>


Dear All,

I look forward to celebrating with you at La Plaza (9th Street & Ave C) this Friday June 6th starting at 5pm.
(If you haven’t rsvp’d yet, please email me if you’re planning to come ; )

Love,
Olympia

===

From: Jamie Burkart <jamie.burkart@gmail.com>
Date: Tue, Jun 10, 2025 at 11:40 AM
Subject: Re: Thank you!
To: Olympia Kazi <olympiakazi@gmail.com>


What an honor and pleasure Olympia, to be friends and to experience your beautifully composed—and well deserved—celebration of you—Olympia Kazi.

Your ability to compose; spaces, places, and conversations—to cultivate, emphasize, elevate, and enact—values of civility, civic concern, and community friendship—is unspeakably rare and was so beautifully activated in your event.

I loved your party so much.

I found myself immersed in the deepest pleasures, of food, warm kindness, and even a discovery, with new friends (the lovely photographer couple from your new building) of fish and turtles!

Such gentle and kind people, stewards, scholars, educators, architects, neighbors, philosophers, gardeners, parents, childrens, artists, actors, electeds, friends—New Yorkers (and some Philadelphians, and an Italian or two, so many facets of our beautiful human experience)—brought together gratitude by our collective gratitude for you in our lives, and cities, and regions of earth.

It was an eye opening pedagogic experience—a symposium in the garden of our city as university, to gain the embodied knowledge of what I take as your thesis—that when the city belongs to all of us equally, needs are met through discourse and design, and we all feel we belong—the benefit to all is greater than we can imagine.

Thank you Olympia, just for being you. What a beautiful light you are in the world.

Yes! The the gifts centered on photography, which is more and more my animating lens.

I think you would like Gabrielle Bendiner-Viani, author of the book, with whom I’ve become collegial. She was so kind to inscribe the book to you at her signing.

Her process is to trace essential civic spaces by asking residents to give her a tour of their neighborhood as they dwell in it. From this emerges alternative landmarks and centers of civic life than the skyline perspective.

I love her academic and aesthetic insights. And she is committed to causes that are near and dear to our hearts. She would answer the call, if you saw one for her.

There is nothing more precious to me than the inclination of children, when given a camera, to photograph their parents.

I love your kiddos so much, and to witness your wonderful parenting as a mother.  Giulio and Clio are so lucky to have you as a mom!  &;-)

What a great tradition—your summer travel!

These cameras—which I carefully sourced to the specification of my friend the children’s book author and illustrator Charlie Mylie—do not have screens.

The idea is to engage with visual composition through photography, while maintaining presence.

Maybe we’ll have some snaps to see after the big trip!

Ooo! And I’ll share photos of your party with you shortly!

All the love in the world,
j a m i e




On Sun, Jun 8, 2025 at 2:27 PM Olympia Kazi <olympiakazi@gmail.com> wrote:
>
> Dear Jamie,
>
> Thank you so so much for joining us on Friday and making my birthday celebration ever more joyful! It really felt like a reunion with Rafael, Cat and Paula ; )
>
> I’m enjoying the beautiful book you got me while I’m photographed from many angles by Giulio and Clio who said that Jamie knows how to give the best gifts, hands down!
>
> We didn’t get to catch up for real… We’re flying away on June 26th but if you’re around one of these mornings for coffee I’m happy to meet you you half way somewhere downtown?
>
> xxx
> Ok
>
>
>
>

```

### File: ./prompts/field_notes_second_pass.hbs.orig
```
<<<<<<< HEAD
<<<<<<< HEAD
{
  "minutes": [],
  "decision": { "keep": {}, "aside": {} },
  "field_notes_md": "<markdown text>"
}

Before replying, ensure every required top-level key is present; if any is missing, regenerate the full response.

=======
>>>>>>> 0890d84fef0310c2fe9bb5c155815202b945b78d
=======
>>>>>>> d094a92de9c6b4b7abda877a9e161037ca186e86
{{prompt}}

Current field notes:
{{existing}}

Patch:
{{diff}}

The diff above has been staged. Please return a JSON object with
`field_notes_md` containing the entire updated notebook and nothing else.
```

### File: ./.env.example
```
# Copy to `.env` and paste your real key here.
OPENAI_API_KEY=sk-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
# Optional: base URL for the photo-filter API providing people tags
# Defaults to http://localhost:3000 when unset
# PHOTO_FILTER_API_BASE=http://localhost:3000
```

### File: ./src
```
(File type is inode/directory — skipping raw dump.)
```

### File: ./src/orchestrator.js.orig
```
import path from "node:path";
<<<<<<< HEAD
import { readFile, writeFile, mkdir, stat, copyFile } from "node:fs/promises";
import { renderTemplate } from "./config.js";
=======
import { writeFile, mkdir, stat, copyFile } from "node:fs/promises";
>>>>>>> 535dbf3feb3e1b9f4cfdc23cb7b10a264bde6d9d
import { listImages, pickRandom, moveFiles } from "./imageSelector.js";
import { chatCompletion, parseReply } from "./chatClient.js";
import { FieldNotesWriter } from "./fieldNotes.js";

/**
 * Recursively triage images until the current directory is empty
 * or contains only _keep/_aside folders.
 */
export async function triageDirectory({
  dir,
  prompt,
  model,
  recurse = true,
  curators = [],
<<<<<<< HEAD
  contextPath,
  fieldNotes = false,
  showPrompt = false,
  depth = 0,
}) {
  const indent = "  ".repeat(depth);
  let context = "";
  if (contextPath) {
    try {
      context = await readFile(contextPath, 'utf8');
    } catch (err) {
      console.warn(`Could not read context file ${contextPath}: ${err.message}`);
    }
  }

  const levelDir = path.join(dir, `_level-${String(depth + 1).padStart(3, '0')}`);
  const initImages = await listImages(dir);
  const promptsDir = path.join(levelDir, 'prompts');
  const repliesDir = path.join(levelDir, 'replies');
  let notesWriter;
  let fieldNotesText = "";
  if (fieldNotes) {
    notesWriter = new FieldNotesWriter(path.join(levelDir, 'field-notes.md'));
    await notesWriter.init();
    const existing = await notesWriter.read();
    if (existing) fieldNotesText = existing;
  }

  const names = curators.join(', ');
  let prompt = await renderTemplate(promptPath, {
    curators: names,
    context,
    fieldNotes: fieldNotesText,
  });
  let basePrompt = prompt;
  if (fieldNotes) {
    const addonPath = new URL('../prompts/field_notes_addon.txt', import.meta.url).pathname;
    try {
      const addon = await readFile(addonPath, 'utf8');
      prompt += `\n${addon}`;
    } catch (err) {
      console.warn(`Could not read field notes addon: ${err.message}`);
    }
  }

  if (showPrompt) {
    console.log(`${indent}📑  Prompt:\n${prompt}`);
  }
=======
  depth = 0,
}) {
  const indent = "  ".repeat(depth);
>>>>>>> 535dbf3feb3e1b9f4cfdc23cb7b10a264bde6d9d

  console.log(`${indent}📁  Scanning ${dir}`);

  // Archive original images at this level
  try {
    await stat(levelDir);
  } catch {
    // ignore
  }
  await mkdir(levelDir, { recursive: true });
  await mkdir(promptsDir, { recursive: true });
  await mkdir(repliesDir, { recursive: true });
  if (initImages.length) {
    await Promise.all(
      initImages.map((file) =>
        copyFile(file, path.join(levelDir, path.basename(file)))
      )
    );
  }

  while (true) {
    const images = await listImages(dir);
    if (images.length === 0) {
      console.log(`${indent}✅  Nothing to do in ${dir}`);
      break;
    }

    console.log(`${indent}📊  ${images.length} unclassified image(s) found`);

    // Step 1 – select ≤10
    const batch = pickRandom(images, 10);
    console.log(`${indent}🔍  Selected ${batch.length} image(s)`);

    // Step 2 – ask ChatGPT
    console.log(`${indent}⏳  Sending batch to ChatGPT…`);
    const ts = Date.now();
    await writeFile(path.join(promptsDir, `${ts}.prompt.txt`), prompt, 'utf8');
    const reply = await chatCompletion({
>>>>>>> 0890d84fef0310c2fe9bb5c155815202b945b78d
      prompt,
      images: batch,
      model,
      curators,
    });
    await writeFile(path.join(repliesDir, `${ts}.raw.json`), reply, 'utf8');
    console.log(`${indent}🤖  ChatGPT reply:\n${reply}`);

<<<<<<< HEAD
    let parsed;
    try {
      // Step 3 – parse decisions. Missing field_notes keys break the two-pass workflow.
=======
    // Step 3 – parse decisions
    let parsed;
    try {
      parsed = parseReply(reply, batch, {
        expectFieldNotesDiff: fieldNotes,
      });
    } catch (err) {
      console.warn(`${indent}Failed to parse reply: ${err.message}`);
      continue;
    }
    const { keep, aside, notes, minutes, fieldNotesDiff, fieldNotesMd } = parsed;
    if (minutes.length) {
      const minutesFile = path.join(dir, `minutes-${Date.now()}.txt`);
      await writeFile(minutesFile, minutes.join('\n'), 'utf8');
      console.log(`${indent}📝  Saved meeting minutes to ${minutesFile}`);
    }

    if (notesWriter && (fieldNotesDiff || fieldNotesMd)) {
      try {
        if (fieldNotesMd) {
          await notesWriter.writeFull(fieldNotesMd);
        } else {
          const existing = (await notesWriter.read()) || '';
          const secondPrompt = await renderTemplate(
            new URL('../prompts/field_notes_second_pass.hbs', import.meta.url).pathname,
            { prompt: basePrompt, existing, diff: fieldNotesDiff }
          );
          if (showPrompt) {
            console.log(`${indent}📑  Second-pass prompt:\n${secondPrompt}`);
          }
          await writeFile(path.join(promptsDir, `${ts}-second.prompt.txt`), secondPrompt, 'utf8');
          const second = await chatCompletion({
            prompt: secondPrompt,
            images: batch,
            model,
            curators,
          });
          await writeFile(path.join(repliesDir, `${ts}-second.raw.json`), second, 'utf8');
          let parsed;
          try {
            parsed = parseReply(second, batch, {
              expectFieldNotesMd: true,
            });
          } catch (err) {
            console.warn(`${indent}Failed to parse second-pass reply: ${err.message}`);
            continue;
          }
          if (parsed.fieldNotesMd) {
            await notesWriter.writeFull(parsed.fieldNotesMd);
          } else {
            console.warn(`${indent}No field_notes_md returned; diff ignored`);
          }
        }
      } catch (err) {
        console.warn(`${indent}Failed to update field notes: ${err.message}`);
      }
    }

    // Step 4 – move files
    const keepDir = path.join(dir, "_keep");
    const asideDir = path.join(dir, "_aside");
    await Promise.all([
      moveFiles(keep, keepDir, notes),
      moveFiles(aside, asideDir, notes),
    ]);

    console.log(
      `📂  Moved: ${keep.length} keep → ${keepDir}, ${aside.length} aside → ${asideDir}`
    );
  }

  // Step 5 – recurse into keepDir if both keep and aside exist
  if (recurse) {
    const keepDir = path.join(dir, "_keep");
    const asideDir = path.join(dir, "_aside");
    let keepExists = false;
    try {
      keepExists = (await stat(keepDir)).isDirectory();
    } catch {
      // ignore
    }

    if (keepExists) {
      await triageDirectory({
        dir: keepDir,
        prompt,
        model,
        recurse,
        curators,
<<<<<<< HEAD
        contextPath,
        fieldNotes,
=======
>>>>>>> 535dbf3feb3e1b9f4cfdc23cb7b10a264bde6d9d
        depth: depth + 1,
      });
    } else {
      let keepCount = 0;
      let asideCount = 0;
      try {
        keepCount = (await listImages(keepDir)).length;
      } catch {
        // ignore
      }
      try {
        asideCount = (await listImages(asideDir)).length;
      } catch {
        // ignore
      }

      if (keepCount || asideCount) {
        const status = keepCount ? "kept" : "set aside";
        console.log(`${indent}🎯  All images ${status} at this level; stopping recursion.`);
      }
    }
  }
}
```

### File: ./src/chatClient.js.orig
```
import { OpenAI, NotFoundError } from "openai";
import { readFile, stat, mkdir, writeFile } from "node:fs/promises";
import path from "node:path";
import crypto from "node:crypto";
import { z } from "zod";
<<<<<<< HEAD
<<<<<<< HEAD
=======
import { Reply as ReplySchema } from "./replySchema.js";
>>>>>>> 0890d84fef0310c2fe9bb5c155815202b945b78d
=======
import { Reply as ReplySchema } from "./replySchema.js";
>>>>>>> d094a92de9c6b4b7abda877a9e161037ca186e86
import { delay } from "./config.js";

const openai = new OpenAI();
const PEOPLE_API_BASE = process.env.PHOTO_FILTER_API_BASE ||
  "http://localhost:3000";
const peopleCache = new Map();

async function getPeople(filename) {
  if (peopleCache.has(filename)) return peopleCache.get(filename);
  try {
    const url = `${PEOPLE_API_BASE}/api/photos/by-filename/${encodeURIComponent(filename)}/persons`;
    const res = await fetch(url);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const json = await res.json();
    const names = Array.isArray(json.data) ? json.data : [];
    peopleCache.set(filename, names);
    return names;
  } catch {
    peopleCache.set(filename, []);
    return [];
  }
}

/** Max response tokens allowed from OpenAI. Large enough to hold
 * minutes plus the full JSON decision block without truncation. */
export const MAX_RESPONSE_TOKENS = 4096;

function ensureJsonMention(text) {
  return /\bjson\b/i.test(text)
    ? text
    : `${text}\nRespond in json format.`;
}

const CACHE_DIR = path.resolve('.cache');

async function getCachedReply(key) {
  try {
    return await readFile(path.join(CACHE_DIR, `${key}.txt`), 'utf8');
  } catch {
    return null;
  }
}

async function setCachedReply(key, text) {
  await mkdir(CACHE_DIR, { recursive: true });
  await writeFile(path.join(CACHE_DIR, `${key}.txt`), text, 'utf8');
}

export async function cacheKey({ prompt, images, model, curators = [] }) {
  const hash = crypto.createHash('sha256');
  hash.update(model);
  hash.update(prompt);
  if (curators.length) hash.update(curators.join(','));
  for (const file of images) {
    const info = await stat(file);
    hash.update(file);
    hash.update(String(info.mtimeMs));
    hash.update(String(info.size));
  }
  return hash.digest('hex');
}

/**
 * Builds the array of message objects for the Chat Completion API.
 * Encodes each image as a base64 data‑URL so it can be inspected by vision models.
 */
export async function buildMessages(prompt, images, curators = []) {
  const system = { role: "system", content: prompt };

  /**  Turn each image into base64 data‑URL with a preceding filename label.  */
  const userImageParts = await Promise.all(
    images.map(async (file) => {
      const abs = path.resolve(file);
      const buffer = await readFile(abs);
      const base64 = buffer.toString("base64");
      const name = path.basename(file);
      const ext = path.extname(file).slice(1) || "jpeg";
      const people = await getPeople(name);
      const info = people.length ? { filename: name, people } : { filename: name };
      return [
        { type: "text", text: JSON.stringify(info) },
        {
          type: "image_url",
          image_url: {
            url: `data:image/${ext};base64,${base64}`,
            detail: "high",
          },
        },
      ];
    })
  ).then((parts) => parts.flat());

  const userText = {
    role: "user",
    content: [
      { type: "text", text: ensureJsonMention("Here are the images:") },
      ...userImageParts,
    ],
  };

  return [system, userText];
}

/** Build input array for the Responses API */
export async function buildInput(prompt, images, curators = []) {
  let instructions = prompt;
  const imageParts = await Promise.all(
    images.map(async (file) => {
      const abs = path.resolve(file);
      const buffer = await readFile(abs);
      const base64 = buffer.toString("base64");
      const name = path.basename(file);
      const ext = path.extname(file).slice(1) || "jpeg";
      const people = await getPeople(name);
      const info = people.length ? { filename: name, people } : { filename: name };
      return [
        { type: "input_text", text: JSON.stringify(info) },
        {
          type: "input_image",
          image_url: `data:image/${ext};base64,${base64}`,
          detail: "high",
        },
      ];
    })
  ).then((parts) => parts.flat());

  return {
    instructions,
    input: [
      {
        role: "user",
        content: [
          { type: "input_text", text: ensureJsonMention("Here are the images:") },
          ...imageParts,
        ],
      },
    ],
  };
}

/**
 * Call OpenAI, returning raw text content.
 * Retries with exponential back‑off on 429/5xx.
 */
export async function chatCompletion({
  prompt,
  images,
  model = "gpt-4o",
  maxRetries = 3,
  cache = true,
  curators = [],
}) {
  const finalPrompt = ensureJsonMention(prompt);

  const key = await cacheKey({ prompt: finalPrompt, images, model, curators });
  if (cache) {
    const hit = await getCachedReply(key);
    if (hit) return hit;
  }

  let attempt = 0;
  // eslint-disable-next-line no-constant-condition
  while (true) {
    try {
      const messages = await buildMessages(finalPrompt, images, curators);
      const baseParams = {
        model,
        messages,
        // allow ample space for the JSON decision block and minutes
        response_format: { type: "json_object" },
      };
      if (/^o\d/.test(model)) {
        baseParams.max_completion_tokens = MAX_RESPONSE_TOKENS;
      } else {
        baseParams.max_tokens = MAX_RESPONSE_TOKENS;
      }
      const { choices } = await openai.chat.completions.create(baseParams);
      const text = choices[0].message.content;
      if (cache) await setCachedReply(key, text);
      return text;
    } catch (err) {
      const msg = String(err?.error?.message || err?.message || "");
      const code = err?.code || err?.cause?.code;
      const isNetwork = err?.name === "APIConnectionError" ||
        ["EPIPE", "ECONNRESET", "ETIMEDOUT"].includes(code);
      if (
        (err instanceof NotFoundError || err.status === 404) &&
        (/v1\/responses/.test(msg) || /v1\/completions/.test(msg) || /not a chat model/i.test(msg))
      ) {
        const params = await buildInput(finalPrompt, images, curators);
        const rsp = await openai.responses.create({
          model,
          ...params,
          text: { format: { type: "json_object" } },
          max_output_tokens: MAX_RESPONSE_TOKENS,
        });
        const text = rsp.output_text;
        if (cache) await setCachedReply(key, text);
        return text;
      }

      if (attempt >= maxRetries) throw err;
      attempt += 1;
      const wait = 2 ** attempt * 1000;
      const label = isNetwork ? "network error" : "OpenAI error";
      const codeInfo = err.status ?? code ?? "unknown";
      console.warn(`${label} (${codeInfo}). Retrying in ${wait} ms…`);
      await delay(wait);
    }
  }
}

/**
 * Parse the LLM reply → { keep: [file], aside: [file] }
 *
 * Accepts patterns like:
 *  • “DSCF1234 — keep  …reason…”
 *  • “Set aside: DSCF5678”
 */
export function parseReply(text, allFiles, opts = {}) {
  const { expectFieldNotesDiff = false, expectFieldNotesMd = false } = opts;
<<<<<<< HEAD
<<<<<<< HEAD
  // Strip Markdown code fences like ```json ... ``` if present
  const fenced = text.trim();
  if (fenced.startsWith('```')) {
    const match = fenced.match(/^```\w*\n([\s\S]*?)\n```$/);
    if (match) text = match[1];
=======
=======
>>>>>>> d094a92de9c6b4b7abda877a9e161037ca186e86
  let content = text.trim();
  if (content.startsWith('```')) {
    const m = content.match(/^```\w*\n([\s\S]*?)\n```$/);
    if (m) content = m[1];
<<<<<<< HEAD
>>>>>>> 0890d84fef0310c2fe9bb5c155815202b945b78d
=======
>>>>>>> d094a92de9c6b4b7abda877a9e161037ca186e86
  }
  const data = ReplySchema.parse(JSON.parse(content));

  if (data.minutes.length) {
    const last = data.minutes[data.minutes.length - 1].text.trim();
    if (!last.endsWith('?')) {
      throw new Error('minutes must end with a question');
    }
  }

  const map = new Map(allFiles.map((f) => [path.basename(f).toLowerCase(), f]));
  const resolve = (name) => {
    const lc = name.toLowerCase();
    let f = map.get(lc);
    if (!f) {
      const idx = lc.indexOf('dscf');
      if (idx !== -1) {
        f = map.get(lc.slice(idx));
        if (!f) {
          for (const [key, val] of map) {
            if (key.endsWith(lc.slice(idx))) { f = val; break; }
          }
        }
      }
    }
    return f;
  };

  const toList = (val) => {
    const result = [];
    if (Array.isArray(val)) {
      for (const n of val) {
        const f = resolve(n);
        if (f) result.push([f, undefined]);
      }
    } else {
      for (const [n, reason] of Object.entries(val || {})) {
        const f = resolve(n);
        if (f) result.push([f, reason]);
      }
    }
    return result;
  };

  const keep = toList(data.decision.keep);
  const aside = toList(data.decision.aside);

  const notes = new Map();
<<<<<<< HEAD
<<<<<<< HEAD
  const minutes = [];
  let fieldNotesDiff = null;
  let fieldNotesMd = null;

  // Try JSON first
  try {
    const obj = JSON.parse(text);

    const extract = (node) => {
      if (!node || typeof node !== 'object') return null;
      if (typeof node.field_notes_diff === 'string') fieldNotesDiff = node.field_notes_diff;
      if (typeof node.field_notes_md === 'string') fieldNotesMd = node.field_notes_md;
      if (Array.isArray(node.minutes)) minutes.push(...node.minutes.map((m) => `${m.speaker}: ${m.text}`));

      if (node.keep && node.aside) return node;
      if (node.decision && node.decision.keep && node.decision.aside) {
        if (Array.isArray(node.minutes)) minutes.push(...node.minutes.map((m) => `${m.speaker}: ${m.text}`));
        return node.decision;
      }
      for (const val of Object.values(node)) {
        const found = extract(val);
        if (found) return found;
      }
      return null;
    };

    const decision = extract(obj);
    if (decision) {
      const handle = (group, set) => {
        const val = decision[group];
        if (Array.isArray(val)) {
          for (const n of val) {
            const f = lookup(n);
            if (f) set.add(f);
          }
        } else if (val && typeof val === 'object') {
          for (const [n, reason] of Object.entries(val)) {
            const f = lookup(n);
            if (f) {
              set.add(f);
              if (reason) notes.set(f, String(reason));
            }
          }
        }
      };

      handle('keep', keep);
      handle('aside', aside);
      // continue to normalization below
    }
  } catch {
    // fall through to plain text handling
=======
  for (const [f, reason] of [...keep, ...aside]) {
    if (reason) notes.set(f, String(reason));
>>>>>>> 0890d84fef0310c2fe9bb5c155815202b945b78d
=======
  for (const [f, reason] of [...keep, ...aside]) {
    if (reason) notes.set(f, String(reason));
>>>>>>> d094a92de9c6b4b7abda877a9e161037ca186e86
  }

  const keepFiles = new Set(keep.map(([f]) => f));
  const asideFiles = new Set(aside.map(([f]) => f));
  for (const f of keepFiles) asideFiles.delete(f);

  const decided = new Set([...keepFiles, ...asideFiles]);
  const unclassified = allFiles.filter((f) => !decided.has(f));

<<<<<<< HEAD
<<<<<<< HEAD
  // field_notes_diff/md are required for the two-pass notebook workflow.
  // Missing keys would leave the notebook in an inconsistent state.
  if (expectFieldNotesDiff && !fieldNotesDiff && !fieldNotesMd) {
    throw new Error('field_notes_diff missing in reply');
  }
  if (expectFieldNotesMd && !fieldNotesMd) {
=======
=======
>>>>>>> d094a92de9c6b4b7abda877a9e161037ca186e86
  if (expectFieldNotesDiff && !data.field_notes_diff && !data.field_notes_md) {
    throw new Error('field_notes_diff missing in reply');
  }
  if (expectFieldNotesMd && !data.field_notes_md) {
<<<<<<< HEAD
>>>>>>> 0890d84fef0310c2fe9bb5c155815202b945b78d
=======
>>>>>>> d094a92de9c6b4b7abda877a9e161037ca186e86
    throw new Error('field_notes_md missing in reply');
  }

  return {
<<<<<<< HEAD
<<<<<<< HEAD
    keep: [...keep],
    aside: [...aside],
    unclassified,
    notes,
    minutes,
    fieldNotesDiff,
    fieldNotesMd,
=======
=======
>>>>>>> d094a92de9c6b4b7abda877a9e161037ca186e86
    keep: [...keepFiles],
    aside: [...asideFiles],
    unclassified,
    notes,
    minutes: data.minutes.map((m) => `${m.speaker}: ${m.text}`),
    fieldNotesDiff: data.field_notes_diff || null,
    fieldNotesMd: data.field_notes_md || null,
<<<<<<< HEAD
>>>>>>> 0890d84fef0310c2fe9bb5c155815202b945b78d
=======
>>>>>>> d094a92de9c6b4b7abda877a9e161037ca186e86
  };
}
```

### File: ./src/chatClient.js
```
import { OpenAI, NotFoundError } from "openai";
import { readFile, stat, mkdir, writeFile } from "node:fs/promises";
import path from "node:path";
import crypto from "node:crypto";
import { z } from "zod";
import { Reply as ReplySchema } from "./replySchema.js";
import { delay } from "./config.js";

const openai = new OpenAI();
const PEOPLE_API_BASE = process.env.PHOTO_FILTER_API_BASE ||
  "http://localhost:3000";
const peopleCache = new Map();

async function getPeople(filename) {
  if (peopleCache.has(filename)) return peopleCache.get(filename);
  try {
    const url = `${PEOPLE_API_BASE}/api/photos/by-filename/${encodeURIComponent(filename)}/persons`;
    const res = await fetch(url);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const json = await res.json();
    const names = Array.isArray(json.data) ? json.data : [];
    peopleCache.set(filename, names);
    return names;
  } catch {
    peopleCache.set(filename, []);
    return [];
  }
}

/** Max response tokens allowed from OpenAI. Large enough to hold
 * minutes plus the full JSON decision block without truncation. */
export const MAX_RESPONSE_TOKENS = 4096;

function ensureJsonMention(text) {
  return /\bjson\b/i.test(text)
    ? text
    : `${text}\nRespond in json format.`;
}

const CACHE_DIR = path.resolve('.cache');

async function getCachedReply(key) {
  try {
    return await readFile(path.join(CACHE_DIR, `${key}.txt`), 'utf8');
  } catch {
    return null;
  }
}

async function setCachedReply(key, text) {
  await mkdir(CACHE_DIR, { recursive: true });
  await writeFile(path.join(CACHE_DIR, `${key}.txt`), text, 'utf8');
}

export async function cacheKey({ prompt, images, model, curators = [] }) {
  const hash = crypto.createHash('sha256');
  hash.update(model);
  hash.update(prompt);
  if (curators.length) hash.update(curators.join(','));
  for (const file of images) {
    const info = await stat(file);
    hash.update(file);
    hash.update(String(info.mtimeMs));
    hash.update(String(info.size));
  }
  return hash.digest('hex');
}

/**
 * Builds the array of message objects for the Chat Completion API.
 * Encodes each image as a base64 data‑URL so it can be inspected by vision models.
 */
export async function buildMessages(prompt, images, curators = []) {
  const system = { role: "system", content: prompt };

  /**  Turn each image into base64 data‑URL with a preceding filename label.  */
  const userImageParts = await Promise.all(
    images.map(async (file) => {
      const abs = path.resolve(file);
      const buffer = await readFile(abs);
      const base64 = buffer.toString("base64");
      const name = path.basename(file);
      const ext = path.extname(file).slice(1) || "jpeg";
      const people = await getPeople(name);
      const info = people.length ? { filename: name, people } : { filename: name };
      return [
        { type: "text", text: JSON.stringify(info) },
        {
          type: "image_url",
          image_url: {
            url: `data:image/${ext};base64,${base64}`,
            detail: "high",
          },
        },
      ];
    })
  ).then((parts) => parts.flat());

  const userText = {
    role: "user",
    content: [
      { type: "text", text: ensureJsonMention("Here are the images:") },
      ...userImageParts,
    ],
  };

  return [system, userText];
}

/** Build input array for the Responses API */
export async function buildInput(prompt, images, curators = []) {
  let instructions = prompt;
  const imageParts = await Promise.all(
    images.map(async (file) => {
      const abs = path.resolve(file);
      const buffer = await readFile(abs);
      const base64 = buffer.toString("base64");
      const name = path.basename(file);
      const ext = path.extname(file).slice(1) || "jpeg";
      const people = await getPeople(name);
      const info = people.length ? { filename: name, people } : { filename: name };
      return [
        { type: "input_text", text: JSON.stringify(info) },
        {
          type: "input_image",
          image_url: `data:image/${ext};base64,${base64}`,
          detail: "high",
        },
      ];
    })
  ).then((parts) => parts.flat());

  return {
    instructions,
    input: [
      {
        role: "user",
        content: [
          { type: "input_text", text: ensureJsonMention("Here are the images:") },
          ...imageParts,
        ],
      },
    ],
  };
}

/**
 * Call OpenAI, returning raw text content.
 * Retries with exponential back‑off on 429/5xx.
 */
export async function chatCompletion({
  prompt,
  images,
  model = "gpt-4o",
  maxRetries = 3,
  cache = true,
  curators = [],
}) {
  const finalPrompt = ensureJsonMention(prompt);

  const key = await cacheKey({ prompt: finalPrompt, images, model, curators });
  if (cache) {
    const hit = await getCachedReply(key);
    if (hit) return hit;
  }

  let attempt = 0;
  // eslint-disable-next-line no-constant-condition
  while (true) {
    try {
      const messages = await buildMessages(finalPrompt, images, curators);
      const baseParams = {
        model,
        messages,
        // allow ample space for the JSON decision block and minutes
        response_format: { type: "json_object" },
      };
      if (/^o\d/.test(model)) {
        baseParams.max_completion_tokens = MAX_RESPONSE_TOKENS;
      } else {
        baseParams.max_tokens = MAX_RESPONSE_TOKENS;
      }
      const { choices } = await openai.chat.completions.create(baseParams);
      let text = choices[0].message.content;
      try {
        const obj = JSON.parse(text);
        if (cache) await setCachedReply(key, text);
        return obj;
      } catch {
        const retry = await openai.chat.completions.create({
          ...baseParams,
          messages: [
            ...messages,
            { role: "system", content: "Please re-emit valid JSON only." },
          ],
        });
        text = retry.choices[0].message.content;
        const obj = JSON.parse(text);
        if (cache) await setCachedReply(key, text);
        return obj;
      }
    } catch (err) {
      const msg = String(err?.error?.message || err?.message || "");
      const code = err?.code || err?.cause?.code;
      const isNetwork = err?.name === "APIConnectionError" ||
        ["EPIPE", "ECONNRESET", "ETIMEDOUT"].includes(code);
      if (
        (err instanceof NotFoundError || err.status === 404) &&
        (/v1\/responses/.test(msg) || /v1\/completions/.test(msg) || /not a chat model/i.test(msg))
      ) {
        const params = await buildInput(finalPrompt, images, curators);
        const rsp = await openai.responses.create({
          model,
          ...params,
          text: { format: { type: "json_object" } },
          max_output_tokens: MAX_RESPONSE_TOKENS,
        });
        const text = rsp.output_text;
        const obj = JSON.parse(text);
        if (cache) await setCachedReply(key, text);
        return obj;
      }

      if (attempt >= maxRetries) throw err;
      attempt += 1;
      const wait = 2 ** attempt * 1000;
      const label = isNetwork ? "network error" : "OpenAI error";
      const codeInfo = err.status ?? code ?? "unknown";
      console.warn(`${label} (${codeInfo}). Retrying in ${wait} ms…`);
      await delay(wait);
    }
  }
}

/**
 * Parse the LLM reply → { keep: [file], aside: [file] }
 *
 * Accepts patterns like:
 *  • “DSCF1234 — keep  …reason…”
 *  • “Set aside: DSCF5678”
 */
export function parseReply(text, allFiles, opts = {}) {
  const { expectFieldNotesDiff = false, expectFieldNotesMd = false } = opts;
  let content = text.trim();
  if (content.startsWith('```')) {
    const m = content.match(/^```\w*\n([\s\S]*?)\n```$/);
    if (m) content = m[1];
  }
  const data = ReplySchema.parse(JSON.parse(content));

  if (data.minutes.length) {
    const last = data.minutes[data.minutes.length - 1].text.trim();
    if (!last.endsWith('?')) {
      throw new Error('minutes must end with a question');
    }
  }

  const map = new Map(allFiles.map((f) => [path.basename(f).toLowerCase(), f]));
  const resolve = (name) => {
    const lc = name.toLowerCase();
    let f = map.get(lc);
    if (!f) {
      const idx = lc.indexOf('dscf');
      if (idx !== -1) {
        f = map.get(lc.slice(idx));
        if (!f) {
          for (const [key, val] of map) {
            if (key.endsWith(lc.slice(idx))) { f = val; break; }
          }
        }
      }
    }
    return f;
  };

  const toList = (val) => {
    const result = [];
    if (Array.isArray(val)) {
      for (const n of val) {
        const f = resolve(n);
        if (f) result.push([f, undefined]);
      }
    } else {
      for (const [n, reason] of Object.entries(val || {})) {
        const f = resolve(n);
        if (f) result.push([f, reason]);
      }
    }
    return result;
  };

  const keep = toList(data.decision.keep);
  const aside = toList(data.decision.aside);

  const notes = new Map();
  for (const [f, reason] of [...keep, ...aside]) {
    if (reason) notes.set(f, String(reason));
  }

  const keepFiles = new Set(keep.map(([f]) => f));
  const asideFiles = new Set(aside.map(([f]) => f));
  for (const f of keepFiles) asideFiles.delete(f);

  const decided = new Set([...keepFiles, ...asideFiles]);
  const unclassified = allFiles.filter((f) => !decided.has(f));

  if (expectFieldNotesDiff && !data.field_notes_diff && !data.field_notes_md) {
    throw new Error('field_notes_diff missing in reply');
  }
  if (expectFieldNotesMd && !data.field_notes_md) {
    throw new Error('field_notes_md missing in reply');
  }

  return {
    keep: [...keepFiles],
    aside: [...asideFiles],
    unclassified,
    notes,
    minutes: data.minutes.map((m) => `${m.speaker}: ${m.text}`),
    fieldNotesDiff: data.field_notes_diff || null,
    fieldNotesMd: data.field_notes_md || null,
  };
}
```

### File: ./src/fieldNotes.js
```
import fs from 'node:fs/promises';
import path from 'node:path';
import { applyPatch } from 'diff';

export class FieldNotesWriter {
  constructor(file) {
    this.file = file;
  }

  async read() {
    try {
      return await fs.readFile(this.file, 'utf8');
    } catch {
      return null;
    }
  }

  async init() {
    const existing = await this.read();
    if (existing === null) {
      await fs.mkdir(path.dirname(this.file), { recursive: true });
      const created = `<!-- created: ${new Date().toISOString()} -->\n`;
      await fs.writeFile(this.file, created, 'utf8');
    }
  }

  autolink(text) {
    const regex = /\[([^\]]+\.(?:jpg|jpeg|png|gif|tif|tiff|heic|heif))\](?!\()/gi;
    return text.replace(regex, (m, name) => `[${name}](./${name})`);
  }

  async writeFull(markdown) {
    await fs.mkdir(path.dirname(this.file), { recursive: true });
    const existing = await this.read();
    let content = this.autolink(markdown.trim()) + '\n';
    if (existing === null) {
      const created = `<!-- created: ${new Date().toISOString()} -->`;
      content = `${created}\n${content}`;
    } else {
      const createdMatch = existing.match(/<!-- created: .*?-->/);
      const created = createdMatch ? createdMatch[0] + '\n' : '';
      const updates = (existing.match(/<!-- updated: .*?-->/g) || []).join('\n');
      const stamp = `<!-- updated: ${new Date().toISOString()} -->`;
      content = `${created}${content}${updates ? updates + '\n' : ''}${stamp}\n`;
    }
    await fs.writeFile(this.file, content, 'utf8');
  }

  async applyDiff(diffText) {
    const current = (await this.read()) || '';
    const patched = applyPatch(current, diffText, { fuzzFactor: 2 });
    if (patched === false) throw new Error('Failed to apply diff');
    await this.writeFull(patched);
  }
}
```

### File: ./src/index.js
```
#!/usr/bin/env node
/** Load environment variables ASAP (before any OpenAI import). */
import "dotenv/config";

import { Command } from "commander";
import path from "node:path";
import { DEFAULT_PROMPT_PATH } from "./config.js";

const program = new Command();
program
  .name("photo-select")
  .description("Randomly triage photos with ChatGPT")
  .option("-d, --dir <path>", "Source directory of images", process.cwd())
  .option("-p, --prompt <file>", "Custom prompt file", DEFAULT_PROMPT_PATH)
  .option(
    "-m, --model <id>",
    "OpenAI model id",
    process.env.PHOTO_SELECT_MODEL || "gpt-4o"
  )
  .option(
    "-k, --api-key <key>",
    "OpenAI API key",
    process.env.OPENAI_API_KEY
  )
  .option(
    "-c, --curators <names>",
    "Comma-separated list of curator names",
    (value) => value.split(',').map((n) => n.trim()).filter(Boolean),
    []
  )
  .option(
    "-x, --context <file>",
    "Text file with exhibition context for the curators"
  )
  .option("--show-prompt", "Print the rendered prompt before each API call")
  .option("--no-recurse", "Process a single directory only")
  .option("--field-notes", "Enable field notes workflow")
  .parse(process.argv);

const { dir, prompt: promptPath, model, recurse, apiKey, curators, context: contextPath, fieldNotes, showPrompt } = program.opts();

if (apiKey) {
  process.env.OPENAI_API_KEY = apiKey;
}

(async () => {
  try {
    if (!process.env.OPENAI_API_KEY) {
      console.error(
        "❌  OPENAI_API_KEY is missing. Add it to a .env file or your shell env."
      );
      process.exit(1);
    }
    const absDir = path.resolve(dir);
    const { triageDirectory } = await import("./orchestrator.js");
    await triageDirectory({
      dir: absDir,
      promptPath,
      model,
      recurse,
      curators,
      contextPath,
      fieldNotes,
      showPrompt,
    });
    console.log("🎉  Finished triaging.");
  } catch (err) {
    console.error("❌  Error:", err);
    process.exit(1);
  }
})();
```

### File: ./src/config.js
```
import path from "node:path";
import fs from "node:fs/promises";
import Handlebars from "handlebars";

/** Centralised config & helpers (Ember‑style “config owner”). */
export const SUPPORTED_EXTENSIONS = [
  ".jpg",
  ".jpeg",
  ".png",
  ".gif",
  ".tif",
  ".tiff",
  ".heic",
  ".heif",
];

export const DEFAULT_PROMPT_PATH = path.resolve(
  new URL("../prompts/default_prompt.hbs", import.meta.url).pathname
);
export async function renderTemplate(filePath = DEFAULT_PROMPT_PATH, data = {}) {
  const source = await fs.readFile(filePath, "utf8");
  const template = Handlebars.compile(source, { noEscape: true });
  return template(data);
}

/** Sleep helper for rate‑limit back‑off. */
export const delay = (ms) => new Promise((res) => setTimeout(res, ms));
```

### File: ./src/replySchema.ts
```
import { z } from 'zod';

export const Reply = z.object({
  minutes: z.array(z.object({ speaker: z.string(), text: z.string() })),
  decision: z.object({
    keep: z.record(z.string(), z.string()).optional(),
    aside: z.record(z.string(), z.string()).optional()
  }),
  field_notes_diff: z.string().optional(),
  field_notes_md: z.string().optional(),
});

export type Reply = z.infer<typeof Reply>;
```

### File: ./src/index.js.orig
```
#!/usr/bin/env node
/** Load environment variables ASAP (before any OpenAI import). */
import "dotenv/config";

import { Command } from "commander";
import path from "node:path";
import { DEFAULT_PROMPT_PATH } from "./config.js";
import { buildPrompt } from "./prompt.js";

const program = new Command();
program
  .name("photo-select")
  .description("Randomly triage photos with ChatGPT")
  .option("-d, --dir <path>", "Source directory of images", process.cwd())
  .option("-p, --prompt <file>", "Custom prompt file", DEFAULT_PROMPT_PATH)
  .option(
    "-m, --model <id>",
    "OpenAI model id",
    process.env.PHOTO_SELECT_MODEL || "gpt-4o"
  )
  .option(
    "-k, --api-key <key>",
    "OpenAI API key",
    process.env.OPENAI_API_KEY
  )
  .option(
    "-c, --curators <names>",
    "Comma-separated list of curator names",
    (value) => value.split(',').map((n) => n.trim()).filter(Boolean),
    []
  )
  .option(
    "-x, --context <file>",
    "Text file with exhibition context for the curators"
  )
  .option("--show-prompt", "Print the final prompt and exit")
  .option("--no-recurse", "Process a single directory only")
  .option("--field-notes", "Enable field notes workflow")
  .option("--show-prompt", "Print the rendered prompt before each API call")
  .parse(process.argv);

<<<<<<< HEAD
const { dir, prompt: promptPath, model, recurse, apiKey, curators, context: contextPath, fieldNotes, showPrompt } = program.opts();
=======
const { dir, prompt: promptPath, model, recurse, apiKey, curators, context: contextPath, showPrompt } = program.opts();
>>>>>>> 535dbf3feb3e1b9f4cfdc23cb7b10a264bde6d9d

if (apiKey) {
  process.env.OPENAI_API_KEY = apiKey;
}

(async () => {
  try {
    if (!process.env.OPENAI_API_KEY) {
      console.error(
        "❌  OPENAI_API_KEY is missing. Add it to a .env file or your shell env."
      );
      process.exit(1);
    }
    const absDir = path.resolve(dir);
    const { triageDirectory } = await import("./orchestrator.js");
    const prompt = await buildPrompt(promptPath, { curators, contextPath });
    if (showPrompt) {
      console.log(prompt);
      return;
    }
    await triageDirectory({
      dir: absDir,
      prompt,
      model,
      recurse,
      curators,
<<<<<<< HEAD
      contextPath,
      fieldNotes,
      showPrompt,
=======
>>>>>>> 535dbf3feb3e1b9f4cfdc23cb7b10a264bde6d9d
    });
    console.log("🎉  Finished triaging.");
  } catch (err) {
    console.error("❌  Error:", err);
    process.exit(1);
  }
})();
```

### File: ./src/prompt.js
```
import { readFile } from 'node:fs/promises';
import { renderTemplate } from './config.js';

export async function buildPrompt(promptPath, { curators = [], contextPath } = {}) {
  const names = curators.join(', ');
  let context = '';
  if (contextPath) {
    try {
      context = await readFile(contextPath, 'utf8');
    } catch (err) {
      console.warn(`Could not read context file ${contextPath}: ${err.message}`);
    }
  }
  return renderTemplate(promptPath, { curators: names, context });
}
```

### File: ./src/imageSelector.js
```
import fs from "node:fs/promises";
import path from "node:path";
import { SUPPORTED_EXTENSIONS } from "./config.js";

/** Return full paths of images in `dir` (non‑recursive). */
export async function listImages(dir) {
  const entries = await fs.readdir(dir, { withFileTypes: true });
  return entries
    .filter(
      (e) =>
        e.isFile() &&
        SUPPORTED_EXTENSIONS.includes(path.extname(e.name).toLowerCase())
    )
    .map((e) => path.join(dir, e.name))
    .sort();
}

/** Pick up to `count` random items from the array. */
export function pickRandom(array, count) {
  const shuffled = array.slice().sort(() => Math.random() - 0.5);
  return shuffled.slice(0, Math.min(count, array.length));
}

/** Ensure sub‑directories exist and move each file accordingly. */
export async function moveFiles(files, targetDir, notes = new Map()) {
  if (!files.length) return;
  await fs.mkdir(targetDir, { recursive: true });
  await Promise.all(
    files.map(async (file) => {
      const dest = path.join(targetDir, path.basename(file));
      await fs.rename(file, dest);
      const note = notes.get(file);
      if (note) {
        const txt = dest.replace(/\.[^.]+$/, ".txt");
        await fs.writeFile(txt, note, "utf8");
      }
    })
  );
}
```

### File: ./src/replySchema.js
```
import { z } from 'zod';

export const Reply = z.object({
  minutes: z.array(z.object({ speaker: z.string(), text: z.string() })),
  decision: z.object({
    keep: z.record(z.string(), z.string()).optional(),
    aside: z.record(z.string(), z.string()).optional()
  }),
  field_notes_diff: z.string().optional(),
  field_notes_md: z.string().optional(),
});
```

### File: ./src/hash.js
```
import crypto from 'node:crypto';
import { readFile } from 'node:fs/promises';

export async function sha256(filePath) {
  const buf = await readFile(filePath);
  return crypto.createHash('sha256').update(buf).digest('hex');
}
```

### File: ./src/stats.js
```
import { writeFile } from 'node:fs/promises';

export async function writeStats(data) {
  await writeFile('.ps-stats.json', JSON.stringify(data, null, 2), 'utf8');
}
```

### File: ./src/orchestrator.js
```
import path from "node:path";
import { readFile, writeFile, mkdir, stat, copyFile } from "node:fs/promises";
import { renderTemplate } from "./config.js";
import { buildPrompt } from "./prompt.js";
import { writeStats } from "./stats.js";
import { execSync } from "node:child_process";
import { listImages, pickRandom, moveFiles } from "./imageSelector.js";
import { chatCompletion, parseReply } from "./chatClient.js";
import { FieldNotesWriter } from "./fieldNotes.js";

/**
 * Recursively triage images until the current directory is empty
 * or contains only _keep/_aside folders.
 */
export async function triageDirectory({
  dir,
  promptPath,
  model,
  recurse = true,
  curators = [],
  contextPath,
  fieldNotes = false,
  showPrompt = false,
  depth = 0,
}) {
  const indent = "  ".repeat(depth);
  let context = "";
  if (contextPath) {
    try {
      context = await readFile(contextPath, 'utf8');
    } catch (err) {
      console.warn(`Could not read context file ${contextPath}: ${err.message}`);
    }
  }

  const levelDir = path.join(dir, `_level-${String(depth + 1).padStart(3, '0')}`);
  const initImages = await listImages(dir);
  const promptsDir = path.join(levelDir, 'prompts');
  const repliesDir = path.join(levelDir, 'replies');
  let notesWriter;
  let fieldNotesText = "";
  if (fieldNotes) {
    notesWriter = new FieldNotesWriter(path.join(levelDir, 'field-notes.md'));
    await notesWriter.init();
    const existing = await notesWriter.read();
    if (existing) fieldNotesText = existing;
  }

  const names = curators.join(', ');
  let basePrompt = await renderTemplate(promptPath, {
    curators: names,
    context,
    fieldNotes: fieldNotesText,
    images: [],
  });
  let addon = '';
  if (fieldNotes) {
    const addonPath = new URL('../prompts/field_notes_addon.txt', import.meta.url).pathname;
    try {
      addon = await readFile(addonPath, 'utf8');
    } catch (err) {
      console.warn(`Could not read field notes addon: ${err.message}`);
    }
  }


  console.log(`${indent}📁  Scanning ${dir}`);

  // Archive original images at this level
  try {
    await stat(levelDir);
  } catch {
    // ignore
  }
  await mkdir(levelDir, { recursive: true });
  await mkdir(promptsDir, { recursive: true });
  await mkdir(repliesDir, { recursive: true });
  if (initImages.length) {
    await Promise.all(
      initImages.map((file) =>
        copyFile(file, path.join(levelDir, path.basename(file)))
      )
    );
  }

  while (true) {
    const images = await listImages(dir);
    if (images.length === 0) {
      console.log(`${indent}✅  Nothing to do in ${dir}`);
      break;
    }

    console.log(`${indent}📊  ${images.length} unclassified image(s) found`);

    // Step 1 – select ≤10
    const batch = pickRandom(images, 10);
    console.log(`${indent}🔍  Selected ${batch.length} image(s)`);

    // Step 2 – ask ChatGPT
    console.log(`${indent}⏳  Sending batch to ChatGPT…`);
    let prompt = await buildPrompt(promptPath, {
      curators,
      contextPath,
      fieldNotes: fieldNotesText,
      images: batch,
    });
    if (addon) prompt += `\n${addon}`;
    let beforeLines = 0;
    if (notesWriter) {
      const prev = await notesWriter.read();
      beforeLines = prev ? prev.split('\n').length : 0;
    }
    const start = Date.now();
    const ts = Date.now();
    await writeFile(path.join(promptsDir, `${ts}.prompt.txt`), prompt, 'utf8');
    if (showPrompt) {
      console.log(`${indent}📑  Prompt:\n${prompt}`);
    }
    const replyObj = await chatCompletion({
      prompt,
      images: batch,
      model,
      curators,
    });
    const reply = JSON.stringify(replyObj, null, 2);
    await writeFile(path.join(repliesDir, `${ts}.raw.json`), reply, 'utf8');
    console.log(`${indent}🤖  ChatGPT reply:\n${reply}`);

    // Step 3 – parse decisions
    let parsed;
    try {
      parsed = parseReply(reply, batch, {
        expectFieldNotesDiff: fieldNotes,
      });
    } catch (err) {
      console.warn(`${indent}Failed to parse reply: ${err.message}`);
      continue;
    }
    const { keep, aside, notes, minutes, fieldNotesDiff, fieldNotesMd } = parsed;
    if (minutes.length) {
      const minutesFile = path.join(dir, `minutes-${Date.now()}.txt`);
      await writeFile(minutesFile, minutes.join('\n'), 'utf8');
      console.log(`${indent}📝  Saved meeting minutes to ${minutesFile}`);
    }

    if (notesWriter && (fieldNotesDiff || fieldNotesMd)) {
      try {
        if (fieldNotesMd) {
          await notesWriter.writeFull(fieldNotesMd);
        } else {
          const existing = (await notesWriter.read()) || '';
          const secondPrompt = await renderTemplate(
            new URL('../prompts/field_notes_second_pass.hbs', import.meta.url).pathname,
            { prompt: basePrompt, existing, diff: fieldNotesDiff }
          );
          if (showPrompt) {
            console.log(`${indent}📑  Second-pass prompt:\n${secondPrompt}`);
          }
          await writeFile(path.join(promptsDir, `${ts}-second.prompt.txt`), secondPrompt, 'utf8');
          const secondObj = await chatCompletion({
            prompt: secondPrompt,
            images: batch,
            model,
            curators,
          });
          const second = JSON.stringify(secondObj, null, 2);
          await writeFile(path.join(repliesDir, `${ts}-second.raw.json`), second, 'utf8');
          let parsed;
          try {
            parsed = parseReply(second, batch, {
              expectFieldNotesMd: true,
            });
          } catch (err) {
            console.warn(`${indent}Failed to parse second-pass reply: ${err.message}`);
            continue;
          }
          if (parsed.fieldNotesMd) {
            await notesWriter.writeFull(parsed.fieldNotesMd);
          } else {
            console.warn(`${indent}No field_notes_md returned; diff ignored`);
          }
        }
      } catch (err) {
        console.warn(`${indent}Failed to update field notes: ${err.message}`);
      }
    }

    // Step 4 – move files
    const keepDir = path.join(dir, "_keep");
    const asideDir = path.join(dir, "_aside");
    await Promise.all([
      moveFiles(keep, keepDir, notes),
      moveFiles(aside, asideDir, notes),
    ]);

    console.log(
      `📂  Moved: ${keep.length} keep → ${keepDir}, ${aside.length} aside → ${asideDir}`
    );

    let afterLines = beforeLines;
    if (notesWriter) {
      const txt = await notesWriter.read();
      afterLines = txt ? txt.split('\n').length : 0;
    }
    const latency = Date.now() - start;
    await writeStats({
      decision_latency_ms: latency,
      images_reviewed: batch.length,
      field_notes_lines_added: afterLines - beforeLines,
    });

    const filesToCommit = [path.join(repliesDir, `${ts}.raw.json`)];
    if (notesWriter) filesToCommit.push(notesWriter.file);
    if (process.env.NODE_ENV !== 'test') {
      try {
        execSync(`git add ${filesToCommit.map(f => `"${f}"`).join(' ')} && git commit -m "photo-select batch"`);
      } catch (err) {
        console.warn(`${indent}Git commit failed: ${err.message}`);
      }
    }
  }

  // Step 5 – recurse into keepDir if both keep and aside exist
  if (recurse) {
    const keepDir = path.join(dir, "_keep");
    const asideDir = path.join(dir, "_aside");
    let keepExists = false;
    try {
      keepExists = (await stat(keepDir)).isDirectory();
    } catch {
      // ignore
    }

    if (keepExists) {
      await triageDirectory({
        dir: keepDir,
        promptPath,
        model,
        recurse,
        curators,
        contextPath,
        fieldNotes,
        showPrompt,
        depth: depth + 1,
      });
    } else {
      let keepCount = 0;
      let asideCount = 0;
      try {
        keepCount = (await listImages(keepDir)).length;
      } catch {
        // ignore
      }
      try {
        asideCount = (await listImages(asideDir)).length;
      } catch {
        // ignore
      }

      if (keepCount || asideCount) {
        const status = keepCount ? "kept" : "set aside";
        console.log(`${indent}🎯  All images ${status} at this level; stopping recursion.`);
      }
    }
  }
}
```


---

## 3. Basic System Report

Below is a snapshot of the system’s OS, architecture, date, uptime, disk usage, and memory usage.

### OS & Architecture
```
Darwin MacBook-Pro-2.local 24.4.0 Darwin Kernel Version 24.4.0: Fri Apr 11 18:33:39 PDT 2025; root:xnu-11417.101.15~117/RELEASE_ARM64_T6020 x86_64
```

### Detailed OS Version
```
ProductName:		macOS
ProductVersion:		15.4.1
BuildVersion:		24E263
```

### Current Date & Uptime
```
Mon Jul 21 21:22:57 EDT 2025
21:22  up 11 days, 23:56, 28 users, load averages: 7.62 5.88 5.49
```

### Disk Usage
```
Filesystem                           Size    Used   Avail Capacity iused ifree %iused  Mounted on
/dev/disk3s1s1                      7.3Ti    14Gi    13Gi    52%    425k  138M    0%   /
devfs                               214Ki   214Ki     0Bi   100%     740     0  100%   /dev
/dev/disk3s6                        7.3Ti   1.0Gi    13Gi     8%       1  138M    0%   /System/Volumes/VM
/dev/disk3s2                        7.3Ti    13Gi    13Gi    51%    1.8k  138M    0%   /System/Volumes/Preboot
/dev/disk3s4                        7.3Ti   685Mi    13Gi     5%     328  138M    0%   /System/Volumes/Update
/dev/disk1s2                        500Mi   6.0Mi   481Mi     2%       1  4.9M    0%   /System/Volumes/xarts
/dev/disk1s1                        500Mi   5.4Mi   481Mi     2%      36  4.9M    0%   /System/Volumes/iSCPreboot
/dev/disk1s3                        500Mi   2.6Mi   481Mi     1%      65  4.9M    0%   /System/Volumes/Hardware
/dev/disk3s5                        7.3Ti   7.2Ti    13Gi   100%    6.2M  138M    4%   /System/Volumes/Data
map auto_home                         0Bi     0Bi     0Bi   100%       0     0     -   /System/Volumes/Data/home
/dev/disk2s1                        5.0Gi   1.9Gi   3.1Gi    38%      64   33M    0%   /System/Volumes/Update/SFR/mnt1
/Applications/Audible.app/Wrapper   7.3Ti   6.4Ti   823Gi    89%    6.1M  8.6G    0%   /private/var/folders/yh/6tlwwnn50zdf84ttzgsxb0tw0000gn/X/2A6AA4CE-74EA-542A-939E-9865070C6C80
/dev/disk3s1                        7.3Ti    14Gi    13Gi    52%    426k  138M    0%   /System/Volumes/Update/mnt1
```

### Memory Usage
```
(Command 'free' not found on this system.)
```

### Installed RAM
```
Memory:

      Memory: 96 GB
      Type: LPDDR5
      Manufacturer: Hynix

```

## 4. Additional ML-Focused System Details

### GPU and CUDA Information
```
(nvidia-smi not found or no NVIDIA GPU installed.)

[system_profiler SPDisplaysDataType]
Graphics/Displays:

    Apple M2 Max:

      Chipset Model: Apple M2 Max
      Type: GPU
      Bus: Built-In
      Total Number of Cores: 38
      Vendor: Apple (0x106b)
      Metal Support: Metal 3
      Displays:
        Color LCD:
          Display Type: Built-in Liquid Retina XDR Display
          Resolution: 3024 x 1964 Retina
          Main Display: Yes
          Mirror: Off
          Online: Yes
          Automatically Adjust Brightness: Yes
          Connection Type: Internal
        S22C650:
          Resolution: 1920 x 1080 (1080p FHD - Full High Definition)
          UI Looks like: 1920 x 1080 @ 60.00Hz
          Mirror: Off
          Online: Yes

```

### System Compiler & Libraries
```
[gcc --version]
Apple clang version 17.0.0 (clang-1700.0.13.5)
Target: x86_64-apple-darwin24.4.0
Thread model: posix
InstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin

[g++ --version]
Apple clang version 17.0.0 (clang-1700.0.13.5)
Target: x86_64-apple-darwin24.4.0
Thread model: posix
InstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin

[clang --version]
Apple clang version 17.0.0 (clang-1700.0.13.5)
Target: x86_64-apple-darwin24.4.0
Thread model: posix
InstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin

[pkg-config --modversion opencv]
Package opencv was not found in the pkg-config search path.
Perhaps you should add the directory containing `opencv.pc'
to the PKG_CONFIG_PATH environment variable
Package 'opencv' not found
OpenCV not found via pkg-config.
```

### Docker / Container Info
```
[docker --version]
Docker version 28.0.4, build b8034c0

[docker images]
Cannot connect to the Docker daemon at unix:///Users/jburkart/.docker/run/docker.sock. Is the docker daemon running?

[docker ps -a]
Cannot connect to the Docker daemon at unix:///Users/jburkart/.docker/run/docker.sock. Is the docker daemon running?
```

### Relevant Environment Variables
```
CONDA_EXE=/opt/anaconda3/bin/conda
CONDA_PREFIX=/opt/anaconda3
CONDA_PROMPT_MODIFIER=(base) 
CONDA_SHLVL=1
CONDA_PYTHON_EXE=/opt/anaconda3/bin/python
CONDA_DEFAULT_ENV=base
PATH=/opt/anaconda3/bin:/opt/homebrew/bin:/Users/jburkart/mamba/condabin:/Users/jburkart/.nvm/versions/node/v20.19.2/bin:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/local/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/appleinternal/bin:/Library/Apple/usr/bin:/Applications/iTerm.app/Contents/Resources/utilities
```

### Ollama Models
```
NAME                  ID              SIZE      MODIFIED     
r1-1776:70b           140ea940f21d    42 GB     4 months ago    
deepseek-r1:14b       ea35dfe18182    9.0 GB    5 months ago    
deepseek-r1:8b        28f8fd6cdc67    4.9 GB    5 months ago    
deepseek-r1:7b        0a8c26691023    4.7 GB    5 months ago    
deepseek-r1:1.5b      a42b25d8c10a    1.1 GB    5 months ago    
deepseek-r1:70b       0c1615a8ca32    42 GB     5 months ago    
deepseek-r1:32b       38056bbcbb2d    19 GB     5 months ago    
deepseek-r1:latest    0a8c26691023    4.7 GB    5 months ago    
```

Overview generation complete. The file 'project-overview.txt' has been created.
